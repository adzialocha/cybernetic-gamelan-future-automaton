{"version":3,"sources":["webpack:///automaton.bundle.js","webpack:///./automaton/scripts/instrument/synthesizer/constants/index.js","webpack:///./automaton/scripts/index.js","webpack:///./automaton/scripts/Debug.js","webpack:///./automaton/scripts/instrument/index.js","webpack:///./automaton/scripts/instrument/gamelan/index.js","webpack:///./automaton/scripts/instrument/gamelan/patternHelpers.js","webpack:///./automaton/scripts/instrument/SynthesizerInterface.js","webpack:///./automaton/scripts/instrument/AudioInterface.js","webpack:///./automaton/assets/impulse.wav","webpack:///./automaton/scripts/instrument/Channel.js","webpack:///./automaton/scripts/instrument/synthesizer/index.js","webpack:///./automaton/scripts/instrument/synthesizer/constants/algorithms.js","webpack:///./automaton/scripts/instrument/synthesizer/constants/fixedFrequencyTable.js","webpack:///./automaton/scripts/instrument/synthesizer/helpers.js","webpack:///./automaton/scripts/instrument/synthesizer/Operator.js","webpack:///./automaton/scripts/instrument/synthesizer/Envelope.js","webpack:///./automaton/scripts/instrument/synthesizer/EnvelopeSegment.js","webpack:///./automaton/scripts/instrument/presets.js","webpack:///./automaton/scripts/network/index.js","webpack:///./automaton/scripts/Settings.js","webpack:///./automaton/scripts/View.js"],"names":["webpackJsonp","module","exports","__webpack_require__","Object","defineProperty","value","_algorithms","enumerable","get","ALGORITHMS","_fixedFrequencyTable","FIXED_FREQUENCY_TABLE","_index","_index2","_interopRequireDefault","_Debug","_Debug2","_network","_network2","_Settings","_Settings2","_View","_View2","obj","__esModule","default","debug","settings","view","network","onOpen","changeConnectionState","onClose","onOpenRemote","peerId","addRemotePeer","onCloseRemote","removeRemotePeer","onSyncTick","offset","updateOffset","tick","onError","err","addErrorMessage","message","window","addEventListener","updateSettings","getConfiguration","automaton","connect","event","preventDefault","disconnect","send","data","sendToAll","update","_event$target","target","id","keyCode","shiftKey","changeView","_createClass","defineProperties","props","i","length","descriptor","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_instrument","_instrument2","_presets","_classCallCheck","instance","TypeError","TestInterface","this","instrument","preset","PRESETS","BELL","noteMaterial","changePattern","notePattern","durationPattern","bpm","velocity","octave","start","stop","noteOn","note","synthesizerInterface","noteOff","_gamelan","_gamelan2","_SynthesizerInterface","_SynthesizerInterface2","Instrument","options","arguments","undefined","gamelan","changePreset","_patternHelpers","defaultSettings","Gamelan","currentPartIndex","currentPart","pattern","timeout","isRunning","playNext","_this","_pattern$currentPartI","duration","setTimeout","Error","clearTimeout","allNotesOff","assign","symbolsToPattern","DURATIONS",".","_","-","/","#","MINUTE_IN_MS","PAUSE_SYMBOL","bpmToMs","notes","split","durations","map","noteSymbol","index","durationSymbol","keys","includes","noteNumber","parseInt","isNaN","_AudioInterface","_AudioInterface2","_Channel","_Channel2","_synthesizer","_synthesizer2","DEFAULT_NOTE","DEFAULT_VELOCITY","SynthesizerInterface","audio","channels","synthesizer","sampleRate","context","channel","push","findIndex","removedChannel","then","splice","_this2","forEach","_impulse","_impulse2","getImpulse","Promise","resolve","reject","ajaxRequest","XMLHttpRequest","open","responseType","onload","impulseData","response","decodeAudioData","buffer","AudioInterface","AudioContext","convolverNode","createConvolver","loop","normalize","compressorNode","createDynamicsCompressor","currentVolume","gainNode","createGain","gain","destination","changeVolume","volume","mute","unmute","p","Channel","audioInterface","scriptProcessorNode","_audioInterface","createScriptProcessor","bufferSourceNode","createBufferSource","onaudioprocess","left","outputBuffer","getChannelData","right","generateAudio","_constants","_helpers","_Operator","_Operator2","DEFAULT_SAMPLE_RATE","Synthesizer","feedback","algorithmId","operators","numSamples","algorithm","sampleIndex","mainOutput","_loop","op","modOutput","operator","item","_output","amp","envelope","Math","sin","_phase","isVelocitySensitive","_phaseIncrement","next","frequency","isFixed","calculateFixedFrequency","coarse","fine","calculatePhaseIncrement","calculateRatioFrequency","pow","_this3","counter","onRelease","changeOperator","setting","changeEnvelope","_this4","convertedPreset","convertOperatorSettings","PI","ratio","ceil","rate","floor","base","totalTime","isLoop","segments","envelopes","segment","step","x","y","previousSegment","_Envelope","_Envelope2","Operator","changeSegment","_EnvelopeSegment","_EnvelopeSegment2","ENVELOPE_STATES","STOP","ATTACK","DECAY","SUSTAIN","RELEASE","DUMP","Envelope","state","currentSegmentPosition","currentSegmentStep","EnvelopeSegment","name","BRASS","ORGAN","CHIME","PAD","EG_LOOPER","GUITAR","EG_SEQ","INIT_VOICE","_peerjs","_peerjs2","_timesync","CHECK_MISSING_PEERS_FREQUENCY","PEER_ID_KEY","getPeerString","getAllPeers","clientsNumber","ownId","peers","defaultOptions","onReceive","syncInterval","syncTickFrequency","Network","lastCheckedDate","Date","peer","sync","syncTickInterval","configuration","serverHost","serverKey","serverPort","setupConnection","connection","connections","isAlreadyOpen","find","remoteConnection","on","jsonrpc","receive","connectToPeers","filter","serialization","host","port","destroy","type","create","delay","interval","openConnections","some","setInterval","syncDate","now","getSeconds","isForced","clearInterval","all","STORAGE_KEY","loadFromStorage","storage","localStorage","getItem","JSON","parse","saveToStorage","setItem","stringify","defaultConfiguration","Settings","ERROR_MESSAGES_LIMIT","VIEW_IDS","INITIAL_VIEW","View","allFormElems","document","querySelectorAll","connectButtonElem","getElementById","connectedPeersElem","disconnectButtonElem","errorMessagesElem","offsetMonitorElem","tickElem","errorMessages","indexOf","isLoading","isConnected","disabled","inputElement","innerText","toFixed","timestamp","shift","innerHTML","error","errorMessageElem","createElement","formattedTime","toISOString","appendChild","peerElem","class","removeChild","viewIndex","viewId","classList","remove","nextViewId","add"],"mappings":"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","file":"automaton.bundle.js","sourcesContent":["webpackJsonp([0],[\n/* 0 */,\n/* 1 */,\n/* 2 */,\n/* 3 */,\n/* 4 */,\n/* 5 */,\n/* 6 */,\n/* 7 */,\n/* 8 */,\n/* 9 */,\n/* 10 */,\n/* 11 */,\n/* 12 */,\n/* 13 */\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n/* 14 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _algorithms = __webpack_require__(45);\n\nObject.defineProperty(exports, 'ALGORITHMS', {\n  enumerable: true,\n  get: function get() {\n    return _algorithms.ALGORITHMS;\n  }\n});\n\nvar _fixedFrequencyTable = __webpack_require__(46);\n\nObject.defineProperty(exports, 'FIXED_FREQUENCY_TABLE', {\n  enumerable: true,\n  get: function get() {\n    return _fixedFrequencyTable.FIXED_FREQUENCY_TABLE;\n  }\n});\n\n/***/ }),\n/* 15 */,\n/* 16 */,\n/* 17 */,\n/* 18 */,\n/* 19 */,\n/* 20 */,\n/* 21 */,\n/* 22 */,\n/* 23 */,\n/* 24 */,\n/* 25 */,\n/* 26 */,\n/* 27 */,\n/* 28 */,\n/* 29 */,\n/* 30 */,\n/* 31 */,\n/* 32 */,\n/* 33 */,\n/* 34 */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = __webpack_require__(35);\n\n\n/***/ }),\n/* 35 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _index = __webpack_require__(13);\n\nvar _index2 = _interopRequireDefault(_index);\n\nvar _Debug = __webpack_require__(36);\n\nvar _Debug2 = _interopRequireDefault(_Debug);\n\nvar _network = __webpack_require__(52);\n\nvar _network2 = _interopRequireDefault(_network);\n\nvar _Settings = __webpack_require__(87);\n\nvar _Settings2 = _interopRequireDefault(_Settings);\n\nvar _View = __webpack_require__(88);\n\nvar _View2 = _interopRequireDefault(_View);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// eslint-disable-line no-unused-vars\n\nvar debug = new _Debug2.default();\nvar settings = new _Settings2.default();\nvar view = new _View2.default();\n\nvar network = new _network2.default({\n  onOpen: function onOpen() {\n    view.changeConnectionState(false, true);\n  },\n  onClose: function onClose() {\n    view.changeConnectionState(false, false);\n  },\n  onOpenRemote: function onOpenRemote(peerId) {\n    view.addRemotePeer(peerId);\n  },\n  onCloseRemote: function onCloseRemote(peerId) {\n    view.removeRemotePeer(peerId);\n  },\n  onSyncTick: function onSyncTick(offset) {\n    view.updateOffset(offset);\n    view.tick();\n  },\n  // onReceive: (peer, data) => {\n  //   console.log('receive', peer, data)\n  // },\n  onError: function onError(err) {\n    view.addErrorMessage(err.message);\n  }\n});\n\n// Initialize\nwindow.addEventListener('load', function () {\n  view.changeConnectionState(false, false);\n  view.updateSettings(settings.getConfiguration());\n});\n\n// Expose some interfaces to the view\nwindow.automaton = window.automaton || {\n  network: {\n    connect: function connect(event) {\n      event.preventDefault();\n\n      if (network.connect(settings.getConfiguration())) {\n        view.changeConnectionState(true, false);\n      }\n    },\n    disconnect: function disconnect(event) {\n      event.preventDefault();\n\n      view.changeConnectionState(true, true);\n      network.disconnect();\n    },\n    send: function send(data) {\n      network.sendToAll(data);\n    }\n  },\n  settings: {\n    update: function update(event) {\n      var _event$target = event.target,\n          id = _event$target.id,\n          value = _event$target.value;\n\n      settings.update(id, value);\n    }\n  },\n  debug: debug\n\n  // Main keyboard control strokes\n};window.addEventListener('keydown', function (event) {\n  var keyCode = event.keyCode,\n      shiftKey = event.shiftKey;\n\n  if (shiftKey) {\n    view.changeView(keyCode - 49);\n  }\n});\n\n/***/ }),\n/* 36 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); // eslint-disable-line no-unused-vars\n\nvar _index = __webpack_require__(13);\n\nvar _index2 = _interopRequireDefault(_index);\n\nvar _instrument = __webpack_require__(37);\n\nvar _instrument2 = _interopRequireDefault(_instrument);\n\nvar _presets = __webpack_require__(51);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar TestInterface = function () {\n  function TestInterface() {\n    _classCallCheck(this, TestInterface);\n\n    this.instrument = new _instrument2.default({\n      preset: _presets.PRESETS.BELL,\n      noteMaterial: [62, 65, 70, 72, 74]\n    });\n  }\n\n  _createClass(TestInterface, [{\n    key: 'changePattern',\n    value: function changePattern(notePattern, durationPattern, bpm, velocity, octave) {\n      this.instrument.changePattern(notePattern, durationPattern, bpm, velocity, octave);\n    }\n  }, {\n    key: 'start',\n    value: function start() {\n      this.instrument.start();\n    }\n  }, {\n    key: 'stop',\n    value: function stop() {\n      this.instrument.stop();\n    }\n  }, {\n    key: 'noteOn',\n    value: function noteOn(note, velocity) {\n      this.instrument.synthesizerInterface.noteOn(note, velocity);\n    }\n  }, {\n    key: 'noteOff',\n    value: function noteOff(note) {\n      this.instrument.synthesizerInterface.noteOff(note);\n    }\n  }]);\n\n  return TestInterface;\n}();\n\nexports.default = TestInterface;\nmodule.exports = exports['default'];\n\n/***/ }),\n/* 37 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _gamelan = __webpack_require__(38);\n\nvar _gamelan2 = _interopRequireDefault(_gamelan);\n\nvar _SynthesizerInterface = __webpack_require__(40);\n\nvar _SynthesizerInterface2 = _interopRequireDefault(_SynthesizerInterface);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Instrument = function () {\n  function Instrument() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, Instrument);\n\n    var noteMaterial = options.noteMaterial,\n        preset = options.preset;\n\n\n    this.synthesizerInterface = new _SynthesizerInterface2.default({\n      preset: preset\n    });\n\n    this.gamelan = new _gamelan2.default({\n      noteMaterial: noteMaterial,\n      synthesizerInterface: this.synthesizerInterface\n    });\n  }\n\n  _createClass(Instrument, [{\n    key: 'changePreset',\n    value: function changePreset(preset) {\n      this.synthesizerInterface.preset = preset;\n    }\n  }, {\n    key: 'changePattern',\n    value: function changePattern(notePattern, durationPattern, bpm, velocity, octave) {\n      this.gamelan.changePattern(notePattern, durationPattern, {\n        bpm: bpm,\n        octave: octave,\n        velocity: velocity\n      });\n    }\n  }, {\n    key: 'start',\n    value: function start() {\n      this.gamelan.start();\n    }\n  }, {\n    key: 'stop',\n    value: function stop() {\n      this.gamelan.stop();\n    }\n  }]);\n\n  return Instrument;\n}();\n\nexports.default = Instrument;\nmodule.exports = exports['default'];\n\n/***/ }),\n/* 38 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _patternHelpers = __webpack_require__(39);\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar defaultSettings = {\n  bpm: 120,\n  velocity: 1.0,\n  octave: 0\n};\n\nvar Gamelan = function () {\n  function Gamelan(options) {\n    _classCallCheck(this, Gamelan);\n\n    var noteMaterial = options.noteMaterial,\n        synthesizerInterface = options.synthesizerInterface;\n\n\n    this.noteMaterial = noteMaterial;\n    this.synthesizerInterface = synthesizerInterface;\n\n    this.settings = defaultSettings;\n\n    this.currentPartIndex = 0;\n    this.currentPart = null;\n    this.pattern = [];\n\n    this.timeout = null;\n    this.isRunning = false;\n  }\n\n  _createClass(Gamelan, [{\n    key: 'playNext',\n    value: function playNext() {\n      var _this = this;\n\n      if (this.pattern.length === 0) {\n        return;\n      }\n\n      var _pattern$currentPartI = this.pattern[this.currentPartIndex],\n          duration = _pattern$currentPartI.duration,\n          note = _pattern$currentPartI.note,\n          velocity = _pattern$currentPartI.velocity;\n\n\n      if (note) {\n        this.synthesizerInterface.noteOn(note, velocity);\n      }\n\n      this.timeout = setTimeout(function () {\n        if (!_this.isRunning) {\n          return;\n        }\n\n        if (_this.pattern.length === 0) {\n          return;\n        }\n\n        if (note) {\n          _this.synthesizerInterface.noteOff(note);\n        }\n\n        _this.currentPartIndex += 1;\n\n        if (_this.currentPartIndex >= _this.pattern.length - 1) {\n          _this.currentPartIndex = 0;\n        }\n\n        _this.playNext();\n      }, duration);\n    }\n  }, {\n    key: 'start',\n    value: function start() {\n      if (this.isRunning) {\n        throw new Error('Gamelan is already running');\n      }\n\n      this.currentPartIndex = 0;\n      this.isRunning = true;\n\n      this.playNext();\n    }\n  }, {\n    key: 'stop',\n    value: function stop() {\n      if (!this.isRunning) {\n        throw new Error('Gamelan is already stopped');\n      }\n\n      clearTimeout(this.timeout);\n\n      this.synthesizerInterface.allNotesOff();\n\n      this.timeout = null;\n      this.isRunning = false;\n    }\n  }, {\n    key: 'changePattern',\n    value: function changePattern(notePattern, durationPattern) {\n      var settings = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n      this.settings = Object.assign({}, this.settings, settings);\n\n      this.pattern = (0, _patternHelpers.symbolsToPattern)(notePattern, durationPattern, this.settings, this.noteMaterial);\n\n      if (this.isRunning) {\n        clearTimeout(this.timeout);\n\n        this.currentPartIndex = 0;\n        this.synthesizerInterface.allNotesOff();\n\n        this.playNext();\n      }\n    }\n  }]);\n\n  return Gamelan;\n}();\n\nexports.default = Gamelan;\nmodule.exports = exports['default'];\n\n/***/ }),\n/* 39 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.symbolsToPattern = symbolsToPattern;\nvar DURATIONS = {\n  '.': 16,\n  '_': 8,\n  '-': 4,\n  '/': 2,\n  '#': 1\n};\n\nvar MINUTE_IN_MS = 60000;\nvar PAUSE_SYMBOL = '*';\n\nfunction bpmToMs(bpm, duration) {\n  return MINUTE_IN_MS / bpm * (1 / duration) * 4;\n}\n\nfunction symbolsToPattern(notePattern, durationPattern, settings, noteMaterial) {\n  if (notePattern.length !== durationPattern.length) {\n    throw new Error('Notes and duration string need the same length');\n  }\n\n  var octave = settings.octave,\n      bpm = settings.bpm,\n      velocity = settings.velocity;\n\n  var notes = notePattern.split('');\n  var durations = durationPattern.split('');\n\n  return notes.map(function (noteSymbol, index) {\n    var durationSymbol = durations[index];\n\n    if (!Object.keys(DURATIONS).includes(durationSymbol)) {\n      throw new Error('Unknown duration symbol');\n    }\n\n    var duration = bpmToMs(bpm, DURATIONS[durationSymbol]);\n    var note = null;\n\n    if (noteSymbol !== PAUSE_SYMBOL) {\n      var noteNumber = parseInt(noteSymbol, 10);\n\n      if (isNaN(noteNumber) || noteNumber < 1 || noteNumber > noteMaterial.length) {\n        throw new Error('Unknown note symbol');\n      }\n\n      note = noteMaterial[noteNumber - 1] + 12 * octave;\n    }\n\n    return {\n      note: note,\n      duration: duration,\n      velocity: velocity\n    };\n  });\n}\n\n/***/ }),\n/* 40 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _AudioInterface = __webpack_require__(41);\n\nvar _AudioInterface2 = _interopRequireDefault(_AudioInterface);\n\nvar _Channel = __webpack_require__(43);\n\nvar _Channel2 = _interopRequireDefault(_Channel);\n\nvar _synthesizer = __webpack_require__(44);\n\nvar _synthesizer2 = _interopRequireDefault(_synthesizer);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar DEFAULT_NOTE = 72;\nvar DEFAULT_VELOCITY = 1.0;\n\nvar SynthesizerInterface = function () {\n  function SynthesizerInterface() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, SynthesizerInterface);\n\n    this.audio = new _AudioInterface2.default();\n    this.channels = [];\n    this.preset = options.preset;\n  }\n\n  _createClass(SynthesizerInterface, [{\n    key: 'changePreset',\n    value: function changePreset(preset) {\n      this.preset = preset;\n    }\n  }, {\n    key: 'noteOn',\n    value: function noteOn() {\n      var note = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : DEFAULT_NOTE;\n      var velocity = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : DEFAULT_VELOCITY;\n\n      // Create FM synthesizer\n      var synthesizer = new _synthesizer2.default({\n        preset: this.preset,\n        sampleRate: this.audio.context.sampleRate\n      });\n\n      // Create a channel for audio\n      var channel = new _Channel2.default(this.audio, synthesizer, note);\n      channel.start();\n      this.channels.push(channel);\n\n      // Play the note\n      synthesizer.noteOn(note, velocity);\n    }\n  }, {\n    key: 'noteOff',\n    value: function noteOff() {\n      var _this = this;\n\n      var note = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : DEFAULT_NOTE;\n\n      var index = this.channels.findIndex(function (channel) {\n        return channel.note === note;\n      });\n\n      if (index === -1) {\n        throw new Error('Could not find that note');\n      }\n\n      var removedChannel = this.channels[index];\n\n      removedChannel.note = null;\n\n      removedChannel.synthesizer.noteOff().then(function () {\n        removedChannel.stop();\n\n        _this.channels.splice(_this.channels.findIndex(function (channel) {\n          return channel === removedChannel;\n        }), 1);\n      });\n    }\n  }, {\n    key: 'allNotesOff',\n    value: function allNotesOff() {\n      var _this2 = this;\n\n      this.channels.forEach(function (channel) {\n        if (channel.note) {\n          _this2.noteOff(channel.note);\n        }\n      });\n    }\n  }]);\n\n  return SynthesizerInterface;\n}();\n\nexports.default = SynthesizerInterface;\nmodule.exports = exports['default'];\n\n/***/ }),\n/* 41 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _impulse = __webpack_require__(42);\n\nvar _impulse2 = _interopRequireDefault(_impulse);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction getImpulse(context) {\n  return new Promise(function (resolve, reject) {\n    var ajaxRequest = new XMLHttpRequest();\n    ajaxRequest.open('GET', _impulse2.default, true);\n    ajaxRequest.responseType = 'arraybuffer';\n\n    ajaxRequest.onload = function () {\n      var impulseData = ajaxRequest.response;\n      context.decodeAudioData(impulseData, function (buffer) {\n        resolve(buffer);\n      }, function (err) {\n        reject(err);\n      });\n    };\n\n    ajaxRequest.send();\n  });\n}\n\nvar AudioInterface = function () {\n  function AudioInterface() {\n    var _this = this;\n\n    _classCallCheck(this, AudioInterface);\n\n    // Create audio context\n    this.context = new AudioContext();\n\n    // Reverb\n    this.convolverNode = this.context.createConvolver();\n    this.convolverNode.loop = true;\n    this.convolverNode.normalize = true;\n\n    getImpulse(this.context).then(function (buffer) {\n      _this.convolverNode.buffer = buffer;\n    });\n\n    // Compressor\n    this.compressorNode = this.context.createDynamicsCompressor();\n\n    // Gain\n    this.currentVolume = 1;\n    this.gainNode = this.context.createGain();\n    this.gainNode.gain.value = this.currentVolume;\n\n    this.compressorNode.connect(this.convolverNode);\n    this.convolverNode.connect(this.gainNode);\n    this.gainNode.connect(this.context.destination);\n  }\n\n  _createClass(AudioInterface, [{\n    key: 'changeVolume',\n    value: function changeVolume(volume) {\n      this.gainNode.gain.value = volume;\n      this.currentVolume = volume;\n    }\n  }, {\n    key: 'mute',\n    value: function mute() {\n      this.gainNode.gain.value = 0;\n    }\n  }, {\n    key: 'unmute',\n    value: function unmute() {\n      this.gainNode.gain.value = this.currentVolume;\n    }\n  }]);\n\n  return AudioInterface;\n}();\n\nexports.default = AudioInterface;\nmodule.exports = exports['default'];\n\n/***/ }),\n/* 42 */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = __webpack_require__.p + \"cce8145a91d99c7379b34bf23fce576a.wav\";\n\n/***/ }),\n/* 43 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Channel = function () {\n  function Channel(audioInterface, synthesizer, note) {\n    _classCallCheck(this, Channel);\n\n    this.audioInterface = audioInterface;\n    this.isRunning = false;\n    this.note = note;\n    this.scriptProcessorNode = null;\n    this.synthesizer = synthesizer;\n  }\n\n  _createClass(Channel, [{\n    key: 'start',\n    value: function start() {\n      var _this = this;\n\n      if (this.isRunning) {\n        throw new Error('Channel was already started');\n      }\n\n      var _audioInterface = this.audioInterface,\n          context = _audioInterface.context,\n          compressorNode = _audioInterface.compressorNode;\n\n      this.scriptProcessorNode = context.createScriptProcessor();\n\n      var bufferSourceNode = context.createBufferSource();\n      bufferSourceNode.start(0);\n\n      // Connect audio nodes\n      bufferSourceNode.connect(this.scriptProcessorNode);\n      this.scriptProcessorNode.connect(compressorNode);\n\n      // Start FM synthesis\n      this.scriptProcessorNode.onaudioprocess = function (event) {\n        var left = event.outputBuffer.getChannelData(0);\n        var right = event.outputBuffer.getChannelData(1);\n\n        _this.synthesizer.generateAudio(left, right);\n      };\n\n      this.isRunning = true;\n    }\n  }, {\n    key: 'stop',\n    value: function stop() {\n      if (!this.isRunning) {\n        throw new Error('Channel was already stopped');\n      }\n\n      this.scriptProcessorNode.disconnect();\n      this.isRunning = false;\n    }\n  }]);\n\n  return Channel;\n}();\n\nexports.default = Channel;\nmodule.exports = exports['default'];\n\n/***/ }),\n/* 44 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _constants = __webpack_require__(14);\n\nvar _helpers = __webpack_require__(47);\n\nvar _Operator = __webpack_require__(48);\n\nvar _Operator2 = _interopRequireDefault(_Operator);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar DEFAULT_SAMPLE_RATE = 16000;\n\nvar Synthesizer = function () {\n  function Synthesizer() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, Synthesizer);\n\n    if (!options || !options.preset) {\n      throw new Error('Preset option is not set');\n    }\n\n    this.sampleRate = options.sampleRate || DEFAULT_SAMPLE_RATE;\n\n    this.velocity = 1.0;\n    this.feedback = 0.0;\n\n    this.algorithmId = 0;\n    this.operators = [];\n\n    for (var i = 0; i < 4; i += 1) {\n      this.operators.push(new _Operator2.default());\n    }\n\n    this.changePreset(options.preset);\n  }\n\n  _createClass(Synthesizer, [{\n    key: 'generateAudio',\n    value: function generateAudio(left, right) {\n      var _this = this;\n\n      var numSamples = left.length;\n      var algorithm = _constants.ALGORITHMS[this.algorithmId];\n\n      for (var sampleIndex = 0; sampleIndex < numSamples; sampleIndex += 1) {\n        var mainOutput = 0;\n\n        var _loop = function _loop(op) {\n          var modOutput = 0;\n          var operator = _this.operators[op];\n\n          _this.operators.forEach(function (item, index) {\n            modOutput += algorithm[op][index] * _this.operators[index]._output;\n          });\n\n          modOutput *= 10;\n\n          if (op === 3) {\n            modOutput += operator._output * _this.feedback * 3;\n          }\n\n          var amp = operator.envelope.amp;\n          operator._output = Math.sin(operator._phase + modOutput) * amp * amp;\n\n          if (operator.isVelocitySensitive) {\n            operator._output *= _this.velocity;\n          }\n\n          operator._phase += operator._phaseIncrement;\n\n          mainOutput += operator._output * algorithm[4][op];\n        };\n\n        for (var op = this.operators.length - 1; op >= 0; op -= 1) {\n          _loop(op);\n        }\n\n        right[sampleIndex] = left[sampleIndex] = mainOutput;\n\n        this.operators.forEach(function (operator) {\n          operator.next();\n        });\n      }\n    }\n  }, {\n    key: 'noteOn',\n    value: function noteOn(note, velocity) {\n      var _this2 = this;\n\n      this.velocity = velocity;\n\n      this.operators.forEach(function (operator) {\n        var frequency = void 0;\n\n        if (operator.isFixed) {\n          frequency = (0, _helpers.calculateFixedFrequency)(operator.coarse, operator.fine);\n\n          operator._phaseIncrement = (0, _helpers.calculatePhaseIncrement)(frequency, _this2.sampleRate);\n        } else {\n          frequency = (0, _helpers.calculateRatioFrequency)(operator.coarse, operator.fine);\n\n          operator._phaseIncrement = (0, _helpers.calculatePhaseIncrement)(440 * Math.pow(2.0, (note - 69) / 12.0), _this2.sampleRate) * frequency;\n        }\n\n        operator._phase = 0.0;\n        operator._output = 0.0;\n      });\n\n      this.operators.forEach(function (operator) {\n        operator.noteOn();\n      });\n    }\n  }, {\n    key: 'noteOff',\n    value: function noteOff() {\n      var _this3 = this;\n\n      return new Promise(function (resolve) {\n        var counter = _this3.operators.length;\n\n        _this3.operators.forEach(function (operator) {\n          operator.envelope.onRelease = function () {\n            counter -= 1;\n            if (counter === 0) {\n              resolve();\n            }\n          };\n\n          operator.noteOff();\n        });\n      });\n    }\n  }, {\n    key: 'changeOperator',\n    value: function changeOperator(index, setting) {\n      if (index < 0 || index > this.operators.length - 1) {\n        return;\n      }\n\n      this.operators[index].coarse = setting.coarse;\n      this.operators[index].fine = setting.fine;\n\n      this.operators[index].isFixed = setting.isFixed;\n      this.operators[index].isVelocitySensitive = setting.isVelocitySensitive;\n\n      this.operators[index].changeEnvelope(setting.envelope);\n    }\n  }, {\n    key: 'changePreset',\n    value: function changePreset(preset) {\n      var _this4 = this;\n\n      var convertedPreset = (0, _helpers.convertOperatorSettings)(preset, this.sampleRate);\n\n      this.feedback = convertedPreset.feedback;\n      this.algorithmId = convertedPreset.algorithmId;\n\n      convertedPreset.operators.forEach(function (setting, index) {\n        _this4.changeOperator(index, setting);\n      });\n    }\n  }]);\n\n  return Synthesizer;\n}();\n\nexports.default = Synthesizer;\nmodule.exports = exports['default'];\n\n/***/ }),\n/* 45 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar ALGORITHMS = exports.ALGORITHMS = [[\n// OP1 OP2 OP3 OP4 = MOD\n[0, 1, 0, 0], // OP1\n[0, 0, 1, 0], // OP2\n[0, 0, 0, 1], // OP3\n[0, 0, 0, 0], // OP4\n[1, 0, 0, 0]], [\n// OP1 OP2 OP3 OP4\n[0, 1, 0, 0], // OP1\n[0, 0, 1, 1], // OP2\n[0, 0, 0, 0], // OP3\n[0, 0, 0, 0], // OP4\n[1, 0, 0, 0]], [\n// OP1 OP2 OP3 OP4\n[0, 1, 0, 1], // OP1\n[0, 0, 1, 0], // OP2\n[0, 0, 0, 0], // OP3\n[0, 0, 0, 0], // OP4\n[1, 0, 0, 0]], [\n// OP1 OP2 OP3 OP4\n[0, 1, 1, 0], // OP1\n[0, 0, 0, 0], // OP2\n[0, 0, 0, 1], // OP3\n[0, 0, 0, 0], // OP4\n[1, 0, 0, 0]], [\n// OP1 OP2 OP3 OP4\n[0, 1, 0, 0], // OP1\n[0, 0, 0, 0], // OP2\n[0, 0, 0, 1], // OP3\n[0, 0, 0, 0], // OP4\n[0.5, 0, 0.5, 0]], [\n// OP1 OP2 OP3 OP4\n[0, 0, 0, 1], // OP1\n[0, 0, 0, 1], // OP2\n[0, 0, 0, 1], // OP3\n[0, 0, 0, 0], // OP4\n[0.33, 0.33, 0.33, 0]], [\n// OP1 OP2 OP3 OP4\n[0, 0, 0, 0], // OP1\n[0, 0, 0, 0], // OP2\n[0, 0, 0, 1], // OP3\n[0, 0, 0, 0], // OP4\n[0.33, 0.33, 0.33, 0]], [\n// OP1 OP2 OP3 OP4\n[0, 0, 0, 0], // OP1\n[0, 0, 0, 0], // OP2\n[0, 0, 0, 0], // OP3\n[0, 0, 0, 0], // OP4\n[0.25, 0.25, 0.25, 0.25]]];\n\n/***/ }),\n/* 46 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar FIXED_FREQUENCY_TABLE = exports.FIXED_FREQUENCY_TABLE = [1, 1.023373891996775, 1.0472941228206267, 1.0717734625362931, 1.096824979694626, 1.122462048309373, 1.148698354997035, 1.1755479062836087, 1.2030250360821166, 1.2311444133449163, 1.2599210498948732, 1.2893703084395791, 1.3195079107728942, 1.3503499461681898, 1.3819128799677758, 1.4142135623730947, 1.4472692374403777, 1.4810975522865637, 1.5157165665103975, 1.551144761833734, 1.587401051968199, 1.6245047927124705, 1.662475792285575, 1.7013343219017112, 1.7411011265922482, 1.7817974362806785, 1.8234449771164336, 1.866065983073615, 1.9096832078208332, 1.954319936868492, 2, 2.04674778399355, 2.0945882456412535, 2.1435469250725867, 2.1936499593892527, 2.244924096618747, 2.297396709994071, 2.351095812567219, 2.406050072164235, 2.4622888266898344, 2.5198420997897486, 2.578740616879161, 2.639015821545791, 2.7006998923363827, 2.7638257599355547, 2.8284271247461925, 2.8945384748807585, 2.9621951045731305, 3.0314331330207978, 3.102289523667471, 3.1748021039364005, 3.2490095854249432, 3.324951584571152, 3.4026686438034237, 3.4822022531844974, 3.5635948725613575, 3.646889954232867, 3.7321319661472296, 3.8193664156416656, 3.908639873736983, 3.999999999999999, 4.093495567987098, 4.189176491282505, 4.287093850145171, 4.387299918778502, 4.489848193237489, 4.594793419988137, 4.702191625134431, 4.812100144328463, 4.924577653379661, 5.039684199579487, 5.157481233758311, 5.2780316430915715, 5.401399784672753, 5.527651519871096, 5.656854249492371, 5.789076949761503, 5.924390209146247, 6.062866266041581, 6.204579047334927, 6.349604207872786, 6.498019170849871, 6.649903169142289, 6.805337287606831, 6.964404506368978, 7.127189745122698, 7.2937799084657176, 7.4642639322944415, 7.638732831283315, 7.817279747473951, 7.999999999999984, 8.186991135974184, 8.378352982565, 8.574187700290333, 8.774599837556996, 8.979696386474973, 9.18958683997627, 9.404383250268861, 9.624200288656926, 9.849155306759325];\n\n/***/ }),\n/* 47 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.calculatePhaseIncrement = calculatePhaseIncrement;\nexports.calculateRatioFrequency = calculateRatioFrequency;\nexports.calculateFixedFrequency = calculateFixedFrequency;\nexports.convertOperatorSettings = convertOperatorSettings;\n\nvar _constants = __webpack_require__(14);\n\nfunction calculatePhaseIncrement(frequency, sampleRate) {\n  return 2 * Math.PI * frequency / sampleRate;\n}\n\nfunction calculateRatioFrequency(coarse, fine) {\n  var ratio = Math.ceil(coarse * 13);\n\n  if (ratio === 0) {\n    ratio = 0.5;\n  }\n\n  ratio += fine >= 1.0 ? 0.99 : fine;\n\n  return ratio;\n}\n\nfunction calculateFixedFrequency(coarse, fine) {\n  var rate = Math.pow(10, Math.floor(coarse * 3));\n  var base = Math.floor(fine * 100);\n\n  if (base > 99) {\n    base = 99;\n  }\n\n  return _constants.FIXED_FREQUENCY_TABLE[base] * rate;\n}\n\nfunction convertOperatorSettings(setting, sampleRate) {\n  var algorithmId = setting.algorithmId,\n      feedback = setting.feedback;\n\n  var totalTime = 15 * sampleRate;\n  var operators = [];\n\n  var _loop = function _loop(i) {\n    var envelope = {\n      isLoop: setting.isLoop[i]\n    };\n\n    envelope.segments = setting.envelopes[i].map(function (segment, index) {\n      var length = void 0;\n      var step = void 0;\n\n      if (index === 0) {\n        // Attack\n        length = Math.pow(segment.x, 2) * totalTime;\n\n        if (length === 0) {\n          length = 1;\n        }\n\n        step = (1.0 - segment.y) / length;\n      } else if (index === 1) {\n        // Decay\n        var previousSegment = setting.envelopes[i][0];\n        length = Math.pow(segment.x - previousSegment.x, 2) * totalTime;\n\n        if (length === 0) {\n          length = 1;\n        }\n\n        step = -1 * (segment.y - previousSegment.y) / length;\n      } else if (index === 2) {\n        // Release\n        length = Math.pow(1.0 - segment.x, 2) * totalTime;\n\n        if (length === 0) {\n          length = 1;\n        }\n\n        step = -1 * (1.0 - segment.y) / length;\n      }\n\n      return {\n        length: length,\n        step: step\n      };\n    });\n\n    operators.push({\n      isFixed: setting.isFixed[i],\n      isVelocitySensitive: setting.isVelocitySensitive[i],\n      coarse: setting.coarse[i],\n      fine: setting.fine[i],\n      envelope: envelope\n    });\n  };\n\n  for (var i = 0; i < 4; i += 1) {\n    _loop(i);\n  }\n\n  return {\n    algorithmId: algorithmId,\n    feedback: feedback,\n    operators: operators\n  };\n}\n\n/***/ }),\n/* 48 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _Envelope = __webpack_require__(49);\n\nvar _Envelope2 = _interopRequireDefault(_Envelope);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Operator = function () {\n  function Operator() {\n    _classCallCheck(this, Operator);\n\n    this.envelope = new _Envelope2.default();\n\n    this.coarse = 0.0;\n    this.fine = 0.0;\n\n    this.isFixed = false;\n    this.isVelocitySensitive = false;\n\n    this._output = 0.0;\n    this._phase = 0.0;\n    this._phaseIncrement = 0.0;\n  }\n\n  _createClass(Operator, [{\n    key: 'next',\n    value: function next() {\n      return this.envelope.next();\n    }\n  }, {\n    key: 'noteOn',\n    value: function noteOn() {\n      return this.envelope.noteOn();\n    }\n  }, {\n    key: 'noteOff',\n    value: function noteOff() {\n      return this.envelope.noteOff();\n    }\n  }, {\n    key: 'changeEnvelope',\n    value: function changeEnvelope(settings) {\n      var _this = this;\n\n      this.envelope.isLoop = settings.isLoop;\n\n      settings.segments.forEach(function (setting, index) {\n        _this.envelope.changeSegment(index, setting);\n      });\n    }\n  }]);\n\n  return Operator;\n}();\n\nexports.default = Operator;\nmodule.exports = exports['default'];\n\n/***/ }),\n/* 49 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _EnvelopeSegment = __webpack_require__(50);\n\nvar _EnvelopeSegment2 = _interopRequireDefault(_EnvelopeSegment);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ENVELOPE_STATES = {\n  STOP: 0,\n  ATTACK: 1,\n  DECAY: 2,\n  SUSTAIN: 3,\n  RELEASE: 4,\n  DUMP: 5\n};\n\nvar Envelope = function () {\n  function Envelope() {\n    _classCallCheck(this, Envelope);\n\n    this.state = ENVELOPE_STATES.STOP;\n\n    this.amp = 0.0;\n    this.isLoop = false;\n\n    this.segments = [];\n\n    this.currentSegmentPosition = 0;\n    this.currentSegmentStep = 0.0;\n\n    this.onRelease = function () {\n      return true;\n    };\n\n    for (var i = 0; i < 3; i += 1) {\n      this.segments.push(new _EnvelopeSegment2.default());\n    }\n  }\n\n  _createClass(Envelope, [{\n    key: 'next',\n    value: function next() {\n      if (this.currentSegmentPosition <= 0) {\n        return;\n      }\n\n      this.amp += this.currentSegmentStep;\n      if (this.amp > 1.0) {\n        this.amp = 1.0;\n      }\n\n      this.currentSegmentPosition -= 1;\n\n      if (this.currentSegmentPosition <= 0) {\n        switch (this.state) {\n          case ENVELOPE_STATES.DUMP:\n            this.state = ENVELOPE_STATES.ATTACK;\n            this.currentSegmentStep = this.segments[0].step;\n            this.currentSegmentPosition = this.segments[0].length;\n            this.amp = 0.0;\n            break;\n          case ENVELOPE_STATES.ATTACK:\n            this.state = ENVELOPE_STATES.DECAY;\n            this.currentSegmentStep = this.segments[1].step;\n            this.currentSegmentPosition = this.segments[1].length;\n            break;\n          case ENVELOPE_STATES.DECAY:\n            if (!this.isLoop) {\n              this.state = ENVELOPE_STATES.SUSTAIN;\n              this.currentSegmentStep = 0.0;\n              this.currentSegmentPosition = 0;\n            } else {\n              this.state = ENVELOPE_STATES.ATTACK;\n              this.currentSegmentStep = this.segments[0].step;\n              this.currentSegmentPosition = this.segments[0].length;\n              this.amp = 0.0;\n            }\n            break;\n          case ENVELOPE_STATES.RELEASE:\n            this.state = ENVELOPE_STATES.STOP;\n            this.amp = 0.0;\n            if (this.onRelease) {\n              this.onRelease();\n            }\n            break;\n        }\n      }\n    }\n  }, {\n    key: 'noteOn',\n    value: function noteOn() {\n      if (this.state !== ENVELOPE_STATES.STOP) {\n        this.state = ENVELOPE_STATES.DUMP;\n        this.currentSegmentStep = -1 * this.amp / this.currentSegmentPosition;\n        this.currentSegmentPosition = 128;\n      } else {\n        this.state = ENVELOPE_STATES.ATTACK;\n        this.currentSegmentStep = this.segments[0].step;\n        this.currentSegmentPosition = this.segments[0].length;\n        this.amp = 0.0;\n      }\n    }\n  }, {\n    key: 'noteOff',\n    value: function noteOff() {\n      if (this.state !== ENVELOPE_STATES.STOP) {\n        this.state = ENVELOPE_STATES.RELEASE;\n        this.currentSegmentStep = -1 * this.amp / this.segments[2].length;\n        this.currentSegmentPosition = this.segments[2].length;\n      }\n    }\n  }, {\n    key: 'changeSegment',\n    value: function changeSegment(index, setting) {\n      if (index < 0 || index > this.segments.length - 1) {\n        throw new Error('Invalid segment index');\n      }\n\n      this.segments[index].length = setting.length;\n      this.segments[index].step = setting.step;\n    }\n  }]);\n\n  return Envelope;\n}();\n\nexports.default = Envelope;\nmodule.exports = exports['default'];\n\n/***/ }),\n/* 50 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar EnvelopeSegment = function EnvelopeSegment() {\n  _classCallCheck(this, EnvelopeSegment);\n\n  this.length = 0;\n  this.step = 0.0;\n};\n\nexports.default = EnvelopeSegment;\nmodule.exports = exports[\"default\"];\n\n/***/ }),\n/* 51 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar PRESETS = exports.PRESETS = {\n  BELL: {\n    name: 'BELL',\n    algorithmId: 4,\n    coarse: [0.04, 0.19, 0.06, 0.18],\n    feedback: 0.3,\n    fine: [0, 0.5, 0, 0.5],\n    isFixed: [false, false, false, false],\n    isLoop: [false, false, false, false],\n    isVelocitySensitive: [false, true, false, false],\n    envelopes: [[{ x: 0, y: 0.053 }, { x: 0.708, y: 0.741 }, { x: 0.708, y: 0.741 }], [{ x: 0, y: 0.435 }, { x: 0.741, y: 0.729 }, { x: 0.741, y: 0.729 }], [{ x: 0.004, y: 0.562 }, { x: 0.226, y: 0.832 }, { x: 0.708, y: 0.832 }], [{ x: 0.004, y: 0.461 }, { x: 0.281, y: 0.814 }, { x: 0.715, y: 0.814 }]]\n  },\n  BRASS: {\n    name: 'BRASS',\n    algorithmId: 0,\n    coarse: [0.04, 0.07, 0, 0.17],\n    feedback: 0.28,\n    fine: [0, 0, 0, 0],\n    isFixed: [false, false, false, false],\n    isLoop: [false, false, false, false],\n    isVelocitySensitive: [false, false, true, true],\n    envelopes: [[{ x: 0.102, y: 0.112 }, { x: 0.208, y: 0.324 }, { x: 0.9, y: 0.324 }], [{ x: 0.007, y: 0.747 }, { x: 0.219, y: 0.259 }, { x: 0.9, y: 0.259 }], [{ x: 0.073, y: 0.241 }, { x: 0.277, y: 0.476 }, { x: 0.9, y: 0.476 }], [{ x: 0, y: 0.594 }, { x: 0.161, y: 0.994 }, { x: 0.9, y: 0.994 }]]\n  },\n  ORGAN: {\n    name: 'ORGAN',\n    algorithmId: 7,\n    coarse: [0, 0.11, 0.04, 0.25],\n    feedback: 0.16,\n    fine: [0, 0, 0, 0],\n    isFixed: [false, false, false, false],\n    isLoop: [false, false, false, false],\n    isVelocitySensitive: [false, false, false, false],\n    envelopes: [[{ x: 0.04, y: 0.012 }, { x: 0.215, y: 0 }, { x: 0.9, y: 0 }], [{ x: 0.047, y: 0.006 }, { x: 0.168, y: 0.006 }, { x: 0.9, y: 0.006 }], [{ x: 0.077, y: 0.076 }, { x: 0.161, y: 0 }, { x: 0.836, y: 0 }], [{ x: 0.088, y: 0.141 }, { x: 0.223, y: 0.006 }, { x: 0.9, y: 0.006 }]]\n  },\n  CHIME: {\n    name: 'CHIME',\n    algorithmId: 1,\n    coarse: [0.28, 0.07, 0.66, 0.05],\n    feedback: 0.3,\n    fine: [0.29, 0, 0, 0],\n    isFixed: [true, false, false, false],\n    isLoop: [false, false, false, true],\n    isVelocitySensitive: [false, false, true, false],\n    envelopes: [[{ x: 0.004, y: 0 }, { x: 0.752, y: 0.653 }, { x: 0.752, y: 0.653 }], [{ x: 0, y: 0.524 }, { x: 0.285, y: 0.7 }, { x: 0.752, y: 0.7 }], [{ x: 0, y: 0.829 }, { x: 0.288, y: 0.994 }, { x: 0.9, y: 0.994 }], [{ x: 0.077, y: 0.824 }, { x: 0.161, y: 0.994 }, { x: 0.9, y: 0.994 }]]\n  },\n  PAD: {\n    name: 'PAD',\n    algorithmId: 4,\n    coarse: [0.05, 0.07, 0.13, 0.05],\n    feedback: 0.94,\n    fine: [0, 0, 0.33, 0.5],\n    isFixed: [false, false, true, false],\n    isLoop: [false, false, false, false],\n    isVelocitySensitive: [false, false, false, false],\n    envelopes: [[{ x: 0.062, y: 0.106 }, { x: 0.237, y: 0 }, { x: 0.752, y: 0 }], [{ x: 0.139, y: 0.776 }, { x: 0.328, y: 0.741 }, { x: 0.752, y: 0.741 }], [{ x: 0.131, y: 0.5 }, { x: 0.354, y: 0.288 }, { x: 0.704, y: 0.288 }], [{ x: 0.077, y: 0.618 }, { x: 0.201, y: 0.524 }, { x: 0.741, y: 0.524 }]]\n  },\n  EG_LOOPER: {\n    name: 'EG_LOOPER',\n    algorithmId: 4,\n    coarse: [0.19, 0.41, 0.24, 0.14],\n    feedback: 0.58,\n    fine: [0, 0, 0, 0.5],\n    isFixed: [false, false, false, false],\n    isLoop: [true, true, true, true],\n    isVelocitySensitive: [false, false, false, false],\n    envelopes: [[{ x: 0.212, y: 0.253 }, { x: 0.423, y: 0.994 }, { x: 0.752, y: 0.994 }], [{ x: 0.142, y: 0.541 }, { x: 0.281, y: 0.982 }, { x: 0.752, y: 0.982 }], [{ x: 0.354, y: 0.106 }, { x: 0.704, y: 0.994 }, { x: 0.704, y: 0.994 }], [{ x: 0.423, y: 0.276 }, { x: 0.861, y: 0.994 }, { x: 0.861, y: 0.994 }]]\n  },\n  GUITAR: {\n    name: 'GUITAR',\n    algorithmId: 0,\n    coarse: [0, 0.05, 0.17, 0.59],\n    feedback: 0.19,\n    fine: [0, 0.5, 0.5, 0],\n    isFixed: [false, false, false, false],\n    isLoop: [false, false, false, false],\n    isVelocitySensitive: [false, false, false, true],\n    envelopes: [[{ x: 0, y: 0.047 }, { x: 0.314, y: 0.994 }, { x: 0.752, y: 0.994 }], [{ x: 0, y: 0.735 }, { x: 0.423, y: 0.788 }, { x: 0.847, y: 0.788 }], [{ x: 0, y: 0.488 }, { x: 0.058, y: 0.794 }, { x: 0.73, y: 0.794 }], [{ x: 0, y: 0.665 }, { x: 0.069, y: 0.818 }, { x: 0.734, y: 0.818 }]]\n  },\n  EG_SEQ: {\n    name: 'EG_SEQ',\n    algorithmId: 2,\n    coarse: [0.05, 0, 0.29, 0.14],\n    feedback: 0.36,\n    fine: [0, 0, 0, 0],\n    isFixed: [false, false, false, false],\n    isLoop: [true, false, false, true],\n    isVelocitySensitive: [false, false, false, false],\n    envelopes: [[{ x: 0.004, y: 0.029 }, { x: 0.109, y: 0.994 }, { x: 0.9, y: 0.994 }], [{ x: 0.004, y: 0.488 }, { x: 0.982, y: 0.994 }, { x: 0.982, y: 0.994 }], [{ x: 0.004, y: 0.506 }, { x: 0.124, y: 0.988 }, { x: 0.836, y: 0.988 }], [{ x: 0.434, y: 0.176 }, { x: 0.869, y: 0.988 }, { x: 0.9, y: 0.988 }]]\n  },\n  INIT_VOICE: {\n    name: 'INIT_VOICE',\n    algorithmId: 0,\n    coarse: [0.05, 0.05, 0.05, 0.05],\n    feedback: 0,\n    fine: [0, 0, 0, 0],\n    isFixed: [false, false, false, false],\n    isLoop: [false, false, false, false],\n    isVelocitySensitive: [false, false, false, false],\n    envelopes: [[{ x: 0, y: 0.2 }, { x: 0.5, y: 0.2 }, { x: 1, y: 0.2 }], [{ x: 0, y: 1 }, { x: 0.5, y: 1 }, { x: 1, y: 1 }], [{ x: 0, y: 1 }, { x: 0.5, y: 1 }, { x: 1, y: 1 }], [{ x: 0, y: 1 }, { x: 0.5, y: 1 }, { x: 1, y: 1 }]]\n  }\n};\n\n/***/ }),\n/* 52 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _peerjs = __webpack_require__(15);\n\nvar _peerjs2 = _interopRequireDefault(_peerjs);\n\nvar _timesync = __webpack_require__(19);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar CHECK_MISSING_PEERS_FREQUENCY = 10000;\nvar PEER_ID_KEY = 'automaton-peer';\n\nfunction getPeerString(id) {\n  return PEER_ID_KEY + '-' + id;\n}\n\nfunction getAllPeers(clientsNumber, ownId) {\n  var peers = [];\n\n  for (var id = 1; id < clientsNumber + 1; id += 1) {\n    if (ownId !== id) {\n      peers.push(getPeerString(id));\n    }\n  }\n\n  return peers;\n}\n\nvar defaultOptions = {\n  onClose: function onClose() {},\n  onCloseRemote: function onCloseRemote() {},\n  onError: function onError() {},\n  onOpen: function onOpen() {},\n  onOpenRemote: function onOpenRemote() {},\n  onReceive: function onReceive() {},\n  onSyncTick: function onSyncTick() {},\n  syncInterval: 5000,\n  syncTickFrequency: 10\n};\n\nvar Network = function () {\n  function Network(options) {\n    _classCallCheck(this, Network);\n\n    this.options = Object.assign({}, defaultOptions, options);\n\n    this.lastCheckedDate = new Date();\n    this.offset = 0;\n    this.peer = null;\n    this.peers = [];\n    this.sync = null;\n    this.syncInterval = null;\n    this.syncTickInterval = null;\n  }\n\n  _createClass(Network, [{\n    key: 'connect',\n    value: function connect(configuration) {\n      var _this = this;\n\n      if (this.peer && this.peer.open) {\n        this.options.onError(new Error('Connection is already open'));\n        return false;\n      }\n\n      var serverHost = configuration.serverHost,\n          serverKey = configuration.serverKey;\n\n\n      var peerId = parseInt(configuration.peerId, 10);\n      var clientsNumber = parseInt(configuration.clientsNumber, 10);\n      var serverPort = parseInt(configuration.serverPort, 10);\n\n      if (peerId < 1 || peerId > clientsNumber) {\n        this.options.onError(new Error('Invalid peer id'));\n        return false;\n      }\n\n      this.peers = getAllPeers(clientsNumber, peerId);\n      this.lastCheckedDate = new Date();\n\n      var setupConnection = function setupConnection(connection) {\n        if (_this.peer.connections[connection.id]) {\n          var isAlreadyOpen = _this.peer.connections[connection.id].find(function (remoteConnection) {\n            return remoteConnection.open;\n          });\n\n          if (isAlreadyOpen) {\n            return;\n          }\n        }\n\n        connection.on('open', function () {\n          _this.options.onOpenRemote(connection.peer);\n        }).on('data', function (data) {\n          if (data.jsonrpc) {\n            _this.sync.receive(connection.peer, data);\n          } else {\n            _this.options.onReceive(connection.peer, data);\n          }\n        }).on('close', function () {\n          _this.options.onCloseRemote(connection.peer);\n        }).on('error', function (err) {\n          _this.options.onError(err);\n        });\n      };\n\n      var connectToPeers = function connectToPeers() {\n        _this.peers.filter(function (id) {\n          return !(id in _this.peer.connections);\n        }).forEach(function (id) {\n          var connection = _this.peer.connect(id, {\n            serialization: 'json'\n          });\n          setupConnection(connection);\n        });\n      };\n\n      this.peer = new _peerjs2.default(getPeerString(peerId), {\n        host: serverHost,\n        key: serverKey,\n        port: serverPort\n      });\n\n      this.peer.on('open', function () {\n        connectToPeers();\n        _this.options.onOpen();\n      });\n\n      this.peer.on('connection', function (connection) {\n        setupConnection(connection);\n      });\n\n      this.peer.on('disconnected', function () {\n        _this.peer.destroy();\n        _this.sync.destroy();\n      });\n\n      this.peer.on('close', function () {\n        _this.options.onClose();\n      });\n\n      this.peer.on('error', function (err) {\n        _this.options.onError(err);\n\n        if (err.type !== 'disconnected' && err.type !== 'peer-unavailable') {\n          _this.disconnect(true);\n        }\n      });\n\n      // Time synchronization between peers\n      this.sync = (0, _timesync.create)({\n        delay: 100,\n        interval: this.options.syncInterval,\n        peers: [],\n        timeout: 10000\n      });\n\n      this.sync.send = function (id, data) {\n        _this.send(id, data);\n      };\n\n      this.sync.on('sync', function (state) {\n        if (state === 'start') {\n          var openConnections = Object.keys(_this.peer.connections).filter(function (id) {\n            return _this.peer.connections[id].some(function (connection) {\n              return connection.open;\n            });\n          });\n\n          _this.sync.options.peers = openConnections;\n        } else if (state === 'end') {\n          _this.sync.options.peers = [];\n        }\n      });\n\n      this.sync.on('change', function (offset) {\n        _this.offset = offset;\n      });\n\n      // Check for missing connections\n      this.syncInterval = setInterval(connectToPeers, CHECK_MISSING_PEERS_FREQUENCY);\n\n      // Start synchronized ticking\n      this.syncTickInterval = setInterval(function () {\n        var syncDate = new Date(_this.sync.now());\n        if (syncDate.getSeconds() !== _this.lastCheckedDate.getSeconds()) {\n          _this.options.onSyncTick(_this.offset);\n          _this.lastCheckedDate = syncDate;\n        }\n      }, this.options.syncTickFrequency);\n\n      return true;\n    }\n  }, {\n    key: 'disconnect',\n    value: function disconnect() {\n      var isForced = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n      if (!isForced && (!this.peer || !this.peer.open)) {\n        throw new Error('Connection is already closed');\n      }\n\n      this.peer.disconnect();\n\n      clearInterval(this.syncInterval);\n      clearInterval(this.syncTickInterval);\n\n      this.syncTickInterval = null;\n      this.syncInterval = null;\n    }\n  }, {\n    key: 'sendToAll',\n    value: function sendToAll(data) {\n      var _this2 = this;\n\n      this.peers.forEach(function (id) {\n        _this2.send(id, data);\n      });\n    }\n  }, {\n    key: 'send',\n    value: function send(id, data) {\n      var all = this.peer.connections[id];\n      var connection = all && all.filter(function (remoteConnection) {\n        return remoteConnection.open;\n      })[0];\n\n      if (connection) {\n        connection.send(data);\n      }\n    }\n  }]);\n\n  return Network;\n}();\n\nexports.default = Network;\nmodule.exports = exports['default'];\n\n/***/ }),\n/* 53 */,\n/* 54 */,\n/* 55 */,\n/* 56 */,\n/* 57 */,\n/* 58 */,\n/* 59 */,\n/* 60 */,\n/* 61 */,\n/* 62 */,\n/* 63 */,\n/* 64 */,\n/* 65 */,\n/* 66 */,\n/* 67 */,\n/* 68 */,\n/* 69 */,\n/* 70 */,\n/* 71 */,\n/* 72 */,\n/* 73 */,\n/* 74 */,\n/* 75 */,\n/* 76 */,\n/* 77 */,\n/* 78 */,\n/* 79 */,\n/* 80 */,\n/* 81 */,\n/* 82 */,\n/* 83 */,\n/* 84 */,\n/* 85 */,\n/* 86 */,\n/* 87 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar STORAGE_KEY = 'automaton';\n\nfunction loadFromStorage() {\n  var storage = window.localStorage.getItem(STORAGE_KEY);\n  return storage ? JSON.parse(storage) : {};\n}\n\nfunction saveToStorage(configuration) {\n  window.localStorage.setItem(STORAGE_KEY, JSON.stringify(configuration));\n}\n\nvar defaultConfiguration = {\n  clientsNumber: 4,\n  peerId: 1,\n  serverHost: '0.peerjs.com',\n  serverKey: 'gs5wl7sq2cblnmi',\n  serverPort: 9000\n};\n\nvar Settings = function () {\n  function Settings() {\n    _classCallCheck(this, Settings);\n\n    this.configuration = Object.assign({}, defaultConfiguration, loadFromStorage());\n  }\n\n  _createClass(Settings, [{\n    key: 'update',\n    value: function update(id, value) {\n      this.configuration[id] = value;\n      saveToStorage(this.configuration);\n    }\n  }, {\n    key: 'getConfiguration',\n    value: function getConfiguration() {\n      return this.configuration;\n    }\n  }]);\n\n  return Settings;\n}();\n\nexports.default = Settings;\nmodule.exports = exports['default'];\n\n/***/ }),\n/* 88 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ERROR_MESSAGES_LIMIT = 3;\n\nvar VIEW_IDS = ['main-view', 'settings-view'];\n\nvar INITIAL_VIEW = 'settings-view';\n\nvar View = function () {\n  function View() {\n    _classCallCheck(this, View);\n\n    this.allFormElems = document.querySelectorAll('form input');\n    this.connectButtonElem = document.getElementById('connect-button');\n    this.connectedPeersElem = document.getElementById('connected-peers');\n    this.disconnectButtonElem = document.getElementById('disconnect-button');\n    this.errorMessagesElem = document.getElementById('error-messages');\n    this.offsetMonitorElem = document.getElementById('offset-monitor');\n    this.tickElem = document.getElementById('tick');\n\n    this.errorMessages = [];\n\n    this.changeView(VIEW_IDS.indexOf(INITIAL_VIEW));\n  }\n\n  _createClass(View, [{\n    key: 'changeConnectionState',\n    value: function changeConnectionState(isLoading, isConnected) {\n      this.connectButtonElem.disabled = isLoading || isConnected;\n      this.disconnectButtonElem.disabled = isLoading || !isConnected;\n\n      for (var i = 0; i < this.allFormElems.length; i++) {\n        this.allFormElems[i].disabled = isLoading || isConnected;\n      }\n    }\n  }, {\n    key: 'updateSettings',\n    value: function updateSettings(configuration) {\n      Object.keys(configuration).forEach(function (id) {\n        var inputElement = document.getElementById(id);\n        if (inputElement) {\n          inputElement.value = configuration[id];\n        }\n      });\n    }\n  }, {\n    key: 'updateOffset',\n    value: function updateOffset(offset) {\n      this.offsetMonitorElem.innerText = offset.toFixed(1) + ' ms';\n    }\n  }, {\n    key: 'addErrorMessage',\n    value: function addErrorMessage(message) {\n      var _this = this;\n\n      this.errorMessages.push({\n        timestamp: new Date(),\n        message: message\n      });\n\n      if (this.errorMessages.length > ERROR_MESSAGES_LIMIT) {\n        this.errorMessages.shift();\n      }\n\n      this.errorMessagesElem.innerHTML = '';\n\n      this.errorMessages.forEach(function (error) {\n        var errorMessageElem = document.createElement('div');\n        var formattedTime = error.timestamp.toISOString();\n        errorMessageElem.innerText = formattedTime + ' ' + error.message;\n\n        _this.errorMessagesElem.appendChild(errorMessageElem);\n      });\n    }\n  }, {\n    key: 'addRemotePeer',\n    value: function addRemotePeer(peerId) {\n      var peerElem = document.createElement('div');\n      peerElem.class = 'connected-peer';\n      peerElem.innerText = peerId;\n      peerElem.id = peerId;\n\n      this.connectedPeersElem.appendChild(peerElem);\n    }\n  }, {\n    key: 'removeRemotePeer',\n    value: function removeRemotePeer(peerId) {\n      var peerElem = document.getElementById(peerId);\n      this.connectedPeersElem.removeChild(peerElem);\n    }\n  }, {\n    key: 'changeView',\n    value: function changeView(viewIndex) {\n      if (viewIndex < 0 || viewIndex > VIEW_IDS.length - 1) {\n        return;\n      }\n\n      VIEW_IDS.forEach(function (viewId) {\n        document.getElementById(viewId).classList.remove('view--active');\n      });\n\n      var nextViewId = VIEW_IDS[viewIndex];\n      document.getElementById(nextViewId).classList.add('view--active');\n    }\n  }, {\n    key: 'tick',\n    value: function tick() {\n      var _this2 = this;\n\n      this.tickElem.classList.add('tick--active');\n      setTimeout(function () {\n        _this2.tickElem.classList.remove('tick--active');\n      }, 500);\n    }\n  }]);\n\n  return View;\n}();\n\nexports.default = View;\nmodule.exports = exports['default'];\n\n/***/ })\n],[34]);\n\n\n// WEBPACK FOOTER //\n// automaton.bundle.js","export { ALGORITHMS } from './algorithms'\nexport { FIXED_FREQUENCY_TABLE } from './fixedFrequencyTable'\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/synthesizer/constants/index.js","import styles from '../styles/index.scss' // eslint-disable-line no-unused-vars\n\nimport Debug from './Debug'\nimport Network from './network'\nimport Settings from './Settings'\nimport View from './View'\n\nconst debug = new Debug()\nconst settings = new Settings()\nconst view = new View()\n\nconst network = new Network({\n  onOpen: () => {\n    view.changeConnectionState(false, true)\n  },\n  onClose: () => {\n    view.changeConnectionState(false, false)\n  },\n  onOpenRemote: peerId => {\n    view.addRemotePeer(peerId)\n  },\n  onCloseRemote: peerId => {\n    view.removeRemotePeer(peerId)\n  },\n  onSyncTick: offset => {\n    view.updateOffset(offset)\n    view.tick()\n  },\n  // onReceive: (peer, data) => {\n  //   console.log('receive', peer, data)\n  // },\n  onError: err => {\n    view.addErrorMessage(err.message)\n  },\n})\n\n// Initialize\nwindow.addEventListener('load', () => {\n  view.changeConnectionState(false, false)\n  view.updateSettings(settings.getConfiguration())\n})\n\n// Expose some interfaces to the view\nwindow.automaton = window.automaton || {\n  network: {\n    connect: (event) => {\n      event.preventDefault()\n\n      if (network.connect(settings.getConfiguration())) {\n        view.changeConnectionState(true, false)\n      }\n    },\n    disconnect: (event) => {\n      event.preventDefault()\n\n      view.changeConnectionState(true, true)\n      network.disconnect()\n    },\n    send: (data) => {\n      network.sendToAll(data)\n    },\n  },\n  settings: {\n    update: (event) => {\n      const { id, value } = event.target\n      settings.update(id, value)\n    },\n  },\n  debug,\n}\n\n// Main keyboard control strokes\nwindow.addEventListener('keydown', (event) => {\n  const { keyCode, shiftKey } = event\n  if (shiftKey) {\n    view.changeView(keyCode - 49)\n  }\n})\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/index.js","import styles from '../styles/index.scss' // eslint-disable-line no-unused-vars\n\nimport Instrument from './instrument'\nimport { PRESETS } from './instrument/presets'\n\nexport default class TestInterface {\n  constructor() {\n    this.instrument = new Instrument({\n      preset: PRESETS.BELL,\n      noteMaterial: [\n        62,\n        65,\n        70,\n        72,\n        74,\n      ],\n    })\n  }\n\n  changePattern(notePattern, durationPattern, bpm, velocity, octave) {\n    this.instrument.changePattern(\n      notePattern,\n      durationPattern,\n      bpm,\n      velocity,\n      octave\n    )\n  }\n\n  start() {\n    this.instrument.start()\n  }\n\n  stop() {\n    this.instrument.stop()\n  }\n\n  noteOn(note, velocity) {\n    this.instrument.synthesizerInterface.noteOn(note, velocity)\n  }\n\n  noteOff(note) {\n    this.instrument.synthesizerInterface.noteOff(note)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/Debug.js","import Gamelan from './gamelan'\nimport SynthesizerInterface from './SynthesizerInterface'\n\nexport default class Instrument {\n  constructor(options = {}) {\n    const { noteMaterial, preset } = options\n\n    this.synthesizerInterface = new SynthesizerInterface({\n      preset,\n    })\n\n    this.gamelan = new Gamelan({\n      noteMaterial,\n      synthesizerInterface: this.synthesizerInterface,\n    })\n  }\n\n  changePreset(preset) {\n    this.synthesizerInterface.preset = preset\n  }\n\n  changePattern(notePattern, durationPattern, bpm, velocity, octave) {\n    this.gamelan.changePattern(notePattern, durationPattern, {\n      bpm,\n      octave,\n      velocity,\n    })\n  }\n\n  start() {\n    this.gamelan.start()\n  }\n\n  stop() {\n    this.gamelan.stop()\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/index.js","import { symbolsToPattern } from './patternHelpers'\n\nconst defaultSettings = {\n  bpm: 120,\n  velocity: 1.0,\n  octave: 0,\n}\n\nexport default class Gamelan {\n  constructor(options) {\n    const { noteMaterial, synthesizerInterface } = options\n\n    this.noteMaterial = noteMaterial\n    this.synthesizerInterface = synthesizerInterface\n\n    this.settings = defaultSettings\n\n    this.currentPartIndex = 0\n    this.currentPart = null\n    this.pattern = []\n\n    this.timeout = null\n    this.isRunning = false\n  }\n\n  playNext() {\n    if (this.pattern.length === 0) {\n      return\n    }\n\n    const {\n      duration,\n      note,\n      velocity,\n    } = this.pattern[this.currentPartIndex]\n\n    if (note) {\n      this.synthesizerInterface.noteOn(\n        note,\n        velocity\n      )\n    }\n\n    this.timeout = setTimeout(() => {\n      if (!this.isRunning) {\n        return\n      }\n\n      if (this.pattern.length === 0) {\n        return\n      }\n\n      if (note) {\n        this.synthesizerInterface.noteOff(note)\n      }\n\n      this.currentPartIndex += 1\n\n      if (this.currentPartIndex >= this.pattern.length - 1) {\n        this.currentPartIndex = 0\n      }\n\n      this.playNext()\n    }, duration)\n  }\n\n  start() {\n    if (this.isRunning) {\n      throw new Error('Gamelan is already running')\n    }\n\n    this.currentPartIndex = 0\n    this.isRunning = true\n\n    this.playNext()\n  }\n\n  stop() {\n    if (!this.isRunning) {\n      throw new Error('Gamelan is already stopped')\n    }\n\n    clearTimeout(this.timeout)\n\n    this.synthesizerInterface.allNotesOff()\n\n    this.timeout = null\n    this.isRunning = false\n  }\n\n  changePattern(notePattern, durationPattern, settings = {}) {\n    this.settings = Object.assign({}, this.settings, settings)\n\n    this.pattern = symbolsToPattern(\n      notePattern,\n      durationPattern,\n      this.settings,\n      this.noteMaterial\n    )\n\n    if (this.isRunning) {\n      clearTimeout(this.timeout)\n\n      this.currentPartIndex = 0\n      this.synthesizerInterface.allNotesOff()\n\n      this.playNext()\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/gamelan/index.js","const DURATIONS = {\n  '.': 16,\n  '_': 8,\n  '-': 4,\n  '/': 2,\n  '#': 1,\n}\n\nconst MINUTE_IN_MS = 60000\nconst PAUSE_SYMBOL = '*'\n\nfunction bpmToMs(bpm, duration) {\n  return (MINUTE_IN_MS / bpm) * (1 / duration) * 4\n}\n\nexport function symbolsToPattern(notePattern, durationPattern, settings, noteMaterial) {\n  if (notePattern.length !== durationPattern.length) {\n    throw new Error('Notes and duration string need the same length')\n  }\n\n  const { octave, bpm, velocity } = settings\n  const notes = notePattern.split('')\n  const durations = durationPattern.split('')\n\n  return notes.map((noteSymbol, index) => {\n    const durationSymbol = durations[index]\n\n    if (!Object.keys(DURATIONS).includes(durationSymbol)) {\n      throw new Error('Unknown duration symbol')\n    }\n\n    const duration = bpmToMs(bpm, DURATIONS[durationSymbol])\n    let note = null\n\n    if (noteSymbol !== PAUSE_SYMBOL) {\n      const noteNumber = parseInt(noteSymbol, 10)\n\n      if (\n        isNaN(noteNumber) ||\n        noteNumber < 1 ||\n        noteNumber > noteMaterial.length\n      ) {\n        throw new Error('Unknown note symbol')\n      }\n\n      note = noteMaterial[noteNumber - 1] + (12 * octave)\n    }\n\n    return {\n      note,\n      duration,\n      velocity,\n    }\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/gamelan/patternHelpers.js","import AudioInterface from './AudioInterface'\nimport Channel from './Channel'\nimport Synthesizer from './synthesizer'\n\nconst DEFAULT_NOTE = 72\nconst DEFAULT_VELOCITY = 1.0\n\nexport default class SynthesizerInterface {\n  constructor(options = {}) {\n    this.audio = new AudioInterface()\n    this.channels = []\n    this.preset = options.preset\n  }\n\n  changePreset(preset) {\n    this.preset = preset\n  }\n\n  noteOn(note = DEFAULT_NOTE, velocity = DEFAULT_VELOCITY) {\n    // Create FM synthesizer\n    const synthesizer = new Synthesizer({\n      preset: this.preset,\n      sampleRate: this.audio.context.sampleRate,\n    })\n\n    // Create a channel for audio\n    const channel = new Channel(this.audio, synthesizer, note)\n    channel.start()\n    this.channels.push(channel)\n\n    // Play the note\n    synthesizer.noteOn(note, velocity)\n  }\n\n  noteOff(note = DEFAULT_NOTE) {\n    const index = this.channels.findIndex(channel => {\n      return channel.note === note\n    })\n\n    if (index === -1) {\n      throw new Error('Could not find that note')\n    }\n\n    const removedChannel = this.channels[index]\n\n    removedChannel.note = null\n\n    removedChannel.synthesizer.noteOff()\n      .then(() => {\n        removedChannel.stop()\n\n        this.channels.splice(\n          this.channels.findIndex(channel => {\n            return channel === removedChannel\n          }), 1\n        )\n      })\n  }\n\n  allNotesOff() {\n    this.channels.forEach(channel => {\n      if (channel.note) {\n        this.noteOff(channel.note)\n      }\n    })\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/SynthesizerInterface.js","import impulseUrl from '../../assets/impulse.wav'\n\nfunction getImpulse(context) {\n  return new Promise((resolve, reject) => {\n    const ajaxRequest = new XMLHttpRequest()\n    ajaxRequest.open('GET', impulseUrl, true)\n    ajaxRequest.responseType = 'arraybuffer'\n\n    ajaxRequest.onload = () => {\n      const impulseData = ajaxRequest.response\n      context.decodeAudioData(impulseData, buffer => {\n        resolve(buffer)\n      }, (err) => {\n        reject(err)\n      })\n    }\n\n    ajaxRequest.send()\n  })\n}\n\nexport default class AudioInterface {\n  constructor() {\n    // Create audio context\n    this.context = new AudioContext()\n\n    // Reverb\n    this.convolverNode = this.context.createConvolver()\n    this.convolverNode.loop = true\n    this.convolverNode.normalize = true\n\n    getImpulse(this.context)\n      .then(buffer => {\n        this.convolverNode.buffer = buffer\n      })\n\n    // Compressor\n    this.compressorNode = this.context.createDynamicsCompressor()\n\n    // Gain\n    this.currentVolume = 1\n    this.gainNode = this.context.createGain()\n    this.gainNode.gain.value = this.currentVolume\n\n    this.compressorNode.connect(this.convolverNode)\n    this.convolverNode.connect(this.gainNode)\n    this.gainNode.connect(this.context.destination)\n  }\n\n  changeVolume(volume) {\n    this.gainNode.gain.value = volume\n    this.currentVolume = volume\n  }\n\n  mute() {\n    this.gainNode.gain.value = 0\n  }\n\n  unmute() {\n    this.gainNode.gain.value = this.currentVolume\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/AudioInterface.js","module.exports = __webpack_public_path__ + \"cce8145a91d99c7379b34bf23fce576a.wav\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./automaton/assets/impulse.wav\n// module id = 42\n// module chunks = 0","export default class Channel {\n  constructor(audioInterface, synthesizer, note) {\n    this.audioInterface = audioInterface\n    this.isRunning = false\n    this.note = note\n    this.scriptProcessorNode = null\n    this.synthesizer = synthesizer\n  }\n\n  start() {\n    if (this.isRunning) {\n      throw new Error('Channel was already started')\n    }\n\n    const { context, compressorNode } = this.audioInterface\n    this.scriptProcessorNode = context.createScriptProcessor()\n\n    const bufferSourceNode = context.createBufferSource()\n    bufferSourceNode.start(0)\n\n    // Connect audio nodes\n    bufferSourceNode.connect(this.scriptProcessorNode)\n    this.scriptProcessorNode.connect(compressorNode)\n\n    // Start FM synthesis\n    this.scriptProcessorNode.onaudioprocess = (event) => {\n      const left = event.outputBuffer.getChannelData(0)\n      const right = event.outputBuffer.getChannelData(1)\n\n      this.synthesizer.generateAudio(left, right)\n    }\n\n    this.isRunning = true\n  }\n\n  stop() {\n    if (!this.isRunning) {\n      throw new Error('Channel was already stopped')\n    }\n\n    this.scriptProcessorNode.disconnect()\n    this.isRunning = false\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/Channel.js","import { ALGORITHMS } from './constants'\n\nimport {\n  calculateFixedFrequency,\n  calculatePhaseIncrement,\n  calculateRatioFrequency,\n  convertOperatorSettings,\n} from './helpers'\n\nimport Operator from './Operator'\n\nconst DEFAULT_SAMPLE_RATE = 16000\n\nexport default class Synthesizer {\n  constructor(options = {}) {\n    if (!options || !options.preset) {\n      throw new Error('Preset option is not set')\n    }\n\n    this.sampleRate = options.sampleRate || DEFAULT_SAMPLE_RATE\n\n    this.velocity = 1.0\n    this.feedback = 0.0\n\n    this.algorithmId = 0\n    this.operators = []\n\n    for (let i = 0; i < 4; i += 1) {\n      this.operators.push(new Operator())\n    }\n\n    this.changePreset(options.preset)\n  }\n\n  generateAudio(left, right) {\n    const numSamples = left.length\n    const algorithm = ALGORITHMS[this.algorithmId]\n\n    for (let sampleIndex = 0; sampleIndex < numSamples; sampleIndex += 1) {\n      let mainOutput = 0\n\n      for (let op = this.operators.length - 1; op >= 0; op -= 1) {\n        let modOutput = 0\n        const operator = this.operators[op]\n\n        this.operators.forEach((item, index) => {\n          modOutput += algorithm[op][index] * this.operators[index]._output\n        })\n\n        modOutput *= 10\n\n        if (op === 3) {\n          modOutput += operator._output * this.feedback * 3\n        }\n\n        const amp = operator.envelope.amp\n        operator._output = Math.sin(operator._phase + modOutput) * amp * amp\n\n        if (operator.isVelocitySensitive) {\n          operator._output *= this.velocity\n        }\n\n        operator._phase += operator._phaseIncrement\n\n        mainOutput += operator._output * algorithm[4][op]\n      }\n\n      right[sampleIndex] = left[sampleIndex] = mainOutput\n\n      this.operators.forEach(operator => {\n        operator.next()\n      })\n    }\n  }\n\n  noteOn(note, velocity) {\n    this.velocity = velocity\n\n    this.operators.forEach(operator => {\n      let frequency\n\n      if (operator.isFixed) {\n        frequency = calculateFixedFrequency(\n          operator.coarse,\n          operator.fine\n        )\n\n        operator._phaseIncrement = calculatePhaseIncrement(\n          frequency,\n          this.sampleRate\n        )\n      } else {\n        frequency = calculateRatioFrequency(\n          operator.coarse,\n          operator.fine\n        )\n\n        operator._phaseIncrement = calculatePhaseIncrement(\n          440 * Math.pow(2.0, (note - 69) / 12.0),\n          this.sampleRate\n        ) * frequency\n      }\n\n      operator._phase = 0.0\n      operator._output = 0.0\n    })\n\n    this.operators.forEach(operator => {\n      operator.noteOn()\n    })\n  }\n\n  noteOff() {\n    return new Promise(resolve => {\n      let counter = this.operators.length\n\n      this.operators.forEach(operator => {\n        operator.envelope.onRelease = () => {\n          counter -= 1\n          if (counter === 0) {\n            resolve()\n          }\n        }\n\n        operator.noteOff()\n      })\n    })\n  }\n\n  changeOperator(index, setting) {\n    if (index < 0 || index > this.operators.length - 1) {\n      return\n    }\n\n    this.operators[index].coarse = setting.coarse\n    this.operators[index].fine = setting.fine\n\n    this.operators[index].isFixed = setting.isFixed\n    this.operators[index].isVelocitySensitive = setting.isVelocitySensitive\n\n    this.operators[index].changeEnvelope(setting.envelope)\n  }\n\n  changePreset(preset) {\n    const convertedPreset = convertOperatorSettings(\n      preset,\n      this.sampleRate\n    )\n\n    this.feedback = convertedPreset.feedback\n    this.algorithmId = convertedPreset.algorithmId\n\n    convertedPreset.operators.forEach((setting, index) => {\n      this.changeOperator(index, setting)\n    })\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/synthesizer/index.js","export const ALGORITHMS = [\n  [\n    // OP1 OP2 OP3 OP4 = MOD\n    [  0,  1,  0,  0 ], // OP1\n    [  0,  0,  1,  0 ], // OP2\n    [  0,  0,  0,  1 ], // OP3\n    [  0,  0,  0,  0 ], // OP4\n    [  1,  0,  0,  0 ], // carrier\n  ],\n  [\n    // OP1 OP2 OP3 OP4\n    [  0,  1,  0,  0 ], // OP1\n    [  0,  0,  1,  1 ], // OP2\n    [  0,  0,  0,  0 ], // OP3\n    [  0,  0,  0,  0 ], // OP4\n    [  1,  0,  0,  0 ], // carrier\n  ],\n  [\n    // OP1 OP2 OP3 OP4\n    [  0,  1,  0,  1 ], // OP1\n    [  0,  0,  1,  0 ], // OP2\n    [  0,  0,  0,  0 ], // OP3\n    [  0,  0,  0,  0 ], // OP4\n    [  1,  0,  0,  0 ], // carrier\n  ],\n  [\n    // OP1 OP2 OP3 OP4\n    [  0,  1,  1,  0 ], // OP1\n    [  0,  0,  0,  0 ], // OP2\n    [  0,  0,  0,  1 ], // OP3\n    [  0,  0,  0,  0 ], // OP4\n    [  1,  0,  0,  0 ], // carrier\n  ],\n  [\n    // OP1 OP2 OP3 OP4\n    [  0,  1,  0,  0 ], // OP1\n    [  0,  0,  0,  0 ], // OP2\n    [  0,  0,  0,  1 ], // OP3\n    [  0,  0,  0,  0 ], // OP4\n    [  0.5, 0, 0.5, 0 ], // carrier\n  ],\n  [\n    // OP1 OP2 OP3 OP4\n    [  0,  0,  0,  1 ], // OP1\n    [  0,  0,  0,  1 ], // OP2\n    [  0,  0,  0,  1 ], // OP3\n    [  0,  0,  0,  0 ], // OP4\n    [  0.33, 0.33, 0.33, 0 ], // carrier\n  ],\n  [\n    // OP1 OP2 OP3 OP4\n    [  0,  0,  0,  0 ], // OP1\n    [  0,  0,  0,  0 ], // OP2\n    [  0,  0,  0,  1 ], // OP3\n    [  0,  0,  0,  0 ], // OP4\n    [  0.33, 0.33, 0.33, 0 ], // carrier\n  ],\n  [\n    // OP1 OP2 OP3 OP4\n    [  0,  0,  0,  0 ], // OP1\n    [  0,  0,  0,  0 ], // OP2\n    [  0,  0,  0,  0 ], // OP3\n    [  0,  0,  0,  0 ], // OP4\n    [  0.25,  0.25,  0.25,  0.25 ], // carrier\n  ],\n]\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/synthesizer/constants/algorithms.js","export const FIXED_FREQUENCY_TABLE = [\n  1,\n  1.023373891996775,\n  1.0472941228206267,\n  1.0717734625362931,\n  1.096824979694626,\n  1.122462048309373,\n  1.148698354997035,\n  1.1755479062836087,\n  1.2030250360821166,\n  1.2311444133449163,\n  1.2599210498948732,\n  1.2893703084395791,\n  1.3195079107728942,\n  1.3503499461681898,\n  1.3819128799677758,\n  1.4142135623730947,\n  1.4472692374403777,\n  1.4810975522865637,\n  1.5157165665103975,\n  1.551144761833734,\n  1.587401051968199,\n  1.6245047927124705,\n  1.662475792285575,\n  1.7013343219017112,\n  1.7411011265922482,\n  1.7817974362806785,\n  1.8234449771164336,\n  1.866065983073615,\n  1.9096832078208332,\n  1.954319936868492,\n  2,\n  2.04674778399355,\n  2.0945882456412535,\n  2.1435469250725867,\n  2.1936499593892527,\n  2.244924096618747,\n  2.297396709994071,\n  2.351095812567219,\n  2.406050072164235,\n  2.4622888266898344,\n  2.5198420997897486,\n  2.578740616879161,\n  2.639015821545791,\n  2.7006998923363827,\n  2.7638257599355547,\n  2.8284271247461925,\n  2.8945384748807585,\n  2.9621951045731305,\n  3.0314331330207978,\n  3.102289523667471,\n  3.1748021039364005,\n  3.2490095854249432,\n  3.324951584571152,\n  3.4026686438034237,\n  3.4822022531844974,\n  3.5635948725613575,\n  3.646889954232867,\n  3.7321319661472296,\n  3.8193664156416656,\n  3.908639873736983,\n  3.999999999999999,\n  4.093495567987098,\n  4.189176491282505,\n  4.287093850145171,\n  4.387299918778502,\n  4.489848193237489,\n  4.594793419988137,\n  4.702191625134431,\n  4.812100144328463,\n  4.924577653379661,\n  5.039684199579487,\n  5.157481233758311,\n  5.2780316430915715,\n  5.401399784672753,\n  5.527651519871096,\n  5.656854249492371,\n  5.789076949761503,\n  5.924390209146247,\n  6.062866266041581,\n  6.204579047334927,\n  6.349604207872786,\n  6.498019170849871,\n  6.649903169142289,\n  6.805337287606831,\n  6.964404506368978,\n  7.127189745122698,\n  7.2937799084657176,\n  7.4642639322944415,\n  7.638732831283315,\n  7.817279747473951,\n  7.999999999999984,\n  8.186991135974184,\n  8.378352982565,\n  8.574187700290333,\n  8.774599837556996,\n  8.979696386474973,\n  9.18958683997627,\n  9.404383250268861,\n  9.624200288656926,\n  9.849155306759325,\n]\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/synthesizer/constants/fixedFrequencyTable.js","import { FIXED_FREQUENCY_TABLE } from './constants'\n\nexport function calculatePhaseIncrement(frequency, sampleRate) {\n  return 2 * Math.PI * frequency / sampleRate\n}\n\nexport function calculateRatioFrequency(coarse, fine) {\n  let ratio = Math.ceil(coarse * 13)\n\n  if (ratio === 0) {\n    ratio = 0.5\n  }\n\n  ratio += (fine >= 1.0) ? 0.99 : fine\n\n  return ratio\n}\n\nexport function calculateFixedFrequency(coarse, fine) {\n  const rate = Math.pow(10, Math.floor(coarse * 3))\n  let base = Math.floor(fine * 100)\n\n  if (base > 99) {\n    base = 99\n  }\n\n  return FIXED_FREQUENCY_TABLE[base] * rate\n}\n\nexport function convertOperatorSettings(setting, sampleRate) {\n  const { algorithmId, feedback } = setting\n  const totalTime = 15 * sampleRate\n  const operators = []\n\n  for (let i = 0; i < 4; i += 1) {\n    const envelope = {\n      isLoop: setting.isLoop[i],\n    }\n\n    envelope.segments = setting.envelopes[i].map((segment, index) => {\n      let length\n      let step\n\n      if (index === 0) {\n        // Attack\n        length = Math.pow(segment.x, 2) * totalTime\n\n        if (length === 0) {\n          length = 1\n        }\n\n        step = (1.0 - segment.y) / length\n      } else if (index === 1) {\n        // Decay\n        const previousSegment = setting.envelopes[i][0]\n        length = Math.pow(segment.x - previousSegment.x, 2) * totalTime\n\n        if (length === 0) {\n          length = 1\n        }\n\n        step = -1 * (segment.y - previousSegment.y) / length\n      } else if (index === 2) {\n        // Release\n        length = Math.pow(1.0 - segment.x, 2) * totalTime\n\n        if (length === 0) {\n          length = 1\n        }\n\n        step = -1 * (1.0 - segment.y) / length\n      }\n\n      return {\n        length,\n        step,\n      }\n    })\n\n    operators.push({\n      isFixed: setting.isFixed[i],\n      isVelocitySensitive: setting.isVelocitySensitive[i],\n      coarse: setting.coarse[i],\n      fine: setting.fine[i],\n      envelope,\n    })\n  }\n\n  return {\n    algorithmId,\n    feedback,\n    operators,\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/synthesizer/helpers.js","import Envelope from './Envelope'\n\nexport default class Operator {\n  constructor() {\n    this.envelope = new Envelope()\n\n    this.coarse = 0.0\n    this.fine = 0.0\n\n    this.isFixed = false\n    this.isVelocitySensitive = false\n\n    this._output = 0.0\n    this._phase = 0.0\n    this._phaseIncrement = 0.0\n  }\n\n  next() {\n    return this.envelope.next()\n  }\n\n  noteOn() {\n    return this.envelope.noteOn()\n  }\n\n  noteOff() {\n    return this.envelope.noteOff()\n  }\n\n  changeEnvelope(settings) {\n    this.envelope.isLoop = settings.isLoop\n\n    settings.segments.forEach((setting, index) => {\n      this.envelope.changeSegment(index, setting)\n    })\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/synthesizer/Operator.js","const ENVELOPE_STATES = {\n  STOP: 0,\n  ATTACK: 1,\n  DECAY: 2,\n  SUSTAIN: 3,\n  RELEASE: 4,\n  DUMP: 5,\n}\n\nimport EnvelopeSegment from './EnvelopeSegment'\n\nexport default class Envelope {\n  constructor() {\n    this.state = ENVELOPE_STATES.STOP\n\n    this.amp = 0.0\n    this.isLoop = false\n\n    this.segments = []\n\n    this.currentSegmentPosition = 0\n    this.currentSegmentStep = 0.0\n\n    this.onRelease = () => true\n\n    for (let i = 0; i < 3; i += 1) {\n      this.segments.push(new EnvelopeSegment())\n    }\n  }\n\n  next() {\n    if (this.currentSegmentPosition <= 0) {\n      return\n    }\n\n    this.amp += this.currentSegmentStep\n    if (this.amp > 1.0) {\n      this.amp = 1.0\n    }\n\n    this.currentSegmentPosition -= 1\n\n    if (this.currentSegmentPosition <= 0) {\n      switch (this.state) {\n      case ENVELOPE_STATES.DUMP:\n        this.state = ENVELOPE_STATES.ATTACK\n        this.currentSegmentStep = this.segments[0].step\n        this.currentSegmentPosition = this.segments[0].length\n        this.amp = 0.0\n        break\n      case ENVELOPE_STATES.ATTACK:\n        this.state = ENVELOPE_STATES.DECAY\n        this.currentSegmentStep = this.segments[1].step\n        this.currentSegmentPosition = this.segments[1].length\n        break\n      case ENVELOPE_STATES.DECAY:\n        if (!this.isLoop) {\n          this.state = ENVELOPE_STATES.SUSTAIN\n          this.currentSegmentStep = 0.0\n          this.currentSegmentPosition = 0\n        } else {\n          this.state = ENVELOPE_STATES.ATTACK\n          this.currentSegmentStep = this.segments[0].step\n          this.currentSegmentPosition = this.segments[0].length\n          this.amp = 0.0\n        }\n        break\n      case ENVELOPE_STATES.RELEASE:\n        this.state = ENVELOPE_STATES.STOP\n        this.amp = 0.0\n        if (this.onRelease) {\n          this.onRelease()\n        }\n        break\n      }\n    }\n  }\n\n  noteOn() {\n    if (this.state !== ENVELOPE_STATES.STOP) {\n      this.state = ENVELOPE_STATES.DUMP\n      this.currentSegmentStep = -1 * this.amp / this.currentSegmentPosition\n      this.currentSegmentPosition = 128\n    } else {\n      this.state = ENVELOPE_STATES.ATTACK\n      this.currentSegmentStep = this.segments[0].step\n      this.currentSegmentPosition = this.segments[0].length\n      this.amp = 0.0\n    }\n  }\n\n  noteOff() {\n    if (this.state !== ENVELOPE_STATES.STOP) {\n      this.state = ENVELOPE_STATES.RELEASE\n      this.currentSegmentStep = -1 * this.amp / this.segments[2].length\n      this.currentSegmentPosition = this.segments[2].length\n    }\n  }\n\n  changeSegment(index, setting) {\n    if (index < 0 || index > this.segments.length - 1) {\n      throw new Error('Invalid segment index')\n    }\n\n    this.segments[index].length = setting.length\n    this.segments[index].step = setting.step\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/synthesizer/Envelope.js","export default class EnvelopeSegment {\n  constructor() {\n    this.length = 0\n    this.step = 0.0\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/synthesizer/EnvelopeSegment.js","export const PRESETS = {\n  BELL: {\n    name: 'BELL',\n    algorithmId: 4,\n    coarse: [0.04, 0.19, 0.06, 0.18],\n    feedback: 0.3,\n    fine: [0, 0.5, 0, 0.5],\n    isFixed: [false, false, false, false],\n    isLoop: [false, false, false, false],\n    isVelocitySensitive: [false, true, false, false],\n    envelopes: [\n      [{ x: 0, y: 0.053 }, { x: 0.708, y: 0.741 }, { x: 0.708, y: 0.741 }],\n      [{ x: 0, y: 0.435 }, { x: 0.741, y: 0.729 }, { x: 0.741, y: 0.729 }],\n      [{ x: 0.004, y: 0.562 }, { x: 0.226, y: 0.832 }, { x: 0.708, y: 0.832 }],\n      [{ x: 0.004, y: 0.461 }, { x: 0.281, y: 0.814 }, { x: 0.715, y: 0.814 }],\n    ],\n  },\n  BRASS: {\n    name: 'BRASS',\n    algorithmId: 0,\n    coarse: [0.04, 0.07, 0, 0.17],\n    feedback: 0.28,\n    fine: [0, 0, 0, 0],\n    isFixed: [false, false, false, false],\n    isLoop: [false, false, false, false],\n    isVelocitySensitive: [false, false, true, true],\n    envelopes: [\n      [{ x: 0.102, y: 0.112 }, { x: 0.208, y: 0.324 }, { x: 0.9, y: 0.324 }],\n      [{ x: 0.007, y: 0.747 }, { x: 0.219, y: 0.259 }, { x: 0.9, y: 0.259 }],\n      [{ x: 0.073, y: 0.241 }, { x: 0.277, y: 0.476 }, { x: 0.9, y: 0.476 }],\n      [{ x: 0, y: 0.594 }, { x: 0.161, y: 0.994 }, { x: 0.9, y: 0.994 }],\n    ],\n  },\n  ORGAN: {\n    name: 'ORGAN',\n    algorithmId: 7,\n    coarse: [0, 0.11, 0.04, 0.25],\n    feedback: 0.16,\n    fine: [0, 0, 0, 0],\n    isFixed: [false, false, false, false],\n    isLoop: [false, false, false, false],\n    isVelocitySensitive: [false, false, false, false],\n    envelopes: [\n      [{ x: 0.04, y: 0.012 }, { x: 0.215, y: 0 }, { x: 0.9, y: 0 }],\n      [{ x: 0.047, y: 0.006 }, { x: 0.168, y: 0.006 }, { x: 0.9, y: 0.006 }],\n      [{ x: 0.077, y: 0.076 }, { x: 0.161, y: 0 }, { x: 0.836, y: 0 }],\n      [{ x: 0.088, y: 0.141 }, { x: 0.223, y: 0.006 }, { x: 0.9, y: 0.006 }],\n    ],\n  },\n  CHIME: {\n    name: 'CHIME',\n    algorithmId: 1,\n    coarse: [0.28, 0.07, 0.66, 0.05],\n    feedback: 0.3,\n    fine: [0.29, 0, 0, 0],\n    isFixed: [true, false, false, false],\n    isLoop: [false, false, false, true],\n    isVelocitySensitive: [false, false, true, false],\n    envelopes: [\n      [{ x: 0.004, y: 0 }, { x: 0.752, y: 0.653 }, { x: 0.752, y: 0.653 }],\n      [{ x: 0, y: 0.524 }, { x: 0.285, y: 0.7 }, { x: 0.752, y: 0.7 }],\n      [{ x: 0, y: 0.829 }, { x: 0.288, y: 0.994 }, { x: 0.9, y: 0.994 }],\n      [{ x: 0.077, y: 0.824 }, { x: 0.161, y: 0.994 }, { x: 0.9, y: 0.994 }],\n    ],\n  },\n  PAD: {\n    name: 'PAD',\n    algorithmId: 4,\n    coarse: [0.05, 0.07, 0.13, 0.05],\n    feedback: 0.94,\n    fine: [0, 0, 0.33, 0.5],\n    isFixed: [false, false, true, false],\n    isLoop: [false, false, false, false],\n    isVelocitySensitive: [false, false, false, false],\n    envelopes: [\n      [{ x: 0.062, y: 0.106 }, { x: 0.237, y: 0 }, { x: 0.752, y: 0 }],\n      [{ x: 0.139, y: 0.776 }, { x: 0.328, y: 0.741 }, { x: 0.752, y: 0.741 }],\n      [{ x: 0.131, y: 0.5 }, { x: 0.354, y: 0.288 }, { x: 0.704, y: 0.288 }],\n      [{ x: 0.077, y: 0.618 }, { x: 0.201, y: 0.524 }, { x: 0.741, y: 0.524 }],\n    ],\n  },\n  EG_LOOPER: {\n    name: 'EG_LOOPER',\n    algorithmId: 4,\n    coarse: [0.19, 0.41, 0.24, 0.14],\n    feedback: 0.58,\n    fine: [0, 0, 0, 0.5],\n    isFixed: [false, false, false, false],\n    isLoop: [true, true, true, true],\n    isVelocitySensitive: [false, false, false, false],\n    envelopes: [\n      [{ x: 0.212, y: 0.253 }, { x: 0.423, y: 0.994 }, { x: 0.752, y: 0.994 }],\n      [{ x: 0.142, y: 0.541 }, { x: 0.281, y: 0.982 }, { x: 0.752, y: 0.982 }],\n      [{ x: 0.354, y: 0.106 }, { x: 0.704, y: 0.994 }, { x: 0.704, y: 0.994 }],\n      [{ x: 0.423, y: 0.276 }, { x: 0.861, y: 0.994 }, { x: 0.861, y: 0.994 }],\n    ],\n  },\n  GUITAR: {\n    name: 'GUITAR',\n    algorithmId: 0,\n    coarse: [0, 0.05, 0.17, 0.59],\n    feedback: 0.19,\n    fine: [0, 0.5, 0.5, 0],\n    isFixed: [false, false, false, false],\n    isLoop: [false, false, false, false],\n    isVelocitySensitive: [false, false, false, true],\n    envelopes: [\n      [{ x: 0, y: 0.047 }, { x: 0.314, y: 0.994 }, { x: 0.752, y: 0.994 }],\n      [{ x: 0, y: 0.735 }, { x: 0.423, y: 0.788 }, { x: 0.847, y: 0.788 }],\n      [{ x: 0, y: 0.488 }, { x: 0.058, y: 0.794 }, { x: 0.73, y: 0.794 }],\n      [{ x: 0, y: 0.665 }, { x: 0.069, y: 0.818 }, { x: 0.734, y: 0.818 }],\n    ],\n  },\n  EG_SEQ: {\n    name: 'EG_SEQ',\n    algorithmId: 2,\n    coarse: [0.05, 0, 0.29, 0.14],\n    feedback: 0.36,\n    fine: [0, 0, 0, 0],\n    isFixed: [false, false, false, false],\n    isLoop: [true, false, false, true],\n    isVelocitySensitive: [false, false, false, false],\n    envelopes: [\n      [{ x: 0.004, y: 0.029 }, { x: 0.109, y: 0.994 }, { x: 0.9, y: 0.994 }],\n      [{ x: 0.004, y: 0.488 }, { x: 0.982, y: 0.994 }, { x: 0.982, y: 0.994 }],\n      [{ x: 0.004, y: 0.506 }, { x: 0.124, y: 0.988 }, { x: 0.836, y: 0.988 }],\n      [{ x: 0.434, y: 0.176 }, { x: 0.869, y: 0.988 }, { x: 0.9, y: 0.988 }],\n    ],\n  },\n  INIT_VOICE: {\n    name: 'INIT_VOICE',\n    algorithmId: 0,\n    coarse: [0.05, 0.05, 0.05, 0.05],\n    feedback: 0,\n    fine: [0, 0, 0, 0],\n    isFixed: [false, false, false, false],\n    isLoop: [false, false, false, false],\n    isVelocitySensitive: [false, false, false, false],\n    envelopes: [\n      [{ x: 0, y: 0.2 }, { x: 0.5, y: 0.2 }, { x: 1, y: 0.2 }],\n      [{ x: 0, y: 1 }, { x: 0.5, y: 1 }, { x: 1, y: 1 }],\n      [{ x: 0, y: 1 }, { x: 0.5, y: 1 }, { x: 1, y: 1 }],\n      [{ x: 0, y: 1 }, { x: 0.5, y: 1 }, { x: 1, y: 1 }],\n    ],\n  },\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/presets.js","import Peer from 'peerjs'\nimport { create as createTimesync } from 'timesync'\n\nconst CHECK_MISSING_PEERS_FREQUENCY = 10000\nconst PEER_ID_KEY = 'automaton-peer'\n\nfunction getPeerString(id) {\n  return `${PEER_ID_KEY}-${id}`\n}\n\nfunction getAllPeers(clientsNumber, ownId) {\n  const peers = []\n\n  for (let id = 1; id < clientsNumber + 1; id += 1) {\n    if (ownId !== id) {\n      peers.push(getPeerString(id))\n    }\n  }\n\n  return peers\n}\n\nconst defaultOptions = {\n  onClose: () => {},\n  onCloseRemote: () => {},\n  onError: () => {},\n  onOpen: () => {},\n  onOpenRemote: () => {},\n  onReceive: () => {},\n  onSyncTick: () => {},\n  syncInterval: 5000,\n  syncTickFrequency: 10,\n}\n\nexport default class Network {\n  constructor(options) {\n    this.options = Object.assign({}, defaultOptions, options)\n\n    this.lastCheckedDate = new Date()\n    this.offset = 0\n    this.peer = null\n    this.peers = []\n    this.sync = null\n    this.syncInterval = null\n    this.syncTickInterval = null\n  }\n\n  connect(configuration) {\n    if (this.peer && this.peer.open) {\n      this.options.onError(\n        new Error('Connection is already open')\n      )\n      return false\n    }\n\n    const {\n      serverHost,\n      serverKey,\n    } = configuration\n\n    const peerId = parseInt(configuration.peerId, 10)\n    const clientsNumber = parseInt(configuration.clientsNumber, 10)\n    const serverPort = parseInt(configuration.serverPort, 10)\n\n    if (peerId < 1 || peerId > clientsNumber) {\n      this.options.onError(\n        new Error('Invalid peer id')\n      )\n      return false\n    }\n\n    this.peers = getAllPeers(clientsNumber, peerId)\n    this.lastCheckedDate = new Date()\n\n    const setupConnection = (connection) => {\n      if (this.peer.connections[connection.id]) {\n        const isAlreadyOpen = this.peer.connections[connection.id]\n          .find(remoteConnection => {\n            return remoteConnection.open\n          })\n\n        if (isAlreadyOpen) {\n          return\n        }\n      }\n\n      connection\n        .on('open', () => {\n          this.options.onOpenRemote(connection.peer)\n        })\n        .on('data', data => {\n          if (data.jsonrpc) {\n            this.sync.receive(connection.peer, data)\n          } else {\n            this.options.onReceive(connection.peer, data)\n          }\n        })\n        .on('close', () => {\n          this.options.onCloseRemote(connection.peer)\n        })\n        .on('error', err => {\n          this.options.onError(err)\n        })\n    }\n\n    const connectToPeers = () => {\n      this.peers\n        .filter(id => {\n          return !(id in this.peer.connections)\n        })\n        .forEach(id => {\n          const connection = this.peer.connect(id, {\n            serialization: 'json',\n          })\n          setupConnection(connection)\n        })\n    }\n\n    this.peer = new Peer(getPeerString(peerId), {\n      host: serverHost,\n      key: serverKey,\n      port: serverPort,\n    })\n\n    this.peer.on('open', () => {\n      connectToPeers()\n      this.options.onOpen()\n    })\n\n    this.peer.on('connection', connection => {\n      setupConnection(connection)\n    })\n\n    this.peer.on('disconnected', () => {\n      this.peer.destroy()\n      this.sync.destroy()\n    })\n\n    this.peer.on('close', () => {\n      this.options.onClose()\n    })\n\n    this.peer.on('error', err => {\n      this.options.onError(err)\n\n      if (err.type !== 'disconnected' && err.type !== 'peer-unavailable') {\n        this.disconnect(true)\n      }\n    })\n\n    // Time synchronization between peers\n    this.sync = createTimesync({\n      delay: 100,\n      interval: this.options.syncInterval,\n      peers: [],\n      timeout: 10000,\n    })\n\n    this.sync.send = (id, data) => {\n      this.send(id, data)\n    }\n\n    this.sync.on('sync', state => {\n      if (state === 'start') {\n        const openConnections = Object.keys(this.peer.connections)\n          .filter(id => {\n            return this.peer.connections[id].some(connection => {\n              return connection.open\n            })\n          })\n\n        this.sync.options.peers = openConnections\n      } else if (state === 'end') {\n        this.sync.options.peers = []\n      }\n    })\n\n    this.sync.on('change', offset => {\n      this.offset = offset\n    })\n\n    // Check for missing connections\n    this.syncInterval = setInterval(\n      connectToPeers,\n      CHECK_MISSING_PEERS_FREQUENCY\n    )\n\n    // Start synchronized ticking\n    this.syncTickInterval = setInterval(\n      () => {\n        const syncDate = new Date(this.sync.now())\n        if (syncDate.getSeconds() !== this.lastCheckedDate.getSeconds()) {\n          this.options.onSyncTick(this.offset)\n          this.lastCheckedDate = syncDate\n        }\n      }, this.options.syncTickFrequency\n    )\n\n    return true\n  }\n\n  disconnect(isForced = false) {\n    if (!isForced && (!this.peer || !this.peer.open)) {\n      throw new Error('Connection is already closed')\n    }\n\n    this.peer.disconnect()\n\n    clearInterval(this.syncInterval)\n    clearInterval(this.syncTickInterval)\n\n    this.syncTickInterval = null\n    this.syncInterval = null\n  }\n\n  sendToAll(data) {\n    this.peers.forEach(id => {\n      this.send(id, data)\n    })\n  }\n\n  send(id, data) {\n    const all = this.peer.connections[id]\n    const connection = all && all.filter(remoteConnection => {\n      return remoteConnection.open\n    })[0]\n\n    if (connection) {\n      connection.send(data)\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/network/index.js","const STORAGE_KEY = 'automaton'\n\nfunction loadFromStorage() {\n  const storage = window.localStorage.getItem(STORAGE_KEY)\n  return storage ? JSON.parse(storage) : {}\n}\n\nfunction saveToStorage(configuration) {\n  window.localStorage.setItem(STORAGE_KEY, JSON.stringify(configuration))\n}\n\nconst defaultConfiguration = {\n  clientsNumber: 4,\n  peerId: 1,\n  serverHost: '0.peerjs.com',\n  serverKey: 'gs5wl7sq2cblnmi',\n  serverPort: 9000,\n}\n\nexport default class Settings {\n  constructor() {\n    this.configuration = Object.assign(\n      {},\n      defaultConfiguration,\n      loadFromStorage()\n    )\n  }\n\n  update(id, value) {\n    this.configuration[id] = value\n    saveToStorage(this.configuration)\n  }\n\n  getConfiguration() {\n    return this.configuration\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/Settings.js","const ERROR_MESSAGES_LIMIT = 3\n\nconst VIEW_IDS = [\n  'main-view',\n  'settings-view',\n]\n\nconst INITIAL_VIEW = 'settings-view'\n\nexport default class View {\n  constructor() {\n    this.allFormElems = document.querySelectorAll('form input')\n    this.connectButtonElem = document.getElementById('connect-button')\n    this.connectedPeersElem = document.getElementById('connected-peers')\n    this.disconnectButtonElem = document.getElementById('disconnect-button')\n    this.errorMessagesElem = document.getElementById('error-messages')\n    this.offsetMonitorElem = document.getElementById('offset-monitor')\n    this.tickElem = document.getElementById('tick')\n\n    this.errorMessages = []\n\n    this.changeView(VIEW_IDS.indexOf(INITIAL_VIEW))\n  }\n\n  changeConnectionState(isLoading, isConnected) {\n    this.connectButtonElem.disabled = isLoading || isConnected\n    this.disconnectButtonElem.disabled = isLoading || !isConnected\n\n    for (let i = 0; i < this.allFormElems.length; i++) {\n      this.allFormElems[i].disabled = isLoading || isConnected\n    }\n  }\n\n  updateSettings(configuration) {\n    Object.keys(configuration).forEach(id => {\n      const inputElement = document.getElementById(id)\n      if (inputElement) {\n        inputElement.value = configuration[id]\n      }\n    })\n  }\n\n  updateOffset(offset) {\n    this.offsetMonitorElem.innerText = `${offset.toFixed(1)} ms`\n  }\n\n  addErrorMessage(message) {\n    this.errorMessages.push({\n      timestamp: new Date(),\n      message,\n    })\n\n    if (this.errorMessages.length > ERROR_MESSAGES_LIMIT) {\n      this.errorMessages.shift()\n    }\n\n    this.errorMessagesElem.innerHTML = ''\n\n    this.errorMessages.forEach(error => {\n      const errorMessageElem = document.createElement('div')\n      const formattedTime = error.timestamp.toISOString()\n      errorMessageElem.innerText = formattedTime + ' ' + error.message\n\n      this.errorMessagesElem.appendChild(errorMessageElem)\n    })\n  }\n\n  addRemotePeer(peerId) {\n    const peerElem = document.createElement('div')\n    peerElem.class = 'connected-peer'\n    peerElem.innerText = peerId\n    peerElem.id = peerId\n\n    this.connectedPeersElem.appendChild(peerElem)\n  }\n\n  removeRemotePeer(peerId) {\n    const peerElem = document.getElementById(peerId)\n    this.connectedPeersElem.removeChild(peerElem)\n  }\n\n  changeView(viewIndex) {\n    if (viewIndex < 0 || viewIndex > VIEW_IDS.length - 1) {\n      return\n    }\n\n    VIEW_IDS.forEach(viewId => {\n      document.getElementById(viewId).classList.remove('view--active')\n    })\n\n    const nextViewId = VIEW_IDS[viewIndex]\n    document.getElementById(nextViewId).classList.add('view--active')\n  }\n\n  tick() {\n    this.tickElem.classList.add('tick--active')\n    setTimeout(() => {\n      this.tickElem.classList.remove('tick--active')\n    }, 500)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/View.js"],"sourceRoot":""}