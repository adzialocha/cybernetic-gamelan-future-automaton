{"version":3,"sources":["webpack:///automaton.bundle.js","webpack:///./automaton/scripts/index.js","webpack:///./automaton/scripts/network/API.js","webpack:///./automaton/scripts/Composition.js","webpack:///./automaton/scripts/instrument/index.js","webpack:///./automaton/scripts/instrument/sequencer/index.js","webpack:///./automaton/scripts/instrument/SynthesizerInterface.js","webpack:///./automaton/scripts/instrument/AudioInterface.js","webpack:///./automaton/assets/impulse.wav","webpack:///./automaton/scripts/instrument/Channel.js","webpack:///./automaton/scripts/instrument/synthesizer/index.js","webpack:///./automaton/scripts/instrument/synthesizer/algorithms.js","webpack:///./automaton/scripts/instrument/synthesizer/helpers.js","webpack:///./automaton/scripts/instrument/synthesizer/Operator.js","webpack:///./automaton/scripts/instrument/synthesizer/Envelope.js","webpack:///./automaton/scripts/instrument/synthesizer/EnvelopeSegment.js","webpack:///./automaton/scripts/instrument/patternHelpers.js","webpack:///./automaton/scripts/instrument/scales.js","webpack:///./automaton/scripts/instrument/presets.js","webpack:///./automaton/scripts/network/index.js","webpack:///./automaton/scripts/Settings.js","webpack:///./automaton/scripts/View.js"],"names":["webpackJsonp","32","module","exports","__webpack_require__","33","_index","_index2","_interopRequireDefault","_API","_API2","_Composition","_Composition2","_network","_network2","_Settings","_Settings2","_View","_View2","obj","__esModule","default","api","composition","settings","view","network","onOpen","changeConnectionState","start","onClose","stop","onOpenRemote","peerId","addRemotePeer","onCloseRemote","removeRemotePeer","onSyncTick","offset","updateOffset","tick","instrument","syncTick","onReceive","peer","data","receive","onError","err","addErrorMessage","message","setNetwork","window","addEventListener","updateSettings","getConfiguration","changePattern","getCurrentPattern","automaton","connect","event","preventDefault","disconnect","update","_event$target","target","id","value","onKeyUpPattern","onKeyDownPattern","keyCode","stopPropagation","commitPattern","shiftKey","changeView","getCurrentView","focusPattern","34","35","Object","defineProperty","_createClass","defineProperties","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_classCallCheck","instance","TypeError","defaultOptions","CommunicationInterface","options","this","assign","send","type","payload","sendToAll","36","_instrument","_instrument2","_scales","_presets","NOTE_MATERIAL","pickFromScale","PELOG","BASE_BPM","PRESET","PRESETS","BELL","VELOCITY","POSSIBLE_OCTAVES","pickRandom","collection","Math","floor","random","Composition","baseBpm","noteMaterial","changePreset","changeVelocity","interval","patternString","_this","setInterval","changeOctave","clearInterval","37","_sequencer","_sequencer2","_SynthesizerInterface","_SynthesizerInterface2","_patternHelpers","MS_PER_SECOND","SECONDS_PER_MINUTE","SMALLEST_BAR_DIVIDE","bpmToMs","minuteMs","arguments","undefined","bpm","duration","Instrument","lastTickSyncAt","stepFrequency","tickTimeout","octave","velocity","synthesizerInterface","sequencer","isRunning","preset","changeBpm","result","convertString","newBpm","pow","bpmLevel","pattern","step","setTimeout","now","Date","getTime","elasticSecond","elasticMinute","clearTimeout","lastPatternSyncAt","38","Sequencer","currentStep","currentStepIndex","previousStep","_pattern$currentStepI","isHolding","note","previousNote","noteOff","noteOn","allNotesOff","39","_AudioInterface","_AudioInterface2","_Channel","_Channel2","_synthesizer","_synthesizer2","DEFAULT_NOTE","DEFAULT_VELOCITY","SynthesizerInterface","audio","channels","synthesizer","sampleRate","context","channel","push","index","findIndex","Error","removedChannel","then","splice","_this2","forEach","40","_impulse","_impulse2","getImpulse","Promise","resolve","reject","ajaxRequest","XMLHttpRequest","open","responseType","onload","impulseData","response","decodeAudioData","buffer","AudioInterface","AudioContext","convolverNode","createConvolver","loop","normalize","compressorNode","createDynamicsCompressor","currentVolume","gainNode","createGain","gain","destination","changeVolume","volume","mute","unmute","41","p","42","BUFFER_SIZE","Channel","audioInterface","scriptProcessorNode","_audioInterface","createScriptProcessor","bufferSourceNode","createBufferSource","onaudioprocess","left","outputBuffer","getChannelData","right","generateAudio","43","_algorithms","_helpers","_Operator","_Operator2","DEFAULT_SAMPLE_RATE","Synthesizer","feedback","algorithmId","operators","numSamples","algorithm","ALGORITHMS","sampleIndex","mainOutput","_loop","op","modOutput","operator","item","_output","amp","envelope","sin","_phase","isVelocitySensitive","_phaseIncrement","next","frequency","calculateRatioFrequency","coarse","fine","calculatePhaseIncrement","_this3","counter","onRelease","changeOperator","setting","isFixed","changeEnvelope","_this4","convertedPreset","convertOperatorSettings","44","45","PI","ratio","ceil","totalTime","isLoop","segments","envelopes","map","segment","x","y","previousSegment","46","_Envelope","_Envelope2","Operator","changeSegment","47","_EnvelopeSegment","_EnvelopeSegment2","ENVELOPE_STATES","STOP","ATTACK","DECAY","SUSTAIN","RELEASE","DUMP","Envelope","state","currentSegmentPosition","currentSegmentStep","48","EnvelopeSegment","49","HOLD_NOTE_CHAR","NOTES_CHAR","PAUSE_CHAR","BPM_UP","BPM_DOWN","stringToSequencerPattern","notes","toLowerCase","split","isError","noteChar","includes","noteNumber","indexOf","countCharInString","string","char","regex","RegExp","match","extractBpmLevel","up","down","replace","50","SLENDRO","picks","scale","pick","51","name","CHIME","PAD","SPACE","PING","GUITAR","52","_peerjs","_peerjs2","_timesync","CHECK_MISSING_PEERS_FREQUENCY","PEER_ID_KEY","getPeerString","getAllPeers","clientsNumber","ownId","peers","getOpenConnection","connections","filter","remoteConnection","onAllOnline","syncInterval","syncStepsDelay","syncTickFrequency","Network","lastCheckedDate","sync","syncTickInterval","isAlone","configuration","serverHost","serverKey","parseInt","serverPort","setupConnection","connection","isAlreadyOpen","find","on","onlinePeers","jsonrpc","connectToPeers","serialization","host","port","secure","location","protocol","destroy","create","delay","timeout","openConnections","keys","some","syncDate","getSeconds","isForced","87","STORAGE_KEY","loadFromStorage","storage","localStorage","getItem","JSON","parse","saveToStorage","setItem","stringify","defaultConfiguration","Settings","88","ERROR_MESSAGES_LIMIT","VIEW_IDS","INITIAL_VIEW","View","allFormElems","document","querySelectorAll","connectButtonElem","getElementById","connectedPeersElem","disconnectButtonElem","errorMessagesElem","offsetMonitorElem","patternElem","tickElem","errorMessages","committedPattern","querySelector","isLoading","isConnected","disabled","inputElement","innerText","toFixed","timestamp","shift","innerHTML","error","errorMessageElem","createElement","formattedTime","toISOString","appendChild","peerElem","class","removeChild","viewIndex","viewId","classList","remove","nextViewId","add","blur","isPatternDirty","focus"],"mappings":"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","file":"automaton.bundle.js","sourcesContent":["webpackJsonp([0],{\n\n/***/ 32:\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = __webpack_require__(33);\n\n\n/***/ }),\n\n/***/ 33:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _index = __webpack_require__(34);\n\nvar _index2 = _interopRequireDefault(_index);\n\nvar _API = __webpack_require__(35);\n\nvar _API2 = _interopRequireDefault(_API);\n\nvar _Composition = __webpack_require__(36);\n\nvar _Composition2 = _interopRequireDefault(_Composition);\n\nvar _network = __webpack_require__(52);\n\nvar _network2 = _interopRequireDefault(_network);\n\nvar _Settings = __webpack_require__(87);\n\nvar _Settings2 = _interopRequireDefault(_Settings);\n\nvar _View = __webpack_require__(88);\n\nvar _View2 = _interopRequireDefault(_View);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/* eslint-disable no-use-before-define */\n\nvar api = new _API2.default(); // eslint-disable-line no-unused-vars\n\nvar composition = new _Composition2.default();\nvar settings = new _Settings2.default();\nvar view = new _View2.default();\n\nvar network = new _network2.default({\n  onOpen: function onOpen() {\n    view.changeConnectionState(false, true);\n    composition.start();\n  },\n  onClose: function onClose() {\n    view.changeConnectionState(false, false);\n    composition.stop();\n  },\n  onOpenRemote: function onOpenRemote(peerId) {\n    view.addRemotePeer(peerId);\n  },\n  onCloseRemote: function onCloseRemote(peerId) {\n    view.removeRemotePeer(peerId);\n  },\n  onSyncTick: function onSyncTick(offset) {\n    view.updateOffset(offset);\n    view.tick();\n\n    composition.instrument.syncTick();\n  },\n  onReceive: function onReceive(peer, data) {\n    api.receive(peer, data);\n  },\n  onError: function onError(err) {\n    view.addErrorMessage(err.message);\n  }\n});\n\napi.setNetwork(network);\n\n// Initialize\nwindow.addEventListener('load', function () {\n  view.changeConnectionState(false, false);\n  view.updateSettings(settings.getConfiguration());\n  view.changePattern(composition.getCurrentPattern());\n});\n\n// Expose some interfaces to the view\nwindow.automaton = window.automaton || {\n  network: {\n    connect: function connect(event) {\n      event.preventDefault();\n\n      if (network.connect(settings.getConfiguration())) {\n        view.changeConnectionState(true, false);\n      }\n    },\n    disconnect: function disconnect(event) {\n      event.preventDefault();\n\n      view.changeConnectionState(true, true);\n      network.disconnect();\n    }\n  },\n  settings: {\n    update: function update(event) {\n      var _event$target = event.target,\n          id = _event$target.id,\n          value = _event$target.value;\n\n      settings.update(id, value);\n    }\n  },\n  onKeyUpPattern: function onKeyUpPattern(event) {\n    view.changePattern(event.target.value);\n  },\n  onKeyDownPattern: function onKeyDownPattern(event) {\n    if (event.keyCode === 13) {\n      event.preventDefault();\n      event.stopPropagation();\n\n      var value = event.target.value;\n\n      if (composition.instrument.changePattern(value)) {\n        view.commitPattern(value);\n      }\n    }\n  }\n\n  // Main keyboard control strokes\n};window.addEventListener('keydown', function (event) {\n  var keyCode = event.keyCode,\n      shiftKey = event.shiftKey;\n\n  // Press shift + number\n\n  if (shiftKey) {\n    view.changeView(keyCode - 49);\n  }\n\n  // Press enter\n  if (keyCode === 13) {\n    if (view.getCurrentView() === 'main-view') {\n      view.focusPattern();\n    }\n  }\n});\n\n/***/ }),\n\n/***/ 34:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 35:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar defaultOptions = {\n  // onStartReceived: () => {},\n};\n\nvar CommunicationInterface = function () {\n  function CommunicationInterface(options) {\n    _classCallCheck(this, CommunicationInterface);\n\n    this.options = Object.assign({}, defaultOptions, options);\n    this.network = null;\n  }\n\n  _createClass(CommunicationInterface, [{\n    key: 'send',\n    value: function send(type, value) {\n      if (!this.network) {\n        return;\n      }\n\n      var payload = {\n        type: type\n      };\n\n      if (typeof value !== 'undefined') {\n        payload.value = value;\n      }\n\n      this.network.sendToAll(payload);\n    }\n  }, {\n    key: 'receive',\n    value: function receive(peer, data) {\n      if (!data.type) {\n        return;\n      }\n\n      // switch (data.type) {\n      // case 'START':\n      //   this.options.onStartReceived()\n      //   break\n      // }\n    }\n  }, {\n    key: 'setNetwork',\n    value: function setNetwork(network) {\n      this.network = network;\n    }\n  }]);\n\n  return CommunicationInterface;\n}();\n\nexports.default = CommunicationInterface;\nmodule.exports = exports['default'];\n\n/***/ }),\n\n/***/ 36:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _instrument = __webpack_require__(37);\n\nvar _instrument2 = _interopRequireDefault(_instrument);\n\nvar _scales = __webpack_require__(50);\n\nvar _presets = __webpack_require__(51);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar NOTE_MATERIAL = (0, _scales.pickFromScale)([6, 1, 2, 4, 5], _scales.PELOG);\n\nvar BASE_BPM = 80;\nvar PRESET = _presets.PRESETS.BELL;\nvar VELOCITY = 0.25;\n\nvar POSSIBLE_OCTAVES = [0, 1];\n\nvar defaultOptions = {};\n\nfunction pickRandom(collection) {\n  return collection[Math.floor(Math.random() * collection.length)];\n}\n\nvar Composition = function () {\n  function Composition(options) {\n    _classCallCheck(this, Composition);\n\n    this.options = Object.assign({}, defaultOptions, options);\n\n    this.instrument = new _instrument2.default({\n      baseBpm: BASE_BPM,\n      noteMaterial: NOTE_MATERIAL\n    });\n\n    this.instrument.changePreset(PRESET);\n    this.instrument.changeVelocity(VELOCITY);\n\n    this.interval = null;\n  }\n\n  _createClass(Composition, [{\n    key: 'getCurrentPattern',\n    value: function getCurrentPattern() {\n      return this.instrument.settings.patternString;\n    }\n  }, {\n    key: 'start',\n    value: function start() {\n      var _this = this;\n\n      this.instrument.start();\n\n      // For testing\n      this.interval = setInterval(function () {\n        if (Math.random() < 0.5) {\n          return;\n        }\n\n        _this.instrument.changeOctave(pickRandom(POSSIBLE_OCTAVES));\n      }, 10000);\n    }\n  }, {\n    key: 'stop',\n    value: function stop() {\n      this.instrument.stop();\n\n      clearInterval(this.interval);\n    }\n  }]);\n\n  return Composition;\n}();\n\nexports.default = Composition;\nmodule.exports = exports['default'];\n\n/***/ }),\n\n/***/ 37:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _sequencer = __webpack_require__(38);\n\nvar _sequencer2 = _interopRequireDefault(_sequencer);\n\nvar _SynthesizerInterface = __webpack_require__(39);\n\nvar _SynthesizerInterface2 = _interopRequireDefault(_SynthesizerInterface);\n\nvar _patternHelpers = __webpack_require__(49);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar MS_PER_SECOND = 1000;\nvar SECONDS_PER_MINUTE = 60;\nvar SMALLEST_BAR_DIVIDE = 16; // 16th note\n\nvar defaultOptions = {\n  baseBpm: 120,\n  noteMaterial: []\n};\n\nfunction bpmToMs() {\n  var minuteMs = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 60000;\n  var bpm = arguments[1];\n  var duration = arguments[2];\n\n  return minuteMs / bpm * (1 / duration) * 4;\n}\n\nvar Instrument = function () {\n  function Instrument() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, Instrument);\n\n    this.options = Object.assign({}, defaultOptions, options);\n\n    this.lastTickSyncAt = null;\n    this.stepFrequency = null;\n    this.tickTimeout = null;\n\n    this.settings = {\n      bpm: this.options.baseBpm,\n      octave: 0,\n      patternString: '',\n      velocity: 1.0\n    };\n\n    this.synthesizerInterface = new _SynthesizerInterface2.default();\n    this.sequencer = new _sequencer2.default(this.synthesizerInterface);\n  }\n\n  _createClass(Instrument, [{\n    key: 'isRunning',\n    value: function isRunning() {\n      return this.sequencer.isRunning;\n    }\n  }, {\n    key: 'changePreset',\n    value: function changePreset(preset) {\n      this.synthesizerInterface.changePreset(preset);\n    }\n  }, {\n    key: 'changeBpm',\n    value: function changeBpm(bpm) {\n      this.settings.bpm = bpm;\n    }\n  }, {\n    key: 'changeOctave',\n    value: function changeOctave(octave) {\n      this.settings.octave = octave;\n    }\n  }, {\n    key: 'changeVelocity',\n    value: function changeVelocity(velocity) {\n      this.settings.velocity = velocity;\n    }\n  }, {\n    key: 'changePattern',\n    value: function changePattern(patternString) {\n      this.settings.patternString = patternString;\n\n      // Translate string to sequencer pattern\n      var result = (0, _patternHelpers.convertString)(this.settings.patternString, this.settings.octave, this.settings.velocity, this.options.noteMaterial);\n\n      if (!result) {\n        return false;\n      }\n\n      var newBpm = this.options.baseBpm * Math.pow(2, result.bpmLevel);\n      this.changeBpm(newBpm);\n\n      // Give new pattern to sequencer when no problem occurred\n      this.sequencer.changePattern(result.pattern);\n\n      return true;\n    }\n  }, {\n    key: 'step',\n    value: function step() {\n      var _this = this;\n\n      this.sequencer.step();\n\n      this.tickTimeout = setTimeout(function () {\n        _this.step();\n      }, this.stepFrequency);\n    }\n  }, {\n    key: 'syncTick',\n    value: function syncTick() {\n      // Calculate a minute in our synced network\n      var now = new Date().getTime();\n      var elasticSecond = this.lastTickSyncAt ? now - this.lastTickSyncAt.getTime() : MS_PER_SECOND;\n      var elasticMinute = SECONDS_PER_MINUTE * elasticSecond;\n\n      // .. and generate 16th note ticks\n      this.stepFrequency = bpmToMs(elasticMinute, this.settings.bpm, SMALLEST_BAR_DIVIDE);\n      this.lastTickSyncAt = new Date();\n\n      if (!this.tickTimeout) {\n        this.step();\n      }\n    }\n  }, {\n    key: 'start',\n    value: function start() {\n      this.sequencer.start();\n    }\n  }, {\n    key: 'stop',\n    value: function stop() {\n      this.sequencer.stop();\n\n      clearTimeout(this.tickTimeout);\n\n      this.tickTimeout = null;\n      this.lastTickSyncAt = null;\n      this.lastPatternSyncAt = null;\n      this.stepFrequency = null;\n    }\n  }]);\n\n  return Instrument;\n}();\n\nexports.default = Instrument;\nmodule.exports = exports['default'];\n\n/***/ }),\n\n/***/ 38:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Sequencer = function () {\n  function Sequencer(synthesizerInterface) {\n    _classCallCheck(this, Sequencer);\n\n    this.synthesizerInterface = synthesizerInterface;\n\n    this.currentStep = null;\n    this.currentStepIndex = 0;\n    this.previousStep = null;\n\n    this.pattern = [];\n\n    this.isRunning = false;\n  }\n\n  _createClass(Sequencer, [{\n    key: \"step\",\n    value: function step() {\n      if (!this.isRunning) {\n        return;\n      }\n\n      if (this.pattern.length === 0) {\n        return;\n      }\n\n      var _pattern$currentStepI = this.pattern[this.currentStepIndex],\n          isHolding = _pattern$currentStepI.isHolding,\n          note = _pattern$currentStepI.note,\n          velocity = _pattern$currentStepI.velocity;\n\n\n      var previousNote = this.previousStep && this.previousStep.note;\n\n      if (previousNote && (previousNote !== note || !isHolding)) {\n        this.synthesizerInterface.noteOff(previousNote);\n      }\n\n      if (note && (note !== previousNote || !isHolding)) {\n        this.synthesizerInterface.noteOn(note, velocity);\n      }\n\n      this.previousStep = this.pattern[this.currentStepIndex];\n\n      this.currentStepIndex += 1;\n\n      if (this.currentStepIndex > this.pattern.length - 1) {\n        this.currentStepIndex = 0;\n      }\n    }\n  }, {\n    key: \"start\",\n    value: function start() {\n      this.isRunning = true;\n    }\n  }, {\n    key: \"stop\",\n    value: function stop() {\n      this.isRunning = false;\n\n      this.currentStepIndex = 0;\n      this.previousStep = null;\n      this.synthesizerInterface.allNotesOff();\n    }\n  }, {\n    key: \"changePattern\",\n    value: function changePattern(pattern) {\n      this.pattern = pattern;\n\n      if (this.isRunning) {\n        if (this.currentStepIndex > this.pattern.length - 1) {\n          this.currentStepIndex = 0;\n        }\n        this.previousStep = null;\n        this.synthesizerInterface.allNotesOff();\n      }\n    }\n  }]);\n\n  return Sequencer;\n}();\n\nexports.default = Sequencer;\nmodule.exports = exports[\"default\"];\n\n/***/ }),\n\n/***/ 39:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _AudioInterface = __webpack_require__(40);\n\nvar _AudioInterface2 = _interopRequireDefault(_AudioInterface);\n\nvar _Channel = __webpack_require__(42);\n\nvar _Channel2 = _interopRequireDefault(_Channel);\n\nvar _synthesizer = __webpack_require__(43);\n\nvar _synthesizer2 = _interopRequireDefault(_synthesizer);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar DEFAULT_NOTE = 72;\nvar DEFAULT_VELOCITY = 1.0;\n\nvar SynthesizerInterface = function () {\n  function SynthesizerInterface() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, SynthesizerInterface);\n\n    this.audio = new _AudioInterface2.default();\n    this.channels = [];\n    this.preset = options.preset;\n  }\n\n  _createClass(SynthesizerInterface, [{\n    key: 'changePreset',\n    value: function changePreset(preset) {\n      this.preset = preset;\n    }\n  }, {\n    key: 'noteOn',\n    value: function noteOn() {\n      var note = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : DEFAULT_NOTE;\n      var velocity = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : DEFAULT_VELOCITY;\n\n      // Create FM synthesizer\n      var synthesizer = new _synthesizer2.default({\n        preset: this.preset,\n        sampleRate: this.audio.context.sampleRate\n      });\n\n      // Create a channel for audio\n      var channel = new _Channel2.default(this.audio, synthesizer, note);\n      channel.start();\n      this.channels.push(channel);\n\n      // Play the note\n      synthesizer.noteOn(note, velocity);\n    }\n  }, {\n    key: 'noteOff',\n    value: function noteOff() {\n      var _this = this;\n\n      var note = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : DEFAULT_NOTE;\n\n      var index = this.channels.findIndex(function (channel) {\n        return channel.note === note;\n      });\n\n      if (index === -1) {\n        throw new Error('Could not find that note');\n      }\n\n      var removedChannel = this.channels[index];\n\n      removedChannel.note = null;\n\n      removedChannel.synthesizer.noteOff().then(function () {\n        removedChannel.stop();\n\n        _this.channels.splice(_this.channels.findIndex(function (channel) {\n          return channel === removedChannel;\n        }), 1);\n      });\n    }\n  }, {\n    key: 'allNotesOff',\n    value: function allNotesOff() {\n      var _this2 = this;\n\n      this.channels.forEach(function (channel) {\n        if (channel.note) {\n          _this2.noteOff(channel.note);\n        }\n      });\n    }\n  }]);\n\n  return SynthesizerInterface;\n}();\n\nexports.default = SynthesizerInterface;\nmodule.exports = exports['default'];\n\n/***/ }),\n\n/***/ 40:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _impulse = __webpack_require__(41);\n\nvar _impulse2 = _interopRequireDefault(_impulse);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction getImpulse(context) {\n  return new Promise(function (resolve, reject) {\n    var ajaxRequest = new XMLHttpRequest();\n    ajaxRequest.open('GET', _impulse2.default, true);\n    ajaxRequest.responseType = 'arraybuffer';\n\n    ajaxRequest.onload = function () {\n      var impulseData = ajaxRequest.response;\n      context.decodeAudioData(impulseData, function (buffer) {\n        resolve(buffer);\n      }, function (err) {\n        reject(err);\n      });\n    };\n\n    ajaxRequest.send();\n  });\n}\n\nvar AudioInterface = function () {\n  function AudioInterface() {\n    var _this = this;\n\n    _classCallCheck(this, AudioInterface);\n\n    // Create audio context\n    this.context = new AudioContext();\n\n    // Reverb\n    this.convolverNode = this.context.createConvolver();\n    this.convolverNode.loop = true;\n    this.convolverNode.normalize = true;\n\n    getImpulse(this.context).then(function (buffer) {\n      _this.convolverNode.buffer = buffer;\n    });\n\n    // Compressor\n    this.compressorNode = this.context.createDynamicsCompressor();\n\n    // Gain\n    this.currentVolume = 0.5;\n    this.gainNode = this.context.createGain();\n    this.gainNode.gain.value = this.currentVolume;\n\n    this.compressorNode.connect(this.gainNode);\n    // this.convolverNode.connect(this.gainNode)\n    this.gainNode.connect(this.context.destination);\n  }\n\n  _createClass(AudioInterface, [{\n    key: 'changeVolume',\n    value: function changeVolume(volume) {\n      this.gainNode.gain.value = volume;\n      this.currentVolume = volume;\n    }\n  }, {\n    key: 'mute',\n    value: function mute() {\n      this.gainNode.gain.value = 0;\n    }\n  }, {\n    key: 'unmute',\n    value: function unmute() {\n      this.gainNode.gain.value = this.currentVolume;\n    }\n  }]);\n\n  return AudioInterface;\n}();\n\nexports.default = AudioInterface;\nmodule.exports = exports['default'];\n\n/***/ }),\n\n/***/ 41:\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = __webpack_require__.p + \"cce8145a91d99c7379b34bf23fce576a.wav\";\n\n/***/ }),\n\n/***/ 42:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar BUFFER_SIZE = 1024;\n\nvar Channel = function () {\n  function Channel(audioInterface, synthesizer, note) {\n    _classCallCheck(this, Channel);\n\n    this.audioInterface = audioInterface;\n    this.isRunning = false;\n    this.note = note;\n    this.scriptProcessorNode = null;\n    this.synthesizer = synthesizer;\n  }\n\n  _createClass(Channel, [{\n    key: 'start',\n    value: function start() {\n      var _this = this;\n\n      if (this.isRunning) {\n        throw new Error('Channel was already started');\n      }\n\n      var _audioInterface = this.audioInterface,\n          context = _audioInterface.context,\n          compressorNode = _audioInterface.compressorNode;\n\n      this.scriptProcessorNode = context.createScriptProcessor(BUFFER_SIZE, 1, 2);\n\n      var bufferSourceNode = context.createBufferSource();\n      bufferSourceNode.start(0);\n\n      // Connect audio nodes\n      bufferSourceNode.connect(this.scriptProcessorNode);\n      this.scriptProcessorNode.connect(compressorNode);\n\n      // Start FM synthesis\n      this.scriptProcessorNode.onaudioprocess = function (event) {\n        var left = event.outputBuffer.getChannelData(0);\n        var right = event.outputBuffer.getChannelData(1);\n\n        _this.synthesizer.generateAudio(left, right);\n      };\n\n      this.isRunning = true;\n    }\n  }, {\n    key: 'stop',\n    value: function stop() {\n      if (!this.isRunning) {\n        throw new Error('Channel was already stopped');\n      }\n\n      this.scriptProcessorNode.disconnect();\n      this.isRunning = false;\n    }\n  }]);\n\n  return Channel;\n}();\n\nexports.default = Channel;\nmodule.exports = exports['default'];\n\n/***/ }),\n\n/***/ 43:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _algorithms = __webpack_require__(44);\n\nvar _helpers = __webpack_require__(45);\n\nvar _Operator = __webpack_require__(46);\n\nvar _Operator2 = _interopRequireDefault(_Operator);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar DEFAULT_SAMPLE_RATE = 16000;\n\nvar Synthesizer = function () {\n  function Synthesizer() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, Synthesizer);\n\n    if (!options || !options.preset) {\n      throw new Error('Preset option is not set');\n    }\n\n    this.sampleRate = options.sampleRate || DEFAULT_SAMPLE_RATE;\n\n    this.velocity = 1.0;\n    this.feedback = 0.0;\n\n    this.algorithmId = 0;\n    this.operators = [];\n\n    for (var i = 0; i < 4; i += 1) {\n      this.operators.push(new _Operator2.default());\n    }\n\n    this.changePreset(options.preset);\n  }\n\n  _createClass(Synthesizer, [{\n    key: 'generateAudio',\n    value: function generateAudio(left, right) {\n      var _this = this;\n\n      var numSamples = left.length;\n      var algorithm = _algorithms.ALGORITHMS[this.algorithmId];\n\n      for (var sampleIndex = 0; sampleIndex < numSamples; sampleIndex += 1) {\n        var mainOutput = 0;\n\n        var _loop = function _loop(op) {\n          var modOutput = 0;\n          var operator = _this.operators[op];\n\n          _this.operators.forEach(function (item, index) {\n            modOutput += algorithm[op][index] * _this.operators[index]._output;\n          });\n\n          modOutput *= 10;\n\n          if (op === 3) {\n            modOutput += operator._output * _this.feedback * 3;\n          }\n\n          var amp = operator.envelope.amp;\n          operator._output = Math.sin(operator._phase + modOutput) * amp * amp;\n\n          if (operator.isVelocitySensitive) {\n            operator._output *= _this.velocity;\n          }\n\n          operator._phase += operator._phaseIncrement;\n\n          mainOutput += operator._output * algorithm[4][op];\n        };\n\n        for (var op = this.operators.length - 1; op >= 0; op -= 1) {\n          _loop(op);\n        }\n\n        right[sampleIndex] = left[sampleIndex] = mainOutput;\n\n        this.operators.forEach(function (operator) {\n          operator.next();\n        });\n      }\n    }\n  }, {\n    key: 'noteOn',\n    value: function noteOn(note, velocity) {\n      var _this2 = this;\n\n      this.velocity = velocity;\n\n      this.operators.forEach(function (operator) {\n        var frequency = (0, _helpers.calculateRatioFrequency)(operator.coarse, operator.fine);\n\n        operator._phaseIncrement = (0, _helpers.calculatePhaseIncrement)(note, _this2.sampleRate) * frequency;\n\n        operator._phase = 0.0;\n        operator._output = 0.0;\n      });\n\n      this.operators.forEach(function (operator) {\n        operator.noteOn();\n      });\n    }\n  }, {\n    key: 'noteOff',\n    value: function noteOff() {\n      var _this3 = this;\n\n      return new Promise(function (resolve) {\n        var counter = _this3.operators.length;\n\n        _this3.operators.forEach(function (operator) {\n          operator.envelope.onRelease = function () {\n            counter -= 1;\n            if (counter === 0) {\n              resolve();\n            }\n          };\n\n          operator.noteOff();\n        });\n      });\n    }\n  }, {\n    key: 'changeOperator',\n    value: function changeOperator(index, setting) {\n      if (index < 0 || index > this.operators.length - 1) {\n        return;\n      }\n\n      this.operators[index].coarse = setting.coarse;\n      this.operators[index].fine = setting.fine;\n\n      this.operators[index].isFixed = setting.isFixed;\n      this.operators[index].isVelocitySensitive = setting.isVelocitySensitive;\n\n      this.operators[index].changeEnvelope(setting.envelope);\n    }\n  }, {\n    key: 'changePreset',\n    value: function changePreset(preset) {\n      var _this4 = this;\n\n      var convertedPreset = (0, _helpers.convertOperatorSettings)(preset, this.sampleRate);\n\n      this.feedback = convertedPreset.feedback;\n      this.algorithmId = convertedPreset.algorithmId;\n\n      convertedPreset.operators.forEach(function (setting, index) {\n        _this4.changeOperator(index, setting);\n      });\n    }\n  }]);\n\n  return Synthesizer;\n}();\n\nexports.default = Synthesizer;\nmodule.exports = exports['default'];\n\n/***/ }),\n\n/***/ 44:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar ALGORITHMS = exports.ALGORITHMS = [[\n// OP1 OP2 OP3 OP4 = MOD\n[0, 1, 0, 0], // OP1\n[0, 0, 1, 0], // OP2\n[0, 0, 0, 1], // OP3\n[0, 0, 0, 0], // OP4\n[1, 0, 0, 0]], [\n// OP1 OP2 OP3 OP4\n[0, 1, 0, 0], // OP1\n[0, 0, 1, 1], // OP2\n[0, 0, 0, 0], // OP3\n[0, 0, 0, 0], // OP4\n[1, 0, 0, 0]], [\n// OP1 OP2 OP3 OP4\n[0, 1, 0, 1], // OP1\n[0, 0, 1, 0], // OP2\n[0, 0, 0, 0], // OP3\n[0, 0, 0, 0], // OP4\n[1, 0, 0, 0]], [\n// OP1 OP2 OP3 OP4\n[0, 1, 1, 0], // OP1\n[0, 0, 0, 0], // OP2\n[0, 0, 0, 1], // OP3\n[0, 0, 0, 0], // OP4\n[1, 0, 0, 0]], [\n// OP1 OP2 OP3 OP4\n[0, 1, 0, 0], // OP1\n[0, 0, 0, 0], // OP2\n[0, 0, 0, 1], // OP3\n[0, 0, 0, 0], // OP4\n[0.5, 0, 0.5, 0]], [\n// OP1 OP2 OP3 OP4\n[0, 0, 0, 1], // OP1\n[0, 0, 0, 1], // OP2\n[0, 0, 0, 1], // OP3\n[0, 0, 0, 0], // OP4\n[0.33, 0.33, 0.33, 0]], [\n// OP1 OP2 OP3 OP4\n[0, 0, 0, 0], // OP1\n[0, 0, 0, 0], // OP2\n[0, 0, 0, 1], // OP3\n[0, 0, 0, 0], // OP4\n[0.33, 0.33, 0.33, 0]], [\n// OP1 OP2 OP3 OP4\n[0, 0, 0, 0], // OP1\n[0, 0, 0, 0], // OP2\n[0, 0, 0, 0], // OP3\n[0, 0, 0, 0], // OP4\n[0.25, 0.25, 0.25, 0.25]]];\n\n/***/ }),\n\n/***/ 45:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.calculatePhaseIncrement = calculatePhaseIncrement;\nexports.calculateRatioFrequency = calculateRatioFrequency;\nexports.convertOperatorSettings = convertOperatorSettings;\nfunction calculatePhaseIncrement(frequency, sampleRate) {\n  return 2 * Math.PI * frequency / sampleRate;\n}\n\nfunction calculateRatioFrequency(coarse, fine) {\n  var ratio = Math.ceil(coarse * 13);\n\n  if (ratio === 0) {\n    ratio = 0.5;\n  }\n\n  ratio += fine >= 1.0 ? 0.99 : fine;\n\n  return ratio;\n}\n\nfunction convertOperatorSettings(setting, sampleRate) {\n  var algorithmId = setting.algorithmId,\n      feedback = setting.feedback;\n\n  var totalTime = 15 * sampleRate;\n  var operators = [];\n\n  var _loop = function _loop(i) {\n    var envelope = {\n      isLoop: setting.isLoop[i]\n    };\n\n    envelope.segments = setting.envelopes[i].map(function (segment, index) {\n      var length = void 0;\n      var step = void 0;\n\n      if (index === 0) {\n        // Attack\n        length = Math.pow(segment.x, 2) * totalTime;\n\n        if (length === 0) {\n          length = 1;\n        }\n\n        step = (1.0 - segment.y) / length;\n      } else if (index === 1) {\n        // Decay\n        var previousSegment = setting.envelopes[i][0];\n        length = Math.pow(segment.x - previousSegment.x, 2) * totalTime;\n\n        if (length === 0) {\n          length = 1;\n        }\n\n        step = -1 * (segment.y - previousSegment.y) / length;\n      } else if (index === 2) {\n        // Release\n        length = Math.pow(1.0 - segment.x, 2) * totalTime;\n\n        if (length === 0) {\n          length = 1;\n        }\n\n        step = -1 * (1.0 - segment.y) / length;\n      }\n\n      return {\n        length: length,\n        step: step\n      };\n    });\n\n    operators.push({\n      isVelocitySensitive: setting.isVelocitySensitive[i],\n      coarse: setting.coarse[i],\n      fine: setting.fine[i],\n      envelope: envelope\n    });\n  };\n\n  for (var i = 0; i < 4; i += 1) {\n    _loop(i);\n  }\n\n  return {\n    algorithmId: algorithmId,\n    feedback: feedback,\n    operators: operators\n  };\n}\n\n/***/ }),\n\n/***/ 46:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _Envelope = __webpack_require__(47);\n\nvar _Envelope2 = _interopRequireDefault(_Envelope);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Operator = function () {\n  function Operator() {\n    _classCallCheck(this, Operator);\n\n    this.envelope = new _Envelope2.default();\n\n    this.coarse = 0.0;\n    this.fine = 0.0;\n\n    this.isVelocitySensitive = false;\n\n    this._output = 0.0;\n    this._phase = 0.0;\n    this._phaseIncrement = 0.0;\n  }\n\n  _createClass(Operator, [{\n    key: 'next',\n    value: function next() {\n      return this.envelope.next();\n    }\n  }, {\n    key: 'noteOn',\n    value: function noteOn() {\n      return this.envelope.noteOn();\n    }\n  }, {\n    key: 'noteOff',\n    value: function noteOff() {\n      return this.envelope.noteOff();\n    }\n  }, {\n    key: 'changeEnvelope',\n    value: function changeEnvelope(settings) {\n      var _this = this;\n\n      this.envelope.isLoop = settings.isLoop;\n\n      settings.segments.forEach(function (setting, index) {\n        _this.envelope.changeSegment(index, setting);\n      });\n    }\n  }]);\n\n  return Operator;\n}();\n\nexports.default = Operator;\nmodule.exports = exports['default'];\n\n/***/ }),\n\n/***/ 47:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _EnvelopeSegment = __webpack_require__(48);\n\nvar _EnvelopeSegment2 = _interopRequireDefault(_EnvelopeSegment);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ENVELOPE_STATES = {\n  STOP: 0,\n  ATTACK: 1,\n  DECAY: 2,\n  SUSTAIN: 3,\n  RELEASE: 4,\n  DUMP: 5\n};\n\nvar Envelope = function () {\n  function Envelope() {\n    _classCallCheck(this, Envelope);\n\n    this.state = ENVELOPE_STATES.STOP;\n\n    this.amp = 0.0;\n    this.isLoop = false;\n\n    this.segments = [];\n\n    this.currentSegmentPosition = 0;\n    this.currentSegmentStep = 0.0;\n\n    this.onRelease = function () {\n      return true;\n    };\n\n    for (var i = 0; i < 3; i += 1) {\n      this.segments.push(new _EnvelopeSegment2.default());\n    }\n  }\n\n  _createClass(Envelope, [{\n    key: 'next',\n    value: function next() {\n      if (this.currentSegmentPosition <= 0) {\n        return;\n      }\n\n      this.amp += this.currentSegmentStep;\n      if (this.amp > 1.0) {\n        this.amp = 1.0;\n      }\n\n      this.currentSegmentPosition -= 1;\n\n      if (this.currentSegmentPosition <= 0) {\n        switch (this.state) {\n          case ENVELOPE_STATES.DUMP:\n            this.state = ENVELOPE_STATES.ATTACK;\n            this.currentSegmentStep = this.segments[0].step;\n            this.currentSegmentPosition = this.segments[0].length;\n            this.amp = 0.0;\n            break;\n          case ENVELOPE_STATES.ATTACK:\n            this.state = ENVELOPE_STATES.DECAY;\n            this.currentSegmentStep = this.segments[1].step;\n            this.currentSegmentPosition = this.segments[1].length;\n            break;\n          case ENVELOPE_STATES.DECAY:\n            if (!this.isLoop) {\n              this.state = ENVELOPE_STATES.SUSTAIN;\n              this.currentSegmentStep = 0.0;\n              this.currentSegmentPosition = 0;\n            } else {\n              this.state = ENVELOPE_STATES.ATTACK;\n              this.currentSegmentStep = this.segments[0].step;\n              this.currentSegmentPosition = this.segments[0].length;\n              this.amp = 0.0;\n            }\n            break;\n          case ENVELOPE_STATES.RELEASE:\n            this.state = ENVELOPE_STATES.STOP;\n            this.amp = 0.0;\n            if (this.onRelease) {\n              this.onRelease();\n            }\n            break;\n        }\n      }\n    }\n  }, {\n    key: 'noteOn',\n    value: function noteOn() {\n      if (this.state !== ENVELOPE_STATES.STOP) {\n        this.state = ENVELOPE_STATES.DUMP;\n        this.currentSegmentStep = -1 * this.amp / this.currentSegmentPosition;\n        this.currentSegmentPosition = 128;\n      } else {\n        this.state = ENVELOPE_STATES.ATTACK;\n        this.currentSegmentStep = this.segments[0].step;\n        this.currentSegmentPosition = this.segments[0].length;\n        this.amp = 0.0;\n      }\n    }\n  }, {\n    key: 'noteOff',\n    value: function noteOff() {\n      if (this.state !== ENVELOPE_STATES.STOP) {\n        this.state = ENVELOPE_STATES.RELEASE;\n        this.currentSegmentStep = -1 * this.amp / this.segments[2].length;\n        this.currentSegmentPosition = this.segments[2].length;\n      }\n    }\n  }, {\n    key: 'changeSegment',\n    value: function changeSegment(index, setting) {\n      if (index < 0 || index > this.segments.length - 1) {\n        throw new Error('Invalid segment index');\n      }\n\n      this.segments[index].length = setting.length;\n      this.segments[index].step = setting.step;\n    }\n  }]);\n\n  return Envelope;\n}();\n\nexports.default = Envelope;\nmodule.exports = exports['default'];\n\n/***/ }),\n\n/***/ 48:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar EnvelopeSegment = function EnvelopeSegment() {\n  _classCallCheck(this, EnvelopeSegment);\n\n  this.length = 0;\n  this.step = 0.0;\n};\n\nexports.default = EnvelopeSegment;\nmodule.exports = exports[\"default\"];\n\n/***/ }),\n\n/***/ 49:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.convertString = convertString;\nvar HOLD_NOTE_CHAR = '*';\nvar NOTES_CHAR = ['.', '-', '_', ':', '/'];\nvar PAUSE_CHAR = ' ';\n\nvar BPM_UP = '>';\nvar BPM_DOWN = '<';\n\nfunction stringToSequencerPattern(patternString) {\n  var octave = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  var velocity = arguments[2];\n  var noteMaterial = arguments[3];\n\n  var notes = patternString.toLowerCase().split('');\n\n  if (notes.length === 0) {\n    return [];\n  }\n\n  var previousNote = null;\n  var isError = false;\n\n  var result = notes.map(function (noteChar) {\n    var note = null;\n    var isHolding = false;\n\n    if (noteChar === HOLD_NOTE_CHAR) {\n      if (!previousNote) {\n        isError = true;\n        return false;\n      }\n\n      note = previousNote;\n      isHolding = true;\n    } else if (noteChar === PAUSE_CHAR) {\n      previousNote = null;\n    } else if (NOTES_CHAR.includes(noteChar)) {\n      var noteNumber = NOTES_CHAR.indexOf(noteChar);\n      note = noteMaterial[noteNumber] * Math.pow(2, octave);\n      previousNote = note;\n    } else {\n      isError = true;\n      return false;\n    }\n\n    return {\n      isHolding: isHolding,\n      note: note,\n      velocity: note ? velocity : 0.0\n    };\n  });\n\n  if (isError) {\n    return false;\n  }\n\n  return result;\n}\n\nfunction countCharInString(string, char) {\n  var regex = new RegExp(char, 'g');\n  return (string.match(regex) || []).length;\n}\n\nfunction extractBpmLevel(string) {\n  var up = countCharInString(string, BPM_UP);\n  var down = countCharInString(string, BPM_DOWN);\n\n  return up - down;\n}\n\nfunction convertString(string, octave, velocity, noteMaterial) {\n  var bpmLevel = extractBpmLevel(string);\n  var pattern = stringToSequencerPattern(string.replace(/(<|>)/g, ''), octave, velocity, noteMaterial);\n\n  if (!pattern) {\n    return false;\n  }\n\n  return {\n    bpmLevel: bpmLevel,\n    pattern: pattern\n  };\n}\n\n/***/ }),\n\n/***/ 50:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.pickFromScale = pickFromScale;\nvar SLENDRO = exports.SLENDRO = [240.6055948894539, 274.7914006625929, 316.56538760240016, 368.28862969288394, 420.13030572053793, 482.6029910656113, 551.1723529945722];\n\nvar PELOG = exports.PELOG = [298.7979376420033, 329.6275569129, 358.4247322079921, 420.13030572053793, 452.10885997355683, 482.6029910656113, 533.9372457958401];\n\nfunction pickFromScale(picks, scale) {\n  return picks.map(function (pick) {\n    return scale[pick];\n  });\n}\n\n/***/ }),\n\n/***/ 51:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar PRESETS = exports.PRESETS = {\n  BELL: {\n    name: 'BELL',\n    algorithmId: 4,\n    coarse: [0.04, 0.19, 0.06, 0.18],\n    feedback: 0.3,\n    fine: [0, 0.5, 0, 0.5],\n    isLoop: [false, false, false, false],\n    isVelocitySensitive: [true, true, true, true],\n    envelopes: [[{ x: 0, y: 0.053 }, { x: 0.708, y: 0.741 }, { x: 0.708, y: 0.741 }], [{ x: 0, y: 0.435 }, { x: 0.741, y: 0.729 }, { x: 0.741, y: 0.729 }], [{ x: 0.004, y: 0.562 }, { x: 0.226, y: 0.832 }, { x: 0.708, y: 0.832 }], [{ x: 0.004, y: 0.461 }, { x: 0.281, y: 0.814 }, { x: 0.715, y: 0.814 }]]\n  },\n  CHIME: {\n    name: 'CHIME',\n    algorithmId: 5,\n    coarse: [0.28, 0.07, 0.66, 0.05],\n    feedback: 0.3,\n    fine: [0.29, 0, 0, 0],\n    isLoop: [false, false, false, true],\n    isVelocitySensitive: [true, true, false, true],\n    envelopes: [[{ x: 0.004, y: 0 }, { x: 0.752, y: 0.653 }, { x: 0.752, y: 0.653 }], [{ x: 0, y: 0.524 }, { x: 0.285, y: 0.7 }, { x: 0.752, y: 0.7 }], [{ x: 0, y: 0.829 }, { x: 0.288, y: 0.994 }, { x: 0.9, y: 0.994 }], [{ x: 0.077, y: 0.824 }, { x: 0.161, y: 0.994 }, { x: 0.9, y: 0.994 }]]\n  },\n  PAD: {\n    name: 'PAD',\n    algorithmId: 4,\n    coarse: [0.05, 0.07, 0.13, 0.05],\n    feedback: 0.94,\n    fine: [0, 0, 0.33, 0.5],\n    isLoop: [false, false, false, false],\n    isVelocitySensitive: [true, false, false, false],\n    envelopes: [[{ x: 0.062, y: 0.106 }, { x: 0.237, y: 0 }, { x: 0.752, y: 0 }], [{ x: 0.139, y: 0.776 }, { x: 0.328, y: 0.741 }, { x: 0.752, y: 0.741 }], [{ x: 0.131, y: 0.5 }, { x: 0.354, y: 0.288 }, { x: 0.704, y: 0.288 }], [{ x: 0.077, y: 0.618 }, { x: 0.201, y: 0.524 }, { x: 0.741, y: 0.524 }]]\n  },\n  SPACE: {\n    name: 'SPACE',\n    algorithmId: 5,\n    coarse: [0.19, 0.41, 0.24, 0.14],\n    feedback: 0.58,\n    fine: [0, 0, 0, 0.5],\n    isLoop: [true, true, true, true],\n    isVelocitySensitive: [false, false, false, false],\n    envelopes: [[{ x: 0.212, y: 0.253 }, { x: 0.423, y: 0.994 }, { x: 0.752, y: 0.994 }], [{ x: 0.142, y: 0.541 }, { x: 0.281, y: 0.982 }, { x: 0.752, y: 0.982 }], [{ x: 0.354, y: 0.106 }, { x: 0.704, y: 0.994 }, { x: 0.704, y: 0.994 }], [{ x: 0.423, y: 0.276 }, { x: 0.861, y: 0.994 }, { x: 0.861, y: 0.994 }]]\n  },\n  PING: {\n    name: 'PING',\n    algorithmId: 6,\n    coarse: [0, 0.05, 0.17, 0.59],\n    feedback: 0.19,\n    fine: [0, 0.5, 0.5, 0],\n    isLoop: [false, false, false, false],\n    isVelocitySensitive: [true, true, true, true],\n    envelopes: [[{ x: 0.07, y: 0.547 }, { x: 0.314, y: 0.994 }, { x: 0.752, y: 0.994 }], [{ x: 0.1, y: 0.735 }, { x: 0.423, y: 0.788 }, { x: 0.847, y: 0.788 }], [{ x: 0, y: 0.488 }, { x: 0.058, y: 0.794 }, { x: 0.73, y: 0.794 }], [{ x: 0, y: 0.665 }, { x: 0.069, y: 0.818 }, { x: 0.734, y: 0.818 }]]\n  },\n  GUITAR: {\n    name: 'GUITAR',\n    algorithmId: 0,\n    coarse: [0, 0.05, 0.17, 0.59],\n    feedback: 0.19,\n    fine: [0, 0.5, 0.5, 0],\n    isLoop: [false, false, false, false],\n    isVelocitySensitive: [true, false, false, true],\n    envelopes: [[{ x: 0.05, y: 0.547 }, { x: 0.314, y: 0.994 }, { x: 0.752, y: 0.994 }], [{ x: 0, y: 0.735 }, { x: 0.423, y: 0.788 }, { x: 0.847, y: 0.788 }], [{ x: 0.01, y: 0.488 }, { x: 0.058, y: 0.794 }, { x: 0.73, y: 0.794 }], [{ x: 0, y: 0.665 }, { x: 0.069, y: 0.818 }, { x: 0.734, y: 0.818 }]]\n  }\n};\n\n/***/ }),\n\n/***/ 52:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _peerjs = __webpack_require__(13);\n\nvar _peerjs2 = _interopRequireDefault(_peerjs);\n\nvar _timesync = __webpack_require__(17);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar CHECK_MISSING_PEERS_FREQUENCY = 10000;\nvar PEER_ID_KEY = 'automaton-peer';\n\nfunction getPeerString(id) {\n  return PEER_ID_KEY + '-' + id;\n}\n\nfunction getAllPeers(clientsNumber, ownId) {\n  var peers = [];\n\n  for (var id = 1; id < clientsNumber + 1; id += 1) {\n    if (ownId !== id) {\n      peers.push(getPeerString(id));\n    }\n  }\n\n  return peers;\n}\n\nfunction getOpenConnection(connections) {\n  return connections && connections.filter(function (remoteConnection) {\n    return remoteConnection.open;\n  })[0];\n}\n\nvar defaultOptions = {\n  onAllOnline: function onAllOnline() {},\n  onClose: function onClose() {},\n  onCloseRemote: function onCloseRemote() {},\n  onError: function onError() {},\n  onOpen: function onOpen() {},\n  onOpenRemote: function onOpenRemote() {},\n  onReceive: function onReceive() {},\n  onSyncTick: function onSyncTick() {},\n  syncInterval: 500,\n  syncStepsDelay: 100,\n  syncTickFrequency: 1\n};\n\nvar Network = function () {\n  function Network(options) {\n    _classCallCheck(this, Network);\n\n    this.options = Object.assign({}, defaultOptions, options);\n\n    this.lastCheckedDate = new Date();\n    this.offset = 0;\n    this.peer = null;\n    this.peers = [];\n    this.sync = null;\n    this.syncInterval = null;\n    this.syncTickInterval = null;\n  }\n\n  _createClass(Network, [{\n    key: 'isAlone',\n    value: function isAlone() {\n      var _this = this;\n\n      return this.peers.filter(function (id) {\n        if (getOpenConnection(_this.peer.connections[id])) {\n          return true;\n        }\n        return false;\n      }).length === 0;\n    }\n  }, {\n    key: 'connect',\n    value: function connect(configuration) {\n      var _this2 = this;\n\n      if (this.peer && this.peer.open) {\n        this.options.onError(new Error('Connection is already open'));\n        return false;\n      }\n\n      var serverHost = configuration.serverHost,\n          serverKey = configuration.serverKey;\n\n\n      var peerId = parseInt(configuration.peerId, 10);\n      var clientsNumber = parseInt(configuration.clientsNumber, 10);\n      var serverPort = parseInt(configuration.serverPort, 10);\n\n      if (peerId < 1 || peerId > clientsNumber) {\n        this.options.onError(new Error('Invalid peer id'));\n        return false;\n      }\n\n      this.peers = getAllPeers(clientsNumber, peerId);\n      this.lastCheckedDate = new Date();\n\n      var setupConnection = function setupConnection(connection) {\n        if (_this2.peer.connections[connection.id]) {\n          var isAlreadyOpen = _this2.peer.connections[connection.id].find(function (remoteConnection) {\n            return remoteConnection.open;\n          });\n\n          if (isAlreadyOpen) {\n            return;\n          }\n        }\n\n        connection.on('open', function () {\n          _this2.options.onOpenRemote(connection.peer);\n\n          var onlinePeers = _this2.peers.filter(function (id) {\n            if (getOpenConnection(_this2.peer.connections[id])) {\n              return true;\n            }\n            return false;\n          });\n\n          if (onlinePeers.length === _this2.peers.length) {\n            _this2.options.onAllOnline();\n          }\n        }).on('data', function (data) {\n          if (data.jsonrpc) {\n            _this2.sync.receive(connection.peer, data);\n          } else {\n            _this2.options.onReceive(connection.peer, data);\n          }\n        }).on('close', function () {\n          _this2.options.onCloseRemote(connection.peer);\n        }).on('error', function (err) {\n          _this2.options.onError(err);\n        });\n      };\n\n      var connectToPeers = function connectToPeers() {\n        _this2.peers.filter(function (id) {\n          return !(id in _this2.peer.connections);\n        }).forEach(function (id) {\n          var connection = _this2.peer.connect(id, {\n            serialization: 'json'\n          });\n          setupConnection(connection);\n        });\n      };\n\n      this.peer = new _peerjs2.default(getPeerString(peerId), {\n        host: serverHost,\n        key: serverKey,\n        port: serverPort,\n        secure: window.location.protocol === 'https:'\n      });\n\n      this.peer.on('open', function () {\n        connectToPeers();\n        _this2.options.onOpen();\n      });\n\n      this.peer.on('connection', function (connection) {\n        setupConnection(connection);\n      });\n\n      this.peer.on('disconnected', function () {\n        _this2.peer.destroy();\n        _this2.sync.destroy();\n      });\n\n      this.peer.on('close', function () {\n        _this2.options.onClose();\n      });\n\n      this.peer.on('error', function (err) {\n        _this2.options.onError(err);\n\n        if (err.type !== 'disconnected' && err.type !== 'peer-unavailable') {\n          _this2.disconnect(true);\n        }\n      });\n\n      // Time synchronization between peers\n      this.sync = (0, _timesync.create)({\n        delay: this.options.syncStepsDelay,\n        interval: this.options.syncInterval,\n        peers: [],\n        timeout: 10000\n      });\n\n      this.sync.send = function (id, data) {\n        _this2.send(id, data);\n      };\n\n      this.sync.on('sync', function (state) {\n        if (state === 'start') {\n          var openConnections = Object.keys(_this2.peer.connections).filter(function (id) {\n            return _this2.peer.connections[id].some(function (connection) {\n              return connection.open;\n            });\n          });\n\n          _this2.sync.options.peers = openConnections;\n        } else if (state === 'end') {\n          _this2.sync.options.peers = [];\n        }\n      });\n\n      this.sync.on('change', function (offset) {\n        _this2.offset = offset;\n      });\n\n      // Check for missing connections\n      this.syncInterval = setInterval(connectToPeers, CHECK_MISSING_PEERS_FREQUENCY);\n\n      // Start synchronized ticking\n      this.syncTickInterval = setInterval(function () {\n        var syncDate = new Date(_this2.sync.now());\n        if (syncDate.getSeconds() !== _this2.lastCheckedDate.getSeconds()) {\n          _this2.options.onSyncTick(_this2.offset);\n          _this2.lastCheckedDate = syncDate;\n        }\n      }, this.options.syncTickFrequency);\n\n      return true;\n    }\n  }, {\n    key: 'disconnect',\n    value: function disconnect() {\n      var isForced = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n      if (!isForced && (!this.peer || !this.peer.open)) {\n        throw new Error('Connection is already closed');\n      }\n\n      this.peer.disconnect();\n\n      clearInterval(this.syncInterval);\n      clearInterval(this.syncTickInterval);\n\n      this.syncTickInterval = null;\n      this.syncInterval = null;\n    }\n  }, {\n    key: 'sendToAll',\n    value: function sendToAll(data) {\n      var _this3 = this;\n\n      this.peers.forEach(function (id) {\n        _this3.send(id, data);\n      });\n    }\n  }, {\n    key: 'send',\n    value: function send(id, data) {\n      var connection = getOpenConnection(this.peer.connections[id]);\n\n      if (connection) {\n        connection.send(data);\n      }\n    }\n  }]);\n\n  return Network;\n}();\n\nexports.default = Network;\nmodule.exports = exports['default'];\n\n/***/ }),\n\n/***/ 87:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar STORAGE_KEY = 'automaton';\n\nfunction loadFromStorage() {\n  var storage = window.localStorage.getItem(STORAGE_KEY);\n  return storage ? JSON.parse(storage) : {};\n}\n\nfunction saveToStorage(configuration) {\n  window.localStorage.setItem(STORAGE_KEY, JSON.stringify(configuration));\n}\n\nvar defaultConfiguration = {\n  clientsNumber: 4,\n  peerId: 1,\n  serverHost: '0.peerjs.com',\n  serverKey: 'gs5wl7sq2cblnmi',\n  serverPort: 9000\n};\n\nvar Settings = function () {\n  function Settings() {\n    _classCallCheck(this, Settings);\n\n    this.configuration = Object.assign({}, defaultConfiguration, loadFromStorage());\n  }\n\n  _createClass(Settings, [{\n    key: 'update',\n    value: function update(id, value) {\n      this.configuration[id] = value;\n      saveToStorage(this.configuration);\n    }\n  }, {\n    key: 'getConfiguration',\n    value: function getConfiguration() {\n      return this.configuration;\n    }\n  }]);\n\n  return Settings;\n}();\n\nexports.default = Settings;\nmodule.exports = exports['default'];\n\n/***/ }),\n\n/***/ 88:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ERROR_MESSAGES_LIMIT = 3;\n\nvar VIEW_IDS = ['main-view', 'settings-view'];\n\nvar INITIAL_VIEW = 'settings-view';\n\nvar View = function () {\n  function View() {\n    _classCallCheck(this, View);\n\n    this.allFormElems = document.querySelectorAll('form input');\n    this.connectButtonElem = document.getElementById('connect-button');\n    this.connectedPeersElem = document.getElementById('connected-peers');\n    this.disconnectButtonElem = document.getElementById('disconnect-button');\n    this.errorMessagesElem = document.getElementById('error-messages');\n    this.offsetMonitorElem = document.getElementById('offset-monitor');\n    this.patternElem = document.getElementById('pattern');\n    this.tickElem = document.getElementById('tick');\n\n    this.errorMessages = [];\n\n    this.committedPattern = null;\n\n    this.changeView(VIEW_IDS.indexOf(INITIAL_VIEW));\n  }\n\n  _createClass(View, [{\n    key: 'getCurrentView',\n    value: function getCurrentView() {\n      return document.querySelector('.view--active').id;\n    }\n  }, {\n    key: 'changeConnectionState',\n    value: function changeConnectionState(isLoading, isConnected) {\n      this.connectButtonElem.disabled = isLoading || isConnected;\n      this.disconnectButtonElem.disabled = isLoading || !isConnected;\n\n      for (var i = 0; i < this.allFormElems.length; i++) {\n        this.allFormElems[i].disabled = isLoading || isConnected;\n      }\n    }\n  }, {\n    key: 'updateSettings',\n    value: function updateSettings(configuration) {\n      Object.keys(configuration).forEach(function (id) {\n        var inputElement = document.getElementById(id);\n        if (inputElement) {\n          inputElement.value = configuration[id];\n        }\n      });\n    }\n  }, {\n    key: 'updateOffset',\n    value: function updateOffset(offset) {\n      this.offsetMonitorElem.innerText = offset.toFixed(1) + ' ms';\n    }\n  }, {\n    key: 'addErrorMessage',\n    value: function addErrorMessage(message) {\n      var _this = this;\n\n      this.errorMessages.push({\n        timestamp: new Date(),\n        message: message\n      });\n\n      if (this.errorMessages.length > ERROR_MESSAGES_LIMIT) {\n        this.errorMessages.shift();\n      }\n\n      this.errorMessagesElem.innerHTML = '';\n\n      this.errorMessages.forEach(function (error) {\n        var errorMessageElem = document.createElement('div');\n        var formattedTime = error.timestamp.toISOString();\n        errorMessageElem.innerText = formattedTime + ' ' + error.message;\n\n        _this.errorMessagesElem.appendChild(errorMessageElem);\n      });\n    }\n  }, {\n    key: 'addRemotePeer',\n    value: function addRemotePeer(peerId) {\n      var peerElem = document.createElement('div');\n      peerElem.class = 'connected-peer';\n      peerElem.innerText = peerId;\n      peerElem.id = peerId;\n\n      this.connectedPeersElem.appendChild(peerElem);\n    }\n  }, {\n    key: 'removeRemotePeer',\n    value: function removeRemotePeer(peerId) {\n      var peerElem = document.getElementById(peerId);\n      this.connectedPeersElem.removeChild(peerElem);\n    }\n  }, {\n    key: 'changeView',\n    value: function changeView(viewIndex) {\n      if (viewIndex < 0 || viewIndex > VIEW_IDS.length - 1) {\n        return;\n      }\n\n      VIEW_IDS.forEach(function (viewId) {\n        document.getElementById(viewId).classList.remove('view--active');\n      });\n\n      var nextViewId = VIEW_IDS[viewIndex];\n      document.getElementById(nextViewId).classList.add('view--active');\n\n      this.patternElem.blur();\n    }\n  }, {\n    key: 'changePattern',\n    value: function changePattern(pattern) {\n      var isPatternDirty = this.committedPattern && this.committedPattern !== pattern;\n\n      if (!this.committedPattern) {\n        this.committedPattern = pattern;\n      }\n\n      this.patternElem.value = pattern;\n\n      if (isPatternDirty) {\n        this.patternElem.classList.add('space__input--dirty');\n      } else {\n        this.patternElem.classList.remove('space__input--dirty');\n      }\n    }\n  }, {\n    key: 'focusPattern',\n    value: function focusPattern() {\n      this.patternElem.focus();\n    }\n  }, {\n    key: 'commitPattern',\n    value: function commitPattern(pattern) {\n      var _this2 = this;\n\n      this.patternElem.classList.remove('space__input--dirty');\n      this.patternElem.classList.add('space__input--commit');\n\n      setTimeout(function () {\n        _this2.patternElem.classList.remove('space__input--commit');\n      }, 500);\n\n      this.committedPattern = pattern;\n    }\n  }, {\n    key: 'tick',\n    value: function tick() {\n      var _this3 = this;\n\n      this.tickElem.classList.add('tick--active');\n      setTimeout(function () {\n        _this3.tickElem.classList.remove('tick--active');\n      }, 500);\n    }\n  }]);\n\n  return View;\n}();\n\nexports.default = View;\nmodule.exports = exports['default'];\n\n/***/ })\n\n},[32]);\n\n\n// WEBPACK FOOTER //\n// automaton.bundle.js","/* eslint-disable no-use-before-define */\n\nimport styles from '../styles/index.scss' // eslint-disable-line no-unused-vars\n\nimport API from './network/API'\nimport Composition from './Composition'\nimport Network from './network'\nimport Settings from './Settings'\nimport View from './View'\n\nconst api = new API()\nconst composition = new Composition()\nconst settings = new Settings()\nconst view = new View()\n\nconst network = new Network({\n  onOpen: () => {\n    view.changeConnectionState(false, true)\n    composition.start()\n  },\n  onClose: () => {\n    view.changeConnectionState(false, false)\n    composition.stop()\n  },\n  onOpenRemote: peerId => {\n    view.addRemotePeer(peerId)\n  },\n  onCloseRemote: peerId => {\n    view.removeRemotePeer(peerId)\n  },\n  onSyncTick: offset => {\n    view.updateOffset(offset)\n    view.tick()\n\n    composition.instrument.syncTick()\n  },\n  onReceive: (peer, data) => {\n    api.receive(peer, data)\n  },\n  onError: err => {\n    view.addErrorMessage(err.message)\n  },\n})\n\napi.setNetwork(network)\n\n// Initialize\nwindow.addEventListener('load', () => {\n  view.changeConnectionState(false, false)\n  view.updateSettings(settings.getConfiguration())\n  view.changePattern(composition.getCurrentPattern())\n})\n\n// Expose some interfaces to the view\nwindow.automaton = window.automaton || {\n  network: {\n    connect: event => {\n      event.preventDefault()\n\n      if (network.connect(settings.getConfiguration())) {\n        view.changeConnectionState(true, false)\n      }\n    },\n    disconnect: event => {\n      event.preventDefault()\n\n      view.changeConnectionState(true, true)\n      network.disconnect()\n    },\n  },\n  settings: {\n    update: event => {\n      const { id, value } = event.target\n      settings.update(id, value)\n    },\n  },\n  onKeyUpPattern: event => {\n    view.changePattern(event.target.value)\n  },\n  onKeyDownPattern: event => {\n    if (event.keyCode === 13) {\n      event.preventDefault()\n      event.stopPropagation()\n\n      const value = event.target.value\n\n      if (composition.instrument.changePattern(value)) {\n        view.commitPattern(value)\n      }\n    }\n  },\n}\n\n// Main keyboard control strokes\nwindow.addEventListener('keydown', (event) => {\n  const { keyCode, shiftKey } = event\n\n  // Press shift + number\n  if (shiftKey) {\n    view.changeView(keyCode - 49)\n  }\n\n  // Press enter\n  if (keyCode === 13) {\n    if (view.getCurrentView() === 'main-view') {\n      view.focusPattern()\n    }\n  }\n})\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/index.js","const defaultOptions = {\n  // onStartReceived: () => {},\n}\n\nexport default class CommunicationInterface {\n  constructor(options) {\n    this.options = Object.assign({}, defaultOptions, options)\n    this.network = null\n  }\n\n  send(type, value) {\n    if (!this.network) {\n      return\n    }\n\n    const payload = {\n      type,\n    }\n\n    if (typeof value !== 'undefined') {\n      payload.value = value\n    }\n\n    this.network.sendToAll(payload)\n  }\n\n  receive(peer, data) {\n    if (!data.type) {\n      return\n    }\n\n    // switch (data.type) {\n    // case 'START':\n    //   this.options.onStartReceived()\n    //   break\n    // }\n  }\n\n  setNetwork(network) {\n    this.network = network\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/network/API.js","import Instrument from './instrument'\n\nimport { PELOG, pickFromScale } from './instrument/scales'\nimport { PRESETS } from './instrument/presets'\n\nconst NOTE_MATERIAL = pickFromScale([6, 1, 2, 4, 5], PELOG)\n\nconst BASE_BPM = 80\nconst PRESET = PRESETS.BELL\nconst VELOCITY = 0.25\n\nconst POSSIBLE_OCTAVES = [\n  0,\n  1,\n]\n\nconst defaultOptions = {}\n\nfunction pickRandom(collection) {\n  return collection[Math.floor(Math.random() * collection.length)]\n}\n\nexport default class Composition {\n  constructor(options) {\n    this.options = Object.assign({}, defaultOptions, options)\n\n    this.instrument = new Instrument({\n      baseBpm: BASE_BPM,\n      noteMaterial: NOTE_MATERIAL,\n    })\n\n    this.instrument.changePreset(PRESET)\n    this.instrument.changeVelocity(VELOCITY)\n\n    this.interval = null\n  }\n\n  getCurrentPattern() {\n    return this.instrument.settings.patternString\n  }\n\n  start() {\n    this.instrument.start()\n\n    // For testing\n    this.interval = setInterval(() => {\n      if (Math.random() < 0.5) {\n        return\n      }\n\n      this.instrument.changeOctave(pickRandom(POSSIBLE_OCTAVES))\n    }, 10000)\n  }\n\n  stop() {\n    this.instrument.stop()\n\n    clearInterval(this.interval)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/Composition.js","import Sequencer from './sequencer'\nimport SynthesizerInterface from './SynthesizerInterface'\nimport { convertString } from './patternHelpers'\n\nconst MS_PER_SECOND = 1000\nconst SECONDS_PER_MINUTE = 60\nconst SMALLEST_BAR_DIVIDE = 16 // 16th note\n\nconst defaultOptions = {\n  baseBpm: 120,\n  noteMaterial: [],\n}\n\nfunction bpmToMs(minuteMs = 60000, bpm, duration) {\n  return (minuteMs / bpm) * (1 / duration) * 4\n}\n\nexport default class Instrument {\n  constructor(options = {}) {\n    this.options = Object.assign({}, defaultOptions, options)\n\n    this.lastTickSyncAt = null\n    this.stepFrequency = null\n    this.tickTimeout = null\n\n    this.settings = {\n      bpm: this.options.baseBpm,\n      octave: 0,\n      patternString: '',\n      velocity: 1.0,\n    }\n\n    this.synthesizerInterface = new SynthesizerInterface()\n    this.sequencer = new Sequencer(this.synthesizerInterface)\n  }\n\n  isRunning() {\n    return this.sequencer.isRunning\n  }\n\n  changePreset(preset) {\n    this.synthesizerInterface.changePreset(preset)\n  }\n\n  changeBpm(bpm) {\n    this.settings.bpm = bpm\n  }\n\n  changeOctave(octave) {\n    this.settings.octave = octave\n  }\n\n  changeVelocity(velocity) {\n    this.settings.velocity = velocity\n  }\n\n  changePattern(patternString) {\n    this.settings.patternString = patternString\n\n    // Translate string to sequencer pattern\n    const result = convertString(\n      this.settings.patternString,\n      this.settings.octave,\n      this.settings.velocity,\n      this.options.noteMaterial\n    )\n\n    if (!result) {\n      return false\n    }\n\n    const newBpm = this.options.baseBpm * Math.pow(2, result.bpmLevel)\n    this.changeBpm(newBpm)\n\n    // Give new pattern to sequencer when no problem occurred\n    this.sequencer.changePattern(result.pattern)\n\n    return true\n  }\n\n  step() {\n    this.sequencer.step()\n\n    this.tickTimeout = setTimeout(() => {\n      this.step()\n    }, this.stepFrequency)\n  }\n\n  syncTick() {\n    // Calculate a minute in our synced network\n    const now = new Date().getTime()\n    const elasticSecond = (\n      this.lastTickSyncAt ? now - this.lastTickSyncAt.getTime() : MS_PER_SECOND\n    )\n    const elasticMinute = SECONDS_PER_MINUTE * elasticSecond\n\n    // .. and generate 16th note ticks\n    this.stepFrequency = bpmToMs(\n      elasticMinute,\n      this.settings.bpm,\n      SMALLEST_BAR_DIVIDE\n    )\n    this.lastTickSyncAt = new Date()\n\n    if (!this.tickTimeout) {\n      this.step()\n    }\n  }\n\n  start() {\n    this.sequencer.start()\n  }\n\n  stop() {\n    this.sequencer.stop()\n\n    clearTimeout(this.tickTimeout)\n\n    this.tickTimeout = null\n    this.lastTickSyncAt = null\n    this.lastPatternSyncAt = null\n    this.stepFrequency = null\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/index.js","export default class Sequencer {\n  constructor(synthesizerInterface) {\n    this.synthesizerInterface = synthesizerInterface\n\n    this.currentStep = null\n    this.currentStepIndex = 0\n    this.previousStep = null\n\n    this.pattern = []\n\n    this.isRunning = false\n  }\n\n  step() {\n    if (!this.isRunning) {\n      return\n    }\n\n    if (this.pattern.length === 0) {\n      return\n    }\n\n    const {\n      isHolding,\n      note,\n      velocity,\n    } = this.pattern[this.currentStepIndex]\n\n    const previousNote = this.previousStep && this.previousStep.note\n\n    if (previousNote && (previousNote !== note || !isHolding)) {\n      this.synthesizerInterface.noteOff(previousNote)\n    }\n\n    if (note && (note !== previousNote || !isHolding)) {\n      this.synthesizerInterface.noteOn(\n        note,\n        velocity\n      )\n    }\n\n    this.previousStep = this.pattern[this.currentStepIndex]\n\n    this.currentStepIndex += 1\n\n    if (this.currentStepIndex > this.pattern.length - 1) {\n      this.currentStepIndex = 0\n    }\n  }\n\n  start() {\n    this.isRunning = true\n  }\n\n  stop() {\n    this.isRunning = false\n\n    this.currentStepIndex = 0\n    this.previousStep = null\n    this.synthesizerInterface.allNotesOff()\n  }\n\n  changePattern(pattern) {\n    this.pattern = pattern\n\n    if (this.isRunning) {\n      if (this.currentStepIndex > this.pattern.length - 1) {\n        this.currentStepIndex = 0\n      }\n      this.previousStep = null\n      this.synthesizerInterface.allNotesOff()\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/sequencer/index.js","import AudioInterface from './AudioInterface'\nimport Channel from './Channel'\nimport Synthesizer from './synthesizer'\n\nconst DEFAULT_NOTE = 72\nconst DEFAULT_VELOCITY = 1.0\n\nexport default class SynthesizerInterface {\n  constructor(options = {}) {\n    this.audio = new AudioInterface()\n    this.channels = []\n    this.preset = options.preset\n  }\n\n  changePreset(preset) {\n    this.preset = preset\n  }\n\n  noteOn(note = DEFAULT_NOTE, velocity = DEFAULT_VELOCITY) {\n    // Create FM synthesizer\n    const synthesizer = new Synthesizer({\n      preset: this.preset,\n      sampleRate: this.audio.context.sampleRate,\n    })\n\n    // Create a channel for audio\n    const channel = new Channel(this.audio, synthesizer, note)\n    channel.start()\n    this.channels.push(channel)\n\n    // Play the note\n    synthesizer.noteOn(note, velocity)\n  }\n\n  noteOff(note = DEFAULT_NOTE) {\n    const index = this.channels.findIndex(channel => {\n      return channel.note === note\n    })\n\n    if (index === -1) {\n      throw new Error('Could not find that note')\n    }\n\n    const removedChannel = this.channels[index]\n\n    removedChannel.note = null\n\n    removedChannel.synthesizer.noteOff()\n      .then(() => {\n        removedChannel.stop()\n\n        this.channels.splice(\n          this.channels.findIndex(channel => {\n            return channel === removedChannel\n          }), 1\n        )\n      })\n  }\n\n  allNotesOff() {\n    this.channels.forEach(channel => {\n      if (channel.note) {\n        this.noteOff(channel.note)\n      }\n    })\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/SynthesizerInterface.js","import impulseUrl from '../../assets/impulse.wav'\n\nfunction getImpulse(context) {\n  return new Promise((resolve, reject) => {\n    const ajaxRequest = new XMLHttpRequest()\n    ajaxRequest.open('GET', impulseUrl, true)\n    ajaxRequest.responseType = 'arraybuffer'\n\n    ajaxRequest.onload = () => {\n      const impulseData = ajaxRequest.response\n      context.decodeAudioData(impulseData, buffer => {\n        resolve(buffer)\n      }, (err) => {\n        reject(err)\n      })\n    }\n\n    ajaxRequest.send()\n  })\n}\n\nexport default class AudioInterface {\n  constructor() {\n    // Create audio context\n    this.context = new AudioContext()\n\n    // Reverb\n    this.convolverNode = this.context.createConvolver()\n    this.convolverNode.loop = true\n    this.convolverNode.normalize = true\n\n    getImpulse(this.context)\n      .then(buffer => {\n        this.convolverNode.buffer = buffer\n      })\n\n    // Compressor\n    this.compressorNode = this.context.createDynamicsCompressor()\n\n    // Gain\n    this.currentVolume = 0.5\n    this.gainNode = this.context.createGain()\n    this.gainNode.gain.value = this.currentVolume\n\n    this.compressorNode.connect(this.gainNode)\n    // this.convolverNode.connect(this.gainNode)\n    this.gainNode.connect(this.context.destination)\n  }\n\n  changeVolume(volume) {\n    this.gainNode.gain.value = volume\n    this.currentVolume = volume\n  }\n\n  mute() {\n    this.gainNode.gain.value = 0\n  }\n\n  unmute() {\n    this.gainNode.gain.value = this.currentVolume\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/AudioInterface.js","module.exports = __webpack_public_path__ + \"cce8145a91d99c7379b34bf23fce576a.wav\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./automaton/assets/impulse.wav\n// module id = 41\n// module chunks = 0","const BUFFER_SIZE = 1024\n\nexport default class Channel {\n  constructor(audioInterface, synthesizer, note) {\n    this.audioInterface = audioInterface\n    this.isRunning = false\n    this.note = note\n    this.scriptProcessorNode = null\n    this.synthesizer = synthesizer\n  }\n\n  start() {\n    if (this.isRunning) {\n      throw new Error('Channel was already started')\n    }\n\n    const { context, compressorNode } = this.audioInterface\n    this.scriptProcessorNode = context.createScriptProcessor(BUFFER_SIZE, 1, 2)\n\n    const bufferSourceNode = context.createBufferSource()\n    bufferSourceNode.start(0)\n\n    // Connect audio nodes\n    bufferSourceNode.connect(this.scriptProcessorNode)\n    this.scriptProcessorNode.connect(compressorNode)\n\n    // Start FM synthesis\n    this.scriptProcessorNode.onaudioprocess = (event) => {\n      const left = event.outputBuffer.getChannelData(0)\n      const right = event.outputBuffer.getChannelData(1)\n\n      this.synthesizer.generateAudio(left, right)\n    }\n\n    this.isRunning = true\n  }\n\n  stop() {\n    if (!this.isRunning) {\n      throw new Error('Channel was already stopped')\n    }\n\n    this.scriptProcessorNode.disconnect()\n    this.isRunning = false\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/Channel.js","import { ALGORITHMS } from './algorithms'\n\nimport {\n  calculatePhaseIncrement,\n  calculateRatioFrequency,\n  convertOperatorSettings,\n} from './helpers'\n\nimport Operator from './Operator'\n\nconst DEFAULT_SAMPLE_RATE = 16000\n\nexport default class Synthesizer {\n  constructor(options = {}) {\n    if (!options || !options.preset) {\n      throw new Error('Preset option is not set')\n    }\n\n    this.sampleRate = options.sampleRate || DEFAULT_SAMPLE_RATE\n\n    this.velocity = 1.0\n    this.feedback = 0.0\n\n    this.algorithmId = 0\n    this.operators = []\n\n    for (let i = 0; i < 4; i += 1) {\n      this.operators.push(new Operator())\n    }\n\n    this.changePreset(options.preset)\n  }\n\n  generateAudio(left, right) {\n    const numSamples = left.length\n    const algorithm = ALGORITHMS[this.algorithmId]\n\n    for (let sampleIndex = 0; sampleIndex < numSamples; sampleIndex += 1) {\n      let mainOutput = 0\n\n      for (let op = this.operators.length - 1; op >= 0; op -= 1) {\n        let modOutput = 0\n        const operator = this.operators[op]\n\n        this.operators.forEach((item, index) => {\n          modOutput += algorithm[op][index] * this.operators[index]._output\n        })\n\n        modOutput *= 10\n\n        if (op === 3) {\n          modOutput += operator._output * this.feedback * 3\n        }\n\n        const amp = operator.envelope.amp\n        operator._output = Math.sin(operator._phase + modOutput) * amp * amp\n\n        if (operator.isVelocitySensitive) {\n          operator._output *= this.velocity\n        }\n\n        operator._phase += operator._phaseIncrement\n\n        mainOutput += operator._output * algorithm[4][op]\n      }\n\n      right[sampleIndex] = left[sampleIndex] = mainOutput\n\n      this.operators.forEach(operator => {\n        operator.next()\n      })\n    }\n  }\n\n  noteOn(note, velocity) {\n    this.velocity = velocity\n\n    this.operators.forEach(operator => {\n      const frequency = calculateRatioFrequency(\n        operator.coarse,\n        operator.fine\n      )\n\n      operator._phaseIncrement = calculatePhaseIncrement(\n        note,\n        this.sampleRate\n      ) * frequency\n\n      operator._phase = 0.0\n      operator._output = 0.0\n    })\n\n    this.operators.forEach(operator => {\n      operator.noteOn()\n    })\n  }\n\n  noteOff() {\n    return new Promise(resolve => {\n      let counter = this.operators.length\n\n      this.operators.forEach(operator => {\n        operator.envelope.onRelease = () => {\n          counter -= 1\n          if (counter === 0) {\n            resolve()\n          }\n        }\n\n        operator.noteOff()\n      })\n    })\n  }\n\n  changeOperator(index, setting) {\n    if (index < 0 || index > this.operators.length - 1) {\n      return\n    }\n\n    this.operators[index].coarse = setting.coarse\n    this.operators[index].fine = setting.fine\n\n    this.operators[index].isFixed = setting.isFixed\n    this.operators[index].isVelocitySensitive = setting.isVelocitySensitive\n\n    this.operators[index].changeEnvelope(setting.envelope)\n  }\n\n  changePreset(preset) {\n    const convertedPreset = convertOperatorSettings(\n      preset,\n      this.sampleRate\n    )\n\n    this.feedback = convertedPreset.feedback\n    this.algorithmId = convertedPreset.algorithmId\n\n    convertedPreset.operators.forEach((setting, index) => {\n      this.changeOperator(index, setting)\n    })\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/synthesizer/index.js","export const ALGORITHMS = [\n  [\n    // OP1 OP2 OP3 OP4 = MOD\n    [  0,  1,  0,  0 ], // OP1\n    [  0,  0,  1,  0 ], // OP2\n    [  0,  0,  0,  1 ], // OP3\n    [  0,  0,  0,  0 ], // OP4\n    [  1,  0,  0,  0 ], // carrier\n  ],\n  [\n    // OP1 OP2 OP3 OP4\n    [  0,  1,  0,  0 ], // OP1\n    [  0,  0,  1,  1 ], // OP2\n    [  0,  0,  0,  0 ], // OP3\n    [  0,  0,  0,  0 ], // OP4\n    [  1,  0,  0,  0 ], // carrier\n  ],\n  [\n    // OP1 OP2 OP3 OP4\n    [  0,  1,  0,  1 ], // OP1\n    [  0,  0,  1,  0 ], // OP2\n    [  0,  0,  0,  0 ], // OP3\n    [  0,  0,  0,  0 ], // OP4\n    [  1,  0,  0,  0 ], // carrier\n  ],\n  [\n    // OP1 OP2 OP3 OP4\n    [  0,  1,  1,  0 ], // OP1\n    [  0,  0,  0,  0 ], // OP2\n    [  0,  0,  0,  1 ], // OP3\n    [  0,  0,  0,  0 ], // OP4\n    [  1,  0,  0,  0 ], // carrier\n  ],\n  [\n    // OP1 OP2 OP3 OP4\n    [  0,  1,  0,  0 ], // OP1\n    [  0,  0,  0,  0 ], // OP2\n    [  0,  0,  0,  1 ], // OP3\n    [  0,  0,  0,  0 ], // OP4\n    [  0.5, 0, 0.5, 0 ], // carrier\n  ],\n  [\n    // OP1 OP2 OP3 OP4\n    [  0,  0,  0,  1 ], // OP1\n    [  0,  0,  0,  1 ], // OP2\n    [  0,  0,  0,  1 ], // OP3\n    [  0,  0,  0,  0 ], // OP4\n    [  0.33, 0.33, 0.33, 0 ], // carrier\n  ],\n  [\n    // OP1 OP2 OP3 OP4\n    [  0,  0,  0,  0 ], // OP1\n    [  0,  0,  0,  0 ], // OP2\n    [  0,  0,  0,  1 ], // OP3\n    [  0,  0,  0,  0 ], // OP4\n    [  0.33, 0.33, 0.33, 0 ], // carrier\n  ],\n  [\n    // OP1 OP2 OP3 OP4\n    [  0,  0,  0,  0 ], // OP1\n    [  0,  0,  0,  0 ], // OP2\n    [  0,  0,  0,  0 ], // OP3\n    [  0,  0,  0,  0 ], // OP4\n    [  0.25,  0.25,  0.25,  0.25 ], // carrier\n  ],\n]\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/synthesizer/algorithms.js","export function calculatePhaseIncrement(frequency, sampleRate) {\n  return 2 * Math.PI * frequency / sampleRate\n}\n\nexport function calculateRatioFrequency(coarse, fine) {\n  let ratio = Math.ceil(coarse * 13)\n\n  if (ratio === 0) {\n    ratio = 0.5\n  }\n\n  ratio += (fine >= 1.0) ? 0.99 : fine\n\n  return ratio\n}\n\nexport function convertOperatorSettings(setting, sampleRate) {\n  const { algorithmId, feedback } = setting\n  const totalTime = 15 * sampleRate\n  const operators = []\n\n  for (let i = 0; i < 4; i += 1) {\n    const envelope = {\n      isLoop: setting.isLoop[i],\n    }\n\n    envelope.segments = setting.envelopes[i].map((segment, index) => {\n      let length\n      let step\n\n      if (index === 0) {\n        // Attack\n        length = Math.pow(segment.x, 2) * totalTime\n\n        if (length === 0) {\n          length = 1\n        }\n\n        step = (1.0 - segment.y) / length\n      } else if (index === 1) {\n        // Decay\n        const previousSegment = setting.envelopes[i][0]\n        length = Math.pow(segment.x - previousSegment.x, 2) * totalTime\n\n        if (length === 0) {\n          length = 1\n        }\n\n        step = -1 * (segment.y - previousSegment.y) / length\n      } else if (index === 2) {\n        // Release\n        length = Math.pow(1.0 - segment.x, 2) * totalTime\n\n        if (length === 0) {\n          length = 1\n        }\n\n        step = -1 * (1.0 - segment.y) / length\n      }\n\n      return {\n        length,\n        step,\n      }\n    })\n\n    operators.push({\n      isVelocitySensitive: setting.isVelocitySensitive[i],\n      coarse: setting.coarse[i],\n      fine: setting.fine[i],\n      envelope,\n    })\n  }\n\n  return {\n    algorithmId,\n    feedback,\n    operators,\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/synthesizer/helpers.js","import Envelope from './Envelope'\n\nexport default class Operator {\n  constructor() {\n    this.envelope = new Envelope()\n\n    this.coarse = 0.0\n    this.fine = 0.0\n\n    this.isVelocitySensitive = false\n\n    this._output = 0.0\n    this._phase = 0.0\n    this._phaseIncrement = 0.0\n  }\n\n  next() {\n    return this.envelope.next()\n  }\n\n  noteOn() {\n    return this.envelope.noteOn()\n  }\n\n  noteOff() {\n    return this.envelope.noteOff()\n  }\n\n  changeEnvelope(settings) {\n    this.envelope.isLoop = settings.isLoop\n\n    settings.segments.forEach((setting, index) => {\n      this.envelope.changeSegment(index, setting)\n    })\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/synthesizer/Operator.js","const ENVELOPE_STATES = {\n  STOP: 0,\n  ATTACK: 1,\n  DECAY: 2,\n  SUSTAIN: 3,\n  RELEASE: 4,\n  DUMP: 5,\n}\n\nimport EnvelopeSegment from './EnvelopeSegment'\n\nexport default class Envelope {\n  constructor() {\n    this.state = ENVELOPE_STATES.STOP\n\n    this.amp = 0.0\n    this.isLoop = false\n\n    this.segments = []\n\n    this.currentSegmentPosition = 0\n    this.currentSegmentStep = 0.0\n\n    this.onRelease = () => true\n\n    for (let i = 0; i < 3; i += 1) {\n      this.segments.push(new EnvelopeSegment())\n    }\n  }\n\n  next() {\n    if (this.currentSegmentPosition <= 0) {\n      return\n    }\n\n    this.amp += this.currentSegmentStep\n    if (this.amp > 1.0) {\n      this.amp = 1.0\n    }\n\n    this.currentSegmentPosition -= 1\n\n    if (this.currentSegmentPosition <= 0) {\n      switch (this.state) {\n      case ENVELOPE_STATES.DUMP:\n        this.state = ENVELOPE_STATES.ATTACK\n        this.currentSegmentStep = this.segments[0].step\n        this.currentSegmentPosition = this.segments[0].length\n        this.amp = 0.0\n        break\n      case ENVELOPE_STATES.ATTACK:\n        this.state = ENVELOPE_STATES.DECAY\n        this.currentSegmentStep = this.segments[1].step\n        this.currentSegmentPosition = this.segments[1].length\n        break\n      case ENVELOPE_STATES.DECAY:\n        if (!this.isLoop) {\n          this.state = ENVELOPE_STATES.SUSTAIN\n          this.currentSegmentStep = 0.0\n          this.currentSegmentPosition = 0\n        } else {\n          this.state = ENVELOPE_STATES.ATTACK\n          this.currentSegmentStep = this.segments[0].step\n          this.currentSegmentPosition = this.segments[0].length\n          this.amp = 0.0\n        }\n        break\n      case ENVELOPE_STATES.RELEASE:\n        this.state = ENVELOPE_STATES.STOP\n        this.amp = 0.0\n        if (this.onRelease) {\n          this.onRelease()\n        }\n        break\n      }\n    }\n  }\n\n  noteOn() {\n    if (this.state !== ENVELOPE_STATES.STOP) {\n      this.state = ENVELOPE_STATES.DUMP\n      this.currentSegmentStep = -1 * this.amp / this.currentSegmentPosition\n      this.currentSegmentPosition = 128\n    } else {\n      this.state = ENVELOPE_STATES.ATTACK\n      this.currentSegmentStep = this.segments[0].step\n      this.currentSegmentPosition = this.segments[0].length\n      this.amp = 0.0\n    }\n  }\n\n  noteOff() {\n    if (this.state !== ENVELOPE_STATES.STOP) {\n      this.state = ENVELOPE_STATES.RELEASE\n      this.currentSegmentStep = -1 * this.amp / this.segments[2].length\n      this.currentSegmentPosition = this.segments[2].length\n    }\n  }\n\n  changeSegment(index, setting) {\n    if (index < 0 || index > this.segments.length - 1) {\n      throw new Error('Invalid segment index')\n    }\n\n    this.segments[index].length = setting.length\n    this.segments[index].step = setting.step\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/synthesizer/Envelope.js","export default class EnvelopeSegment {\n  constructor() {\n    this.length = 0\n    this.step = 0.0\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/synthesizer/EnvelopeSegment.js","const HOLD_NOTE_CHAR = '*'\nconst NOTES_CHAR = ['.', '-', '_', ':', '/']\nconst PAUSE_CHAR = ' '\n\nconst BPM_UP = '>'\nconst BPM_DOWN = '<'\n\nfunction stringToSequencerPattern(patternString, octave = 0, velocity, noteMaterial) {\n  const notes = patternString.toLowerCase().split('')\n\n  if (notes.length === 0) {\n    return []\n  }\n\n  let previousNote = null\n  let isError = false\n\n  const result = notes.map(noteChar => {\n    let note = null\n    let isHolding = false\n\n    if (noteChar === HOLD_NOTE_CHAR) {\n      if (!previousNote) {\n        isError = true\n        return false\n      }\n\n      note = previousNote\n      isHolding = true\n    } else if (noteChar === PAUSE_CHAR) {\n      previousNote = null\n    } else if (NOTES_CHAR.includes(noteChar)) {\n      const noteNumber = NOTES_CHAR.indexOf(noteChar)\n      note = noteMaterial[noteNumber] * Math.pow(2, octave)\n      previousNote = note\n    } else {\n      isError = true\n      return false\n    }\n\n    return {\n      isHolding,\n      note,\n      velocity: note ? velocity : 0.0,\n    }\n  })\n\n  if (isError) {\n    return false\n  }\n\n  return result\n}\n\nfunction countCharInString(string, char) {\n  const regex = new RegExp(char, 'g')\n  return (string.match(regex) || []).length\n}\n\nfunction extractBpmLevel(string) {\n  const up = countCharInString(string, BPM_UP)\n  const down = countCharInString(string, BPM_DOWN)\n\n  return up - down\n}\n\nexport function convertString(string, octave, velocity, noteMaterial) {\n  const bpmLevel = extractBpmLevel(string)\n  const pattern = stringToSequencerPattern(\n    string.replace(/(<|>)/g, ''),\n    octave,\n    velocity,\n    noteMaterial\n  )\n\n  if (!pattern) {\n    return false\n  }\n\n  return {\n    bpmLevel,\n    pattern,\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/patternHelpers.js","export const SLENDRO = [\n  240.6055948894539,\n  274.7914006625929,\n  316.56538760240016,\n  368.28862969288394,\n  420.13030572053793,\n  482.6029910656113,\n  551.1723529945722,\n]\n\nexport const PELOG = [\n  298.7979376420033,\n  329.6275569129,\n  358.4247322079921,\n  420.13030572053793,\n  452.10885997355683,\n  482.6029910656113,\n  533.9372457958401,\n]\n\nexport function pickFromScale(picks, scale) {\n  return picks.map(pick => {\n    return scale[pick]\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/scales.js","export const PRESETS = {\n  BELL: {\n    name: 'BELL',\n    algorithmId: 4,\n    coarse: [0.04, 0.19, 0.06, 0.18],\n    feedback: 0.3,\n    fine: [0, 0.5, 0, 0.5],\n    isLoop: [false, false, false, false],\n    isVelocitySensitive: [true, true, true, true],\n    envelopes: [\n      [{ x: 0, y: 0.053 }, { x: 0.708, y: 0.741 }, { x: 0.708, y: 0.741 }],\n      [{ x: 0, y: 0.435 }, { x: 0.741, y: 0.729 }, { x: 0.741, y: 0.729 }],\n      [{ x: 0.004, y: 0.562 }, { x: 0.226, y: 0.832 }, { x: 0.708, y: 0.832 }],\n      [{ x: 0.004, y: 0.461 }, { x: 0.281, y: 0.814 }, { x: 0.715, y: 0.814 }],\n    ],\n  },\n  CHIME: {\n    name: 'CHIME',\n    algorithmId: 5,\n    coarse: [0.28, 0.07, 0.66, 0.05],\n    feedback: 0.3,\n    fine: [0.29, 0, 0, 0],\n    isLoop: [false, false, false, true],\n    isVelocitySensitive: [true, true, false, true],\n    envelopes: [\n      [{ x: 0.004, y: 0 }, { x: 0.752, y: 0.653 }, { x: 0.752, y: 0.653 }],\n      [{ x: 0, y: 0.524 }, { x: 0.285, y: 0.7 }, { x: 0.752, y: 0.7 }],\n      [{ x: 0, y: 0.829 }, { x: 0.288, y: 0.994 }, { x: 0.9, y: 0.994 }],\n      [{ x: 0.077, y: 0.824 }, { x: 0.161, y: 0.994 }, { x: 0.9, y: 0.994 }],\n    ],\n  },\n  PAD: {\n    name: 'PAD',\n    algorithmId: 4,\n    coarse: [0.05, 0.07, 0.13, 0.05],\n    feedback: 0.94,\n    fine: [0, 0, 0.33, 0.5],\n    isLoop: [false, false, false, false],\n    isVelocitySensitive: [true, false, false, false],\n    envelopes: [\n      [{ x: 0.062, y: 0.106 }, { x: 0.237, y: 0 }, { x: 0.752, y: 0 }],\n      [{ x: 0.139, y: 0.776 }, { x: 0.328, y: 0.741 }, { x: 0.752, y: 0.741 }],\n      [{ x: 0.131, y: 0.5 }, { x: 0.354, y: 0.288 }, { x: 0.704, y: 0.288 }],\n      [{ x: 0.077, y: 0.618 }, { x: 0.201, y: 0.524 }, { x: 0.741, y: 0.524 }],\n    ],\n  },\n  SPACE: {\n    name: 'SPACE',\n    algorithmId: 5,\n    coarse: [0.19, 0.41, 0.24, 0.14],\n    feedback: 0.58,\n    fine: [0, 0, 0, 0.5],\n    isLoop: [true, true, true, true],\n    isVelocitySensitive: [false, false, false, false],\n    envelopes: [\n      [{ x: 0.212, y: 0.253 }, { x: 0.423, y: 0.994 }, { x: 0.752, y: 0.994 }],\n      [{ x: 0.142, y: 0.541 }, { x: 0.281, y: 0.982 }, { x: 0.752, y: 0.982 }],\n      [{ x: 0.354, y: 0.106 }, { x: 0.704, y: 0.994 }, { x: 0.704, y: 0.994 }],\n      [{ x: 0.423, y: 0.276 }, { x: 0.861, y: 0.994 }, { x: 0.861, y: 0.994 }],\n    ],\n  },\n  PING: {\n    name: 'PING',\n    algorithmId: 6,\n    coarse: [0, 0.05, 0.17, 0.59],\n    feedback: 0.19,\n    fine: [0, 0.5, 0.5, 0],\n    isLoop: [false, false, false, false],\n    isVelocitySensitive: [true, true, true, true],\n    envelopes: [\n      [{ x: 0.07, y: 0.547 }, { x: 0.314, y: 0.994 }, { x: 0.752, y: 0.994 }],\n      [{ x: 0.1, y: 0.735 }, { x: 0.423, y: 0.788 }, { x: 0.847, y: 0.788 }],\n      [{ x: 0, y: 0.488 }, { x: 0.058, y: 0.794 }, { x: 0.73, y: 0.794 }],\n      [{ x: 0, y: 0.665 }, { x: 0.069, y: 0.818 }, { x: 0.734, y: 0.818 }],\n    ],\n  },\n  GUITAR: {\n    name: 'GUITAR',\n    algorithmId: 0,\n    coarse: [0, 0.05, 0.17, 0.59],\n    feedback: 0.19,\n    fine: [0, 0.5, 0.5, 0],\n    isLoop: [false, false, false, false],\n    isVelocitySensitive: [true, false, false, true],\n    envelopes: [\n      [{ x: 0.05, y: 0.547 }, { x: 0.314, y: 0.994 }, { x: 0.752, y: 0.994 }],\n      [{ x: 0, y: 0.735 }, { x: 0.423, y: 0.788 }, { x: 0.847, y: 0.788 }],\n      [{ x: 0.01, y: 0.488 }, { x: 0.058, y: 0.794 }, { x: 0.73, y: 0.794 }],\n      [{ x: 0, y: 0.665 }, { x: 0.069, y: 0.818 }, { x: 0.734, y: 0.818 }],\n    ],\n  },\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/instrument/presets.js","import Peer from 'peerjs'\nimport { create as createTimesync } from 'timesync'\n\nconst CHECK_MISSING_PEERS_FREQUENCY = 10000\nconst PEER_ID_KEY = 'automaton-peer'\n\nfunction getPeerString(id) {\n  return `${PEER_ID_KEY}-${id}`\n}\n\nfunction getAllPeers(clientsNumber, ownId) {\n  const peers = []\n\n  for (let id = 1; id < clientsNumber + 1; id += 1) {\n    if (ownId !== id) {\n      peers.push(getPeerString(id))\n    }\n  }\n\n  return peers\n}\n\nfunction getOpenConnection(connections) {\n  return connections && connections.filter(remoteConnection => {\n    return remoteConnection.open\n  })[0]\n}\n\nconst defaultOptions = {\n  onAllOnline: () => {},\n  onClose: () => {},\n  onCloseRemote: () => {},\n  onError: () => {},\n  onOpen: () => {},\n  onOpenRemote: () => {},\n  onReceive: () => {},\n  onSyncTick: () => {},\n  syncInterval: 500,\n  syncStepsDelay: 100,\n  syncTickFrequency: 1,\n}\n\nexport default class Network {\n  constructor(options) {\n    this.options = Object.assign({}, defaultOptions, options)\n\n    this.lastCheckedDate = new Date()\n    this.offset = 0\n    this.peer = null\n    this.peers = []\n    this.sync = null\n    this.syncInterval = null\n    this.syncTickInterval = null\n  }\n\n  isAlone() {\n    return this.peers.filter(id => {\n      if (getOpenConnection(this.peer.connections[id])) {\n        return true\n      }\n      return false\n    }).length === 0\n  }\n\n  connect(configuration) {\n    if (this.peer && this.peer.open) {\n      this.options.onError(\n        new Error('Connection is already open')\n      )\n      return false\n    }\n\n    const {\n      serverHost,\n      serverKey,\n    } = configuration\n\n    const peerId = parseInt(configuration.peerId, 10)\n    const clientsNumber = parseInt(configuration.clientsNumber, 10)\n    const serverPort = parseInt(configuration.serverPort, 10)\n\n    if (peerId < 1 || peerId > clientsNumber) {\n      this.options.onError(\n        new Error('Invalid peer id')\n      )\n      return false\n    }\n\n    this.peers = getAllPeers(clientsNumber, peerId)\n    this.lastCheckedDate = new Date()\n\n    const setupConnection = (connection) => {\n      if (this.peer.connections[connection.id]) {\n        const isAlreadyOpen = this.peer.connections[connection.id]\n          .find(remoteConnection => {\n            return remoteConnection.open\n          })\n\n        if (isAlreadyOpen) {\n          return\n        }\n      }\n\n      connection\n        .on('open', () => {\n          this.options.onOpenRemote(connection.peer)\n\n          const onlinePeers = this.peers\n            .filter(id => {\n              if (getOpenConnection(this.peer.connections[id])) {\n                return true\n              }\n              return false\n            })\n\n          if (onlinePeers.length === this.peers.length) {\n            this.options.onAllOnline()\n          }\n        })\n        .on('data', data => {\n          if (data.jsonrpc) {\n            this.sync.receive(connection.peer, data)\n          } else {\n            this.options.onReceive(connection.peer, data)\n          }\n        })\n        .on('close', () => {\n          this.options.onCloseRemote(connection.peer)\n        })\n        .on('error', err => {\n          this.options.onError(err)\n        })\n    }\n\n    const connectToPeers = () => {\n      this.peers\n        .filter(id => {\n          return !(id in this.peer.connections)\n        })\n        .forEach(id => {\n          const connection = this.peer.connect(id, {\n            serialization: 'json',\n          })\n          setupConnection(connection)\n        })\n    }\n\n    this.peer = new Peer(getPeerString(peerId), {\n      host: serverHost,\n      key: serverKey,\n      port: serverPort,\n      secure: window.location.protocol === 'https:',\n    })\n\n    this.peer.on('open', () => {\n      connectToPeers()\n      this.options.onOpen()\n    })\n\n    this.peer.on('connection', connection => {\n      setupConnection(connection)\n    })\n\n    this.peer.on('disconnected', () => {\n      this.peer.destroy()\n      this.sync.destroy()\n    })\n\n    this.peer.on('close', () => {\n      this.options.onClose()\n    })\n\n    this.peer.on('error', err => {\n      this.options.onError(err)\n\n      if (err.type !== 'disconnected' && err.type !== 'peer-unavailable') {\n        this.disconnect(true)\n      }\n    })\n\n    // Time synchronization between peers\n    this.sync = createTimesync({\n      delay: this.options.syncStepsDelay,\n      interval: this.options.syncInterval,\n      peers: [],\n      timeout: 10000,\n    })\n\n    this.sync.send = (id, data) => {\n      this.send(id, data)\n    }\n\n    this.sync.on('sync', state => {\n      if (state === 'start') {\n        const openConnections = Object.keys(this.peer.connections)\n          .filter(id => {\n            return this.peer.connections[id].some(connection => {\n              return connection.open\n            })\n          })\n\n        this.sync.options.peers = openConnections\n      } else if (state === 'end') {\n        this.sync.options.peers = []\n      }\n    })\n\n    this.sync.on('change', offset => {\n      this.offset = offset\n    })\n\n    // Check for missing connections\n    this.syncInterval = setInterval(\n      connectToPeers,\n      CHECK_MISSING_PEERS_FREQUENCY\n    )\n\n    // Start synchronized ticking\n    this.syncTickInterval = setInterval(\n      () => {\n        const syncDate = new Date(this.sync.now())\n        if (syncDate.getSeconds() !== this.lastCheckedDate.getSeconds()) {\n          this.options.onSyncTick(this.offset)\n          this.lastCheckedDate = syncDate\n        }\n      }, this.options.syncTickFrequency\n    )\n\n    return true\n  }\n\n  disconnect(isForced = false) {\n    if (!isForced && (!this.peer || !this.peer.open)) {\n      throw new Error('Connection is already closed')\n    }\n\n    this.peer.disconnect()\n\n    clearInterval(this.syncInterval)\n    clearInterval(this.syncTickInterval)\n\n    this.syncTickInterval = null\n    this.syncInterval = null\n  }\n\n  sendToAll(data) {\n    this.peers.forEach(id => {\n      this.send(id, data)\n    })\n  }\n\n  send(id, data) {\n    const connection = getOpenConnection(this.peer.connections[id])\n\n    if (connection) {\n      connection.send(data)\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/network/index.js","const STORAGE_KEY = 'automaton'\n\nfunction loadFromStorage() {\n  const storage = window.localStorage.getItem(STORAGE_KEY)\n  return storage ? JSON.parse(storage) : {}\n}\n\nfunction saveToStorage(configuration) {\n  window.localStorage.setItem(STORAGE_KEY, JSON.stringify(configuration))\n}\n\nconst defaultConfiguration = {\n  clientsNumber: 4,\n  peerId: 1,\n  serverHost: '0.peerjs.com',\n  serverKey: 'gs5wl7sq2cblnmi',\n  serverPort: 9000,\n}\n\nexport default class Settings {\n  constructor() {\n    this.configuration = Object.assign(\n      {},\n      defaultConfiguration,\n      loadFromStorage()\n    )\n  }\n\n  update(id, value) {\n    this.configuration[id] = value\n    saveToStorage(this.configuration)\n  }\n\n  getConfiguration() {\n    return this.configuration\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/Settings.js","const ERROR_MESSAGES_LIMIT = 3\n\nconst VIEW_IDS = [\n  'main-view',\n  'settings-view',\n]\n\nconst INITIAL_VIEW = 'settings-view'\n\nexport default class View {\n  constructor() {\n    this.allFormElems = document.querySelectorAll('form input')\n    this.connectButtonElem = document.getElementById('connect-button')\n    this.connectedPeersElem = document.getElementById('connected-peers')\n    this.disconnectButtonElem = document.getElementById('disconnect-button')\n    this.errorMessagesElem = document.getElementById('error-messages')\n    this.offsetMonitorElem = document.getElementById('offset-monitor')\n    this.patternElem = document.getElementById('pattern')\n    this.tickElem = document.getElementById('tick')\n\n    this.errorMessages = []\n\n    this.committedPattern = null\n\n    this.changeView(VIEW_IDS.indexOf(INITIAL_VIEW))\n  }\n\n  getCurrentView() {\n    return document.querySelector('.view--active').id\n  }\n\n  changeConnectionState(isLoading, isConnected) {\n    this.connectButtonElem.disabled = isLoading || isConnected\n    this.disconnectButtonElem.disabled = isLoading || !isConnected\n\n    for (let i = 0; i < this.allFormElems.length; i++) {\n      this.allFormElems[i].disabled = isLoading || isConnected\n    }\n  }\n\n  updateSettings(configuration) {\n    Object.keys(configuration).forEach(id => {\n      const inputElement = document.getElementById(id)\n      if (inputElement) {\n        inputElement.value = configuration[id]\n      }\n    })\n  }\n\n  updateOffset(offset) {\n    this.offsetMonitorElem.innerText = `${offset.toFixed(1)} ms`\n  }\n\n  addErrorMessage(message) {\n    this.errorMessages.push({\n      timestamp: new Date(),\n      message,\n    })\n\n    if (this.errorMessages.length > ERROR_MESSAGES_LIMIT) {\n      this.errorMessages.shift()\n    }\n\n    this.errorMessagesElem.innerHTML = ''\n\n    this.errorMessages.forEach(error => {\n      const errorMessageElem = document.createElement('div')\n      const formattedTime = error.timestamp.toISOString()\n      errorMessageElem.innerText = formattedTime + ' ' + error.message\n\n      this.errorMessagesElem.appendChild(errorMessageElem)\n    })\n  }\n\n  addRemotePeer(peerId) {\n    const peerElem = document.createElement('div')\n    peerElem.class = 'connected-peer'\n    peerElem.innerText = peerId\n    peerElem.id = peerId\n\n    this.connectedPeersElem.appendChild(peerElem)\n  }\n\n  removeRemotePeer(peerId) {\n    const peerElem = document.getElementById(peerId)\n    this.connectedPeersElem.removeChild(peerElem)\n  }\n\n  changeView(viewIndex) {\n    if (viewIndex < 0 || viewIndex > VIEW_IDS.length - 1) {\n      return\n    }\n\n    VIEW_IDS.forEach(viewId => {\n      document.getElementById(viewId).classList.remove('view--active')\n    })\n\n    const nextViewId = VIEW_IDS[viewIndex]\n    document.getElementById(nextViewId).classList.add('view--active')\n\n    this.patternElem.blur()\n  }\n\n  changePattern(pattern) {\n    const isPatternDirty = (\n      this.committedPattern && this.committedPattern !== pattern\n    )\n\n    if (!this.committedPattern) {\n      this.committedPattern = pattern\n    }\n\n    this.patternElem.value = pattern\n\n    if (isPatternDirty) {\n      this.patternElem.classList.add('space__input--dirty')\n    } else {\n      this.patternElem.classList.remove('space__input--dirty')\n    }\n  }\n\n  focusPattern() {\n    this.patternElem.focus()\n  }\n\n  commitPattern(pattern) {\n    this.patternElem.classList.remove('space__input--dirty')\n    this.patternElem.classList.add('space__input--commit')\n\n    setTimeout(() => {\n      this.patternElem.classList.remove('space__input--commit')\n    }, 500)\n\n    this.committedPattern = pattern\n  }\n\n  tick() {\n    this.tickElem.classList.add('tick--active')\n    setTimeout(() => {\n      this.tickElem.classList.remove('tick--active')\n    }, 500)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./automaton/scripts/View.js"],"sourceRoot":""}